<template>
  <section class="computer" :id="$route.name">
    <div class="left">
      <TheHeadline />
      <div class="buttons-group">
        <router-link to="/zistit-viac" class="login button sm-br">
          <router-link
            to="/zistit-viac"
            alt="Zisti≈• viac o Helig√≥nkovej Akad√©mii a na≈°ich kurzoch helig√≥nky"
            >Zisti≈• viac</router-link
          >
        </router-link>
        <router-link to="/zistit-viac" class="login button sm-br">
          <router-link
            to="/ucebna/zadarmo-video"
            alt="Vysk√∫≈°ajte zdarma uk√°≈ækov√© n√°uƒçn√© video na helig√≥nku ‚Äì krok po kroku"
            >Vysk√∫≈°a≈• zadarmo</router-link
          >
        </router-link>
      </div>
    </div>
    <div class="right">
      <img
        src="@/assets/images/gallery/JurajAAndrejVelkeHlavy.png"
        alt="Uƒçitelia Helig√≥nkovej Akad√©mie s helig√≥nkami ‚Äì online kurzy a n√°uƒçn√© vide√°"
      />
      <button
        v-if="isGuideButtonVisible"
        type="button"
        class="login button sm-br guide-tour-button"
        @click="startHomeTour"
        aria-label="Spusti≈• kr√°tky n√°vod"
      >
        <span aria-hidden="true" class="guide-tour-button__icon">?</span>
      </button>
    </div>
  </section>

  <section :id="$route.name" class="second computer">
    <routerLink to="naucne-videa" class="box-main">
      <img
        src="@/assets/images/gallery/NaucneVideaTitle.png"
        alt="N√°uƒçn√© vide√° na helig√≥nku ‚Äì v√Ωuƒçba krok za krokom"
      />
      <p>N√°uƒçn√© vide√°</p>
    </routerLink>
    <routerLink to="ciselne-zapisy" class="box-main">
      <img
        src="@/assets/images/gallery/CiselneZapisyTitle.png"
        alt="ƒå√≠seln√© z√°pisy a noty pre helig√≥nku ‚Äì jednoduch√© n√°vody na hranie"
      />
      <p>ƒå√≠seln√© z√°pisy</p>
    </routerLink>
    <routerLink to="helishop" class="box-main">
      <img
        src="@/assets/images/gallery/MerchTitle.png"
        alt="HeliShop ‚Äì obleƒçenie a doplnky pre helig√≥nku"
      />
      <p>HeliShop</p>
    </routerLink>
    <routerLink to="helifest" class="box-main">
      <img
        src="@/assets/images/gallery/HelifestTitle.png"
        alt="HeliFest ‚Äì festival a podujatia pre hr√°ƒçov na helig√≥nku"
      />
      <p>HeliFest</p>
    </routerLink>
  </section>

  <div class="mobile" :id="$route.name">
    <div class="scroll">
      <section>
        <TheHeadline />
        <div class="left">
          <router-link to="/zistit-viac" class="login button sm-br">
            <router-link to="/zistit-viac">Zisti≈• viac</router-link>
          </router-link>
          <router-link to="/zistit-viac" class="login button sm-br">
            <router-link
              to="/ucebna/zadarmo-video"
              alt="Vysk√∫≈°ajte zdarma uk√°≈ækov√© n√°uƒçkov√© video na helig√≥nku ‚Äì krok po kroku"
              >Vysk√∫≈°a≈• zadarmo</router-link
            >
          </router-link>
        </div>
        <div class="right">
          <img
            src="@/assets/images/gallery/JurajAAndrejVelkeHlavy.png"
            alt="Heligonk√°ry Juraj a Andrej zo zv√§ƒç≈°en√Ωmi hlavami"
          />
          <button
            v-if="isGuideButtonVisible"
            type="button"
            class="login button sm-br guide-tour-button"
            @click="startHomeTour"
            aria-label="Spusti≈• kr√°tky n√°vod"
          >
            <span aria-hidden="true" class="guide-tour-button__icon">?</span>
          </button>
        </div>
      </section>

      <section :id="$route.name" class="second mobile">
        <routerLink to="naucne-videa" class="box-main">
          <img src="@/assets/images/gallery/NaucneVideaTitle.png" alt="" />
          <p>N√°uƒçn√© vide√°</p>
        </routerLink>
        <routerLink to="ciselne-zapisy" class="box-main">
          <img src="@/assets/images/gallery/CiselneZapisyTitle.png" alt="" />
          <p>ƒå√≠seln√© z√°pisy</p>
        </routerLink>
        <routerLink to="helishop" class="box-main">
          <img src="@/assets/images/gallery/MerchTitle.png" alt="" />
          <p>HeliShop</p>
        </routerLink>
      </section>

      <section :id="$route.name" class="mobile-newslist">
        <div class="news">
          <p class="news-intro">
            Pravidelne prid√°vame nov√© n√°uƒçn√© vide√°, ƒç√≠seln√© z√°pisy a ƒèal≈°ie
            zauj√≠mavosti. Sledujte n√°s, aby v√°m niƒç neuniklo.
          </p>
        </div>
        <NewsList />
      </section>

      <!-- BOOK blok (len mobil) -->
      <section :id="$route.name" class="mobile-frstbook">
        <div class="book-card" ref="bookSection">
          <!-- riadok: ob√°lka vƒæavo + text vpravo -->
          <div class="book-row">
            <img
              class="book-cover"
              src="@/assets/images/gallery/KnihaJedna.png"
              alt="Kniha Nauƒç sa hra≈• na helig√≥nke jednoducho, r√Ωchlo a efekt√≠vne ‚Äì uƒçebnica s ƒç√≠seln√Ωmi z√°pismi a tipmi ako hra≈• na helig√≥nke"
            />
            <div class="book-text">
              <h2 class="book-title">
                Na≈°a prv√° kniha: Nauƒç sa hra≈• na helig√≥nke jednoducho, r√Ωchlo a
                efekt√≠vne
              </h2>
              <p class="book-lead">
                Objavte jedineƒçn√∫ uƒçebnicu, ktor√° v√°s prevedie od prv√Ωch t√≥nov
                a≈æ po obƒæ√∫ben√© piesne doma aj na cest√°ch.
              </p>
            </div>
          </div>

          <!-- rozbalovac√≠ text (animovan√Ω) -->
          <transition name="fade-slide">
            <div v-if="showMoreBook" class="book-more-content">
              <p>
                Po rokoch zbierania sk√∫senost√≠ a vƒèaka obrovsk√©mu z√°ujmu sme sa
                rozhodli pripravi≈• prv√Ω diel n√°uƒçnej knihy Helig√≥nkov√° akad√©mia.
                Na≈°√≠m cieƒæom bolo vytvori≈• sprievodcu, ktor√Ω v√°s nauƒç√≠ hra≈• na
                helig√≥nke od √∫pln√Ωch z√°kladov a≈æ po pokroƒçil√© skladby ‚Äì
                jednoducho, zrozumiteƒæne a z√°bavne.
              </p>

              <div class="book-points-wrapper">
                <p class="points-title"><strong>V knihe n√°jdete:</strong></p>
                <ul class="book-points">
                  <li>Prehƒæadn√© ƒç√≠seln√© z√°pisy k obƒæ√∫ben√Ωm pies≈àam</li>
                  <li>Tipy, triky a postupy od sk√∫sen√Ωch uƒçiteƒæov</li>
                  <li>Metodiku krok za krokom, od basov po mel√≥diu</li>
                  <li>
                    Cviƒçenia s n√°uƒçn√Ωmi videami, ktor√© n√°jdete na na≈°ej str√°nke
                  </li>
                </ul>
              </div>

              <p>
                Ka≈æd√Ω v√Ωtlaƒçok je jedineƒçn√Ω ‚Äì obsahuje svoj unik√°tny k√≥d. Po
                jeho zadan√≠ na na≈°ej str√°nke sa v√°m v≈°etky piesne z knihy
                pridaj√∫ do v√°≈°ho osobn√©ho online zoznamu piesn√≠. Tak budete ma≈•
                svoje z√°pisy v≈ædy k dispoz√≠cii, aj bez knihy po ruke ‚Äì ƒçi u≈æ ste
                doma, na ceste, alebo na vyst√∫pen√≠.
              </p>

              <p>
                Pri tvorbe sme dbali na ka≈æd√Ω detail ‚Äì od grafick√©ho spracovania
                a≈æ po logick√∫ postupnos≈• lekci√≠ ‚Äì aby bolo uƒçenie r√Ωchle,
                z√°bavn√© a motivuj√∫ce. Ver√≠me, ≈æe pr√°ve vƒèaka tejto knihe
                objav√≠te nielen kr√°su helig√≥nky, ale aj rados≈• z hrania.
              </p>
            </div>
          </transition>

          <!-- CTA pod rozbalen√Ωm textom -->
          <div class="book-ctas">
            <button
              type="button"
              class="button book-more"
              @click="toggleBook"
              :aria-expanded="showMoreBook"
            >
              {{ showMoreBook ? "Zobrazi≈• menej" : "Zobrazi≈• viac" }}
            </button>
            <router-link to="/helishop" class="button book-buy">
              Zak√∫pi≈• knihu
            </router-link>
          </div>
        </div>
      </section>
    </div>
  </div>
</template>

<script>
import { ref, onMounted, nextTick, computed } from "vue";
import { useRoute, useRouter } from "vue-router";
import { useStore } from "vuex";

import TheHeadline from "@/components/Menu/TheHeadline.vue";
import NewsList from "@/components/ucebna/NewsList.vue";
import { tour } from "@/components/Navigacia/tour/tour";

export default {
  name: "DomovStranka",
  components: { TheHeadline, NewsList },

  metaInfo() {
    return {
      title: "Modern√Ω sp√¥sob uƒçenia sa hry na helig√≥nku üé∂",
      meta: [
        {
          name: "description",
          content:
            "Online kurzy, ƒç√≠seln√© z√°pisy a v√Ωuƒçbov√© materi√°ly pre zaƒçiatoƒçn√≠kov aj pokroƒçil√Ωch.",
        },
        { property: "og:url", content: "https://heligonkovaakademia.sk" },
        { property: "og:type", content: "website" },
        {
          property: "og:title",
          content: "Modern√Ω sp√¥sob uƒçenia sa hry na helig√≥nku üé∂",
        },
        {
          property: "og:description",
          content:
            "Online kurzy, ƒç√≠seln√© z√°pisy a v√Ωuƒçbov√© materi√°ly pre zaƒçiatoƒçn√≠kov aj pokroƒçil√Ωch.",
        },
        {
          property: "og:image",
          content:
            "https://opengraph.b-cdn.net/production/images/d86c7af9-25eb-492e-b01e-7aec94925f79.png?token=Tn2HJOo9yWewlnuQB6Vhpmm6EQI5Hg_kNyN3XNtizyw&height=630&width=1199&expires=33277902256",
        },
        { name: "twitter:card", content: "summary_large_image" },
        { property: "twitter:domain", content: "heligonkovaakademia.sk" },
        { property: "twitter:url", content: "https://heligonkovaakademia.sk" },
        {
          name: "twitter:title",
          content: "Modern√Ω sp√¥sob uƒçenia sa hry na helig√≥nku üé∂",
        },
        {
          name: "twitter:description",
          content:
            "Online kurzy, ƒç√≠seln√© z√°pisy a v√Ωuƒçbov√© materi√°ly pre zaƒçiatoƒçn√≠kov aj pokroƒçil√Ωch.",
        },
        {
          name: "twitter:image",
          content:
            "https://opengraph.b-cdn.net/production/images/d86c7af9-25eb-492e-b01e-7aec94925f79.png?token=Tn2HJOo9yWewlnuQB6Vhpmm6EQI5Hg_kNyN3XNtizyw&height=630&width=1199&expires=33277902256",
        },
      ],
    };
  },

  setup() {
    const route = useRoute();
    const router = useRouter();
    const store = useStore();

    const showMoreBook = ref(false);
    const bookSection = ref(null);

    const toggleBook = async () => {
      const opening = !showMoreBook.value;
      showMoreBook.value = opening;

      if (opening) {
        await nextTick();
        setTimeout(() => {
          if (bookSection.value) {
            bookSection.value.scrollIntoView({
              behavior: "smooth",
              block: "end",
            });
          }
        }, 50);
      }
    };

    onMounted(() => {
      window.scrollTo(0, 0);
      checkId();
    });

    const startHomeTour = async () => {
      const doStart = async () => {
        await tour.start({
          mode: "full",
          startIndex: 0,
        });

        if (window.haTour?.start) {
          window.haTour.start(0);
        } else {
          try {
            window.dispatchEvent(
              new CustomEvent("ha.tour.start", { detail: { index: 0 } })
            );
          } catch (e) {
            console.error("Failed to dispatch tour start event", e);
          }
        }
      };

      if (window.__haTourReady) {
        await doStart();
      } else {
        const onReady = async () => {
          window.removeEventListener("ha.tour.ready", onReady);
          await doStart();
        };
        window.addEventListener("ha.tour.ready", onReady, { once: true });
      }
    };

    const isGuideButtonVisible = computed(() => !tour.state.open);

    function checkId() {
      const id = route.query.id;
      if (!id) return;

      setTimeout(() => {
        verifyId(id, "/subscription/paymentStatusSubscription.php/?id=");
      }, 500);

      setTimeout(() => {
        verifyId(id, "/cart/paymentStatus.php/?id=");
      }, 300);
    }

    function verifyId(id, path) {
      const axios = require("axios");
      axios
        .get(store.state.api + path + id)
        .then((response) => {
          const data = response.data?.data;
          if (!data) return;

          if (data.includes("PAID")) {
            router.push("/uspesny-nakup");
            store.dispatch("pouzivatelVlastneneProdukty");
            store.dispatch("pouzivatelAktivnePredplatne");
          } else if (!data.includes("gopay_id not found")) {
            router.push("/neuspesny-nakup");
          }
        })
        .catch((err) => console.error(err));
    }

    return {
      showMoreBook,
      toggleBook,
      bookSection,
      startHomeTour,
      isGuideButtonVisible,
    };
  },
};
</script>

<style lang="scss" scoped>
@import "@/assets/sass/_colors.scss";

/* existuj√∫ci ≈°t√Ωl ‚Äì nemen√≠m ≈°trukt√∫ru */
.right img {
  position: absolute;
  bottom: 0;
  right: -3vw;
  width: auto;
  height: 36vw;
  max-height: 35em;
  filter: drop-shadow(10px 2px 4px rgba(0, 0, 0, 0.5));
}

h5 {
  margin: 2em 2em !important;
}

:deep(h5.no-default) {
  font-size: 1.6vw;
  margin: 0.8em 2em 0.6em !important;
  font-weight: 550;
}

.right {
  position: relative;
  width: 40%;
}
.left {
  width: 90%;
}

.guide-tour-button {
  position: absolute;
  right: 1.5rem;
  bottom: 1.5rem;
  justify-content: center;
  padding: 0.35em 1.25em;
  font-size: 1.35em;
  line-height: 1;
  z-index: 2;
}

.guide-tour-button__icon {
  display: block;
  font-family: Adumu;
  font-size: 1em;
  letter-spacing: 0;
  line-height: 1;
}

section {
  display: flex;
  flex-direction: row;
  align-items: stretch;
  height: auto;
  padding: 0;
  z-index: 5;
}

.box-main {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-end;
  gap: 4%;
  transition-duration: 0.3s;

  img {
    width: 14em;
    height: 14em;
    object-fit: contain;
    z-index: 1;
    filter: drop-shadow(4px 4px 4px rgba(0, 0, 0, 0.25));
  }
  &:not(.not-this):nth-child(2) > img {
    transform: scale(1.1) translate(0.9em, -0.5em);
  }
  &:hover {
    transform: scale(1.15);
    transition-duration: 0.1s;
  }
}

.second {
  justify-content: space-around;
  height: 6em;
  margin-top: auto;
  padding: 0.5em;
  p {
    color: #000;
    text-align: center;
    font-size: 1.65em;
    font-style: normal;
    font-weight: 600;
    line-height: 130%;
    letter-spacing: 0.04em;
  }
}

.button {
  margin-bottom: 2%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.buttons-group {
  font-size: 0.7vw;
  text-align: center;
  display: flex;
  justify-content: center;
  gap: 2em;
  margin: 1.5em 0 2em;
  width: auto;
}

.botton {
  padding: 0.5em 1.1em 0.5em;
  border-radius: 0.8625em;
}

@media screen and (max-width: 1600px) {
  .left {
    width: 70%;
  }
}
@media screen and (max-width: 1030px), (max-height: 730px) {
  body {
    font-size: 70%;
  }
}
@media screen and (max-width: 920px), (max-height: 640px) {
  body {
    font-size: 60%;
  }
}
@media screen and (max-width: 1000px) {
  .box-item:first-child {
    margin-bottom: 2em;
  }
}

@media screen and (max-width: 768px) {
  .right {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
  }

  .guide-tour-button {
    position: static;
    margin-top: 1.25rem;
    align-self: flex-end;
  }
}

@media screen and (max-width: 950px) {
  .second {
    font-size: 70%;
  }
  .buttons-group {
    display: flex;
    flex-direction: column;
    gap: 1em;
    font-size: 0.7em;
    margin: 2.5em auto;
  }
  :deep(h5.no-default) {
    font-size: 2.2vw;
    margin: 1em 1em !important;
  }
  :deep(h1.no-default) {
    font-size: 6.5vw;
    padding: 0.5em 0 0;
  }
}

.mobile {
  display: none;
}
.computer {
  display: flex;
}

/* === JEDEN zjednoten√Ω blok pre max-width: 750px === */
@media screen and (max-width: 750px) {
  .mobile {
    display: flex !important;
  }
  .computer {
    display: none;
  }

  .left {
    width: 60%;
    padding: 2% 2%;
    margin-bottom: 2em;

    p {
      color: #575757;
      text-align: left;
      font-style: normal;
      font-size: 4vw;
      font-weight: 600;
      line-height: 130%;
      width: 70%;
      margin: 1.5em 2.5; /* p√¥vodn√© tvoje */
    }
  }

  /* rozlo≈æenie sekci√≠ tak ako doteraz */
  section:not(.mobile) {
    flex-direction: column;
  }

  section.mobile {
    font-size: 1.8vw; /* z 450-verzie */
    margin: 8em auto 0; /* z 450-verzie */
    a {
      width: 50%;
    }
  }

  /* obr√°zok vpravo ‚Äì nech sa spr√°va ako v 450-verzii */
  .right {
    width: 99%;
  }
  .right img {
    width: 47vw; /* z 450-verzie (odstr√°nen√° pevn√° height) */
    height: auto;
    filter: drop-shadow(5px 2px 3px rgba(0, 0, 0, 0.5));
  }

  /* veƒækos≈• tlaƒçidiel a medzery ako v 450-verzii */
  .button {
    font-size: 3vw;
  } /* z 450-verzie */
  .mobile section .button {
    margin: 0.5em;
  } /* z 450-verzie */

  /* sekcia s boxami */
  .second {
    font-size: 100%;
    height: 19vw; /* z 450-verzie ‚Äì nech boxy preƒçnievaj√∫ rovnako */
  }

  /* popisy pod obr√°zkami v boxoch ‚Äì zachovaj tesn√© medzery */
  .mobile section p {
    font-size: 3.2vw;
  } /* z 450-verzie */

  /* nadpisy */
  :deep(h1.no-default) {
    padding: 0.25em 0 0;
  } /* rovnak√© v oboch */
  :deep(h5.no-default) {
    font-size: 4vw; /* z prv√©ho 750-bloku (v√§ƒç≈°ie H5) */
    margin: 0.7em 1em 0 !important; /* tesnej≈°ie okraje z 450-verzie */
  }

  /* newslist */
  .mobile-newslist {
    margin: 2em auto 0;
  }
  .mobile-newslist .news-intro {
    font-size: 2.6vw;
    color: #575757;
    font-weight: 400;
    line-height: 130%;
    text-align: center;
    margin: 1.5em auto 0;
    width: 85%;
  }
}

/* --- Book block (mobil) --- */
.mobile-frstbook {
  margin: 2.2em auto 0;
  width: 100%;
  display: flex;
  justify-content: center;

  .book-card {
    width: 92%;
    padding: 1.5em 1.5em 1em;
  }

  .book-row {
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    column-gap: 0.8em;
  }

  .book-cover {
    width: 22vw;
    max-width: 120px;
    height: auto;
    object-fit: contain;
    border-radius: 0.6em;
    filter: drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.25));
  }

  .book-text {
    display: flex;
    flex-direction: column;
    gap: 0.35em;
  }

  .book-title {
    font-family: "Bahnschrift", sans-serif;
    font-size: 3.8vw;
    line-height: 1.2;
    font-weight: 400;
    margin: 0;
    color: #000;
    text-align: left;
  }
  .book-lead {
    color: #575757;
    font-size: 3.2vw;
    line-height: 1.35;
    margin: 0;
    text-align: left;
  }

  /* rozbalen√Ω text pod riadkom */
  .book-more-content {
    text-align: center;

    p {
      color: #575757;
      font-size: 3.2vw;
      line-height: 1.4;
      margin: 0.7em auto;
      width: 90%;
    }

    .book-points-wrapper {
      text-align: left;
      margin: 0.8em auto;
      width: 85%;
    }

    .points-title {
      margin-bottom: 0.4em;
      font-weight: bold;
      color: #575757;
    }

    .book-points {
      margin: 0;
      padding-left: 1.2em;
      li {
        margin-bottom: 0.4em;
        list-style-type: disc;
        color: #575757;
        font-size: 3.2vw;
        line-height: 1.4;
      }
    }
  }

  /* CTA s√∫ POD rozbalen√Ωm textom */
  .book-ctas {
    display: flex;
    gap: 0.6em;
    margin-top: 0.5em;
    align-items: center;
    justify-content: center;

    .button {
      font-size: 2.5vw;
      font-family: "Adumu";
      padding: 0.55em 1em;
      border-radius: 1.8em;
      box-shadow: 3px 3px 3px 0 rgba(0, 0, 0, 0.25);
      border: none;
      cursor: pointer;
      transition: transform 0.15s ease;
      white-space: nowrap;
      -webkit-text-fill-color: #000;
      &:active {
        transform: scale(0.98);
      }
    }
    .book-buy {
      background: #fef35a;
      color: #000;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
    }
  }
}

/* rovnak√° anim√°cia ako NewsList */
.fade-slide-enter-active,
.fade-slide-leave-active {
  transition: all 0.35s ease;
}
.fade-slide-enter-from {
  opacity: 0;
  transform: translateY(-8px);
}
.fade-slide-leave-to {
  opacity: 0;
  transform: translateY(-8px);
}

/* drobn√Ω tuning pre u≈æ≈°ie mobily */
@media (max-width: 380px) {
  .mobile-frstbook .book-ctas .button {
    font-size: 3.8vw;
  }
}
</style>
