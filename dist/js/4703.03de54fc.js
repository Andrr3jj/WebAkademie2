"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[4703],{1164:function(t,e,a){a.d(e,{Z:function(){return c}});var s=a(3396),r=a(7139);function i(t,e,a,i,o,n){return(0,s.wg)(),(0,s.iD)("span",{class:"sort-arrow",onClick:e[0]||(e[0]=(...t)=>n.toggleSort&&n.toggleSort(...t))},[((0,s.wg)(),(0,s.iD)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.7em",height:"0.7em",viewBox:"0 0 14 12",class:(0,r.C_)(["triangle-icon",n.rotationClass])},e[1]||(e[1]=[(0,s._)("path",{d:"M13.7814 2.28223C14.0658 1.81973 14.0752 1.23848 13.8095 0.766602C13.5439 0.294727 13.0439 0.000976574 12.5002 0.000976581L1.50015 0.000976612C0.956406 0.000976612 0.454801 0.294727 0.190776 0.766602C-0.0748491 1.23848 0.0623493 1.81973 0.218901 2.28223L5.7189 11.2822C5.99786 11.7917 6.47515 12.0015 7.00015 12.001C7.52515 12.001 8.0064 11.7291 8.2814 11.2822L13.7814 2.28223Z",fill:"black"},null,-1)]),2))])}var o={props:{column:String,sortKey:String,sortDirection:String},computed:{rotationClass(){return this.sortKey!==this.column?"neutral":"asc"===this.sortDirection?"rotate":""}},methods:{toggleSort(){let t="asc";this.sortKey===this.column&&"asc"===this.sortDirection?t="desc":this.sortKey===this.column&&"desc"===this.sortDirection&&(t=""),this.$emit("update:sort",{key:t?this.column:"",direction:t})}}},n=a(89);const l=(0,n.Z)(o,[["render",i],["__scopeId","data-v-93cbcb14"]]);var c=l},4703:function(t,e,a){a.r(e),a.d(e,{default:function(){return O}});var s=a(3396),r=a(7139),i=a(9242),o=a(3139);const n=["id"],l={class:"scroll"},c={key:0,class:"top-stats"},h=["onClick"],d={style:{width:"40%"}},u={style:{display:"flex","align-items":"center"}},m={style:{width:"20%","text-align":"center"}},p={style:{display:"flex","align-items":"center","justify-content":"center"}},y={style:{width:"10%","text-align":"center"}},g={style:{display:"flex","align-items":"center","justify-content":"center"}},D={style:{width:"20%"}},w={style:{display:"flex","align-items":"center","flex-direction":"column"}},v={style:{width:"30%"}},f={style:{display:"flex","align-items":"center","flex-direction":"column"}},k={style:{"text-align":"center"}},_={style:{"text-align":"center"}},z={style:{"text-align":"center"}},b={style:{"text-align":"center"}},S={key:0},M={key:1},N=["onClick"],C=["onClick"],K={key:0},x={colspan:"7",style:{"text-align":"center","vertical-align":"middle",height:"200px"}},P={class:"search"};function $(t,e,a,$,Z,j){const U=(0,s.up)("SortArrow"),A=(0,s.up)("MonthSwitcher");return Z.menoPouzivatela?((0,s.wg)(),(0,s.iD)("section",{key:0,id:t.$route.name},[(0,s._)("div",l,[e[16]||(e[16]=(0,s._)("h1",null,"Administratívny systém",-1)),(0,s._)("h5",null,[e[4]||(e[4]=(0,s.Uk)("Zoznam číselných ")),(0,s._)("span",{onClick:e[0]||(e[0]=t=>j.addOwnedNotes())},"z"),e[5]||(e[5]=(0,s.Uk)("ápisov"))]),e[17]||(e[17]=(0,s._)("div",{class:"line horizontal w-80"},null,-1)),j.isRestricted?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",c,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(j.allAuthors,(({norm:t,label:e})=>((0,s.wg)(),(0,s.iD)("span",{key:t,class:(0,r.C_)({active:Z.selectedNormAuthor===t}),onClick:e=>j.vyberAutora(t)},(0,r.zw)(e)+": "+(0,r.zw)(j.topStats[e]||0),11,h)))),128))])),e[18]||(e[18]=(0,s._)("div",{class:"line horizontal w-80"},null,-1)),(0,s._)("table",null,[(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",d,[(0,s._)("span",u,[e[6]||(e[6]=(0,s.Uk)(" Názov pesničky ")),(0,s.Wm)(U,{column:"name",sortKey:Z.sortKey,sortDirection:Z.sortDirection,"onUpdate:sort":j.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])])]),(0,s._)("th",m,[(0,s._)("span",p,[e[7]||(e[7]=(0,s.Uk)(" Autor ")),(0,s.Wm)(U,{column:"author",sortKey:Z.sortKey,sortDirection:Z.sortDirection,"onUpdate:sort":j.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])])]),(0,s._)("th",y,[(0,s._)("span",g,[e[8]||(e[8]=(0,s.Uk)(" Cena ")),(0,s.Wm)(U,{column:"price",sortKey:Z.sortKey,sortDirection:Z.sortDirection,"onUpdate:sort":j.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])])]),(0,s._)("th",D,[(0,s._)("div",w,[(0,s._)("div",null,[e[9]||(e[9]=(0,s.Uk)(" Predané: ")),(0,s.Wm)(U,{column:"soldNumber",sortKey:Z.sortKey,sortDirection:Z.sortDirection,"onUpdate:sort":j.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),e[10]||(e[10]=(0,s._)("small",null,"(Dokopy)",-1))])]),(0,s._)("th",v,[(0,s._)("div",f,[(0,s._)("div",null,[(0,s.Wm)(A,{month:Z.month,year:Z.year,sortKey:Z.sortKey,sortDirection:Z.sortDirection,"onUpdate:sort":j.updateSort,"onUpdate:month":e[1]||(e[1]=t=>Z.month=t),"onUpdate:year":e[2]||(e[2]=t=>Z.year=t)},null,8,["month","year","sortKey","sortDirection","onUpdate:sort"])])])]),e[11]||(e[11]=(0,s._)("th",{style:{width:"10%"}},null,-1)),e[12]||(e[12]=(0,s._)("th",{style:{width:"10%"}},null,-1))])]),(0,s._)("tbody",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(j.sortedData,((t,a)=>((0,s.wg)(),(0,s.iD)("tr",{key:t.id||a},[(0,s._)("td",null,[(0,s._)("strong",null,(0,r.zw)(j.sortedData.length-a)+".",1),(0,s.Uk)(" "+(0,r.zw)(t.name),1)]),(0,s._)("td",k,(0,r.zw)(t.author||"--"),1),(0,s._)("td",_,(0,r.zw)("number"===typeof t.price?t.price.toFixed(2)+"€":"--"),1),(0,s._)("td",z,(0,r.zw)(t.soldNumber),1),(0,s._)("td",b,[Z.predajeLoading?((0,s.wg)(),(0,s.iD)("span",S,"...")):((0,s.wg)(),(0,s.iD)("span",M,(0,r.zw)(t.soldThisMonth||0),1))]),(0,s._)("td",null,[(0,s._)("div",{onClick:e=>j.upravenieZapisu(t.id),class:"button"},e[13]||(e[13]=[(0,s._)("a",null,"Upraviť",-1)]),8,N)]),(0,s._)("td",null,[(0,s._)("div",{onClick:e=>j.zmazanieZapisu(t.id),title:"Vymazať",class:"red-button button"},e[14]||(e[14]=[(0,s._)("a",null,"X",-1)]),8,C)])])))),128)),0===j.sortedData.length?((0,s.wg)(),(0,s.iD)("tr",K,[(0,s._)("td",x,(0,r.zw)(j.noResultsMessage),1)])):(0,s.kq)("",!0)])]),(0,s._)("div",P,[e[15]||(e[15]=(0,s._)("img",{src:o,alt:"Vyhladanie"},null,-1)),(0,s.wy)((0,s._)("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>Z.search=t),type:"text",placeholder:"Vyhľadať pieseň",class:"search-input"},null,512),[[i.nr,Z.search]])])])],8,n)):(0,s.kq)("",!0)}a(560);const Z={class:"month-switcher"},j={class:"controls"};function U(t,e,a,i,o,n){return(0,s.wg)(),(0,s.iD)("div",Z,[e[2]||(e[2]=(0,s._)("div",{class:"label"},"Predané:",-1)),(0,s._)("div",j,[(0,s._)("button",{onClick:e[0]||(e[0]=t=>n.changeMonth(-1))},"◀"),(0,s._)("small",null,"("+(0,r.zw)(n.formattedDate)+")",1),(0,s._)("button",{onClick:e[1]||(e[1]=t=>n.changeMonth(1))},"▶")])])}var A={props:{sortKey:String,sortDirection:String,month:Number,year:Number},data(){return{currentDate:this.createDateFromProps()}},computed:{formattedDate(){const t=String(this.currentDate.getMonth()+1).padStart(2,"0"),e=this.currentDate.getFullYear();return`${t}.${e}`},soldMonthValue(){const t=String(this.currentDate.getMonth()+1).padStart(2,"0"),e=this.currentDate.getFullYear();return`${e}-${t}`}},watch:{month(t){t&&this.currentDate.getMonth()+1!==t&&(this.currentDate=new Date(this.year||(new Date).getFullYear(),t-1))},year(t){t&&this.currentDate.getFullYear()!==t&&(this.currentDate=new Date(t,(this.month||1)-1))}},mounted(){this.currentDate=this.createDateFromProps(),this.emitMonthYear()},methods:{createDateFromProps(){const t=this.year||(new Date).getFullYear(),e=this.month?this.month-1:(new Date).getMonth();return new Date(t,e)},emitMonthYear(){this.$emit("update:month",this.currentDate.getMonth()+1),this.$emit("update:year",this.currentDate.getFullYear())},changeMonth(t){const e=new Date(this.currentDate);e.setMonth(e.getMonth()+t),this.currentDate=e,this.emitMonthYear(),this.$emit("update:sort",{column:"soldMonth",value:this.soldMonthValue})}}},L=a(89);const q=(0,L.Z)(A,[["render",U],["__scopeId","data-v-c27dd3e2"]]);var F=q,T=a(1164);function Y(t){return(t||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim()}var B={components:{SortArrow:T.Z,MonthSwitcher:F},mounted(){window.scrollTo(0,0),this.ziskajPrihlasenehoPouzivatela().then((()=>{this.nacitajZapisy()}))},data(){return{data:[],predane:{},search:"",addNumber:0,sortKey:"",sortDirection:"",menoPouzivatela:"",restrictedNames:["Matej Kondela","Libor Hliník"],selectedNormAuthor:"",year:(new Date).getFullYear(),month:(new Date).getMonth()+1,predajeLoading:!1}},computed:{noResultsMessage(){const t=this.search.trim();return t?`Nebola nájdená žiadna pieseň pre “${t}”`:this.selectedNormAuthor?`Autor “${this.selectedNormAuthor}” nemá žiadne piesne`:"Nie sú tu žiadne záznamy"},isRestricted(){return!!this.menoPouzivatela.trim()&&this.restrictedNames.includes(this.menoPouzivatela.trim())},authorsMap(){const t={};return this.data.forEach((e=>{if(!e.author)return;const a=Y(e.author);t[a]||(t[a]=e.author.trim())})),t},allAuthors(){return Object.entries(this.authorsMap).map((([t,e])=>({norm:t,label:e})))},topStats(){const t={},e={};this.data.forEach((a=>{if(!a.author)return;const s=Y(a.author),r=a.author.trim();if(e[s]=r,this.isRestricted){const t=Y(this.menoPouzivatela);if(s!==t)return}t[s]=(t[s]||0)+1}));const a={};for(const[s,r]of Object.entries(t))a[e[s]]=r;return a},filteredData(){const t=t=>String(t||"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim();let e=this.data.slice();if(this.isRestricted){const a=t(this.menoPouzivatela);e=e.filter((e=>e.author&&t(e.author)===a))}if(this.selectedNormAuthor&&(e=e.filter((e=>e.author&&t(e.author)===this.selectedNormAuthor))),this.search){const a=t(this.search);e=e.filter((e=>e.name&&t(e.name).includes(a)||e.author&&t(e.author).includes(a)))}return e.reverse()},sortedData(){const t=this.filteredData;return this.sortKey&&this.sortDirection?[...t].sort(((t,e)=>{let a=t[this.sortKey],s=e[this.sortKey];return"name"!==this.sortKey&&"author"!==this.sortKey||(a=String(a).trim(),s=String(s).trim()),"number"===typeof a&&"number"===typeof s?"asc"===this.sortDirection?a-s:s-a:"asc"===this.sortDirection?String(a).localeCompare(String(s),"sk",{sensitivity:"base"}):String(s).localeCompare(String(a),"sk",{sensitivity:"base"})})):t}},methods:{async ziskajPrihlasenehoPouzivatela(){const t=a(7218);try{const e=await t.get("https://heligonkovaakademia.sk/api/user/info/getAdditionalInformation.php");if("Request succesfull"===e.data.status){const t=e.data.data;this.menoPouzivatela=`${t.name} ${t.surname}`.trim()}}catch(e){}},addOwnedNotes(){if(5===this.addNumber){const t=a(7218),e=a(6237);let s=new e,r={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/product/addAllToOwned.php",data:s};t.request(r).then((()=>{this.$store.state.SnackBarText="Pššt 🤫 pridal som ti všetky čísené zápisy 😉"})).catch((()=>{this.$store.state.SnackBarText="Nebolo ti súdené dostať zápisy, skús nabudúce"}))}else this.addNumber++},nacitajZapisy(){const t=a(7218);let e={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/product/stats/listZapis.php"};t.request(e).then((t=>{"Request succesfull"===t.data.status?(this.data=(t.data.data||[]).map((t=>{let e="";try{if(t.details){const a=JSON.parse(t.details);e=a.autor||""}}catch(s){}let a=null;return void 0===t.price||null===t.price||isNaN(Number(t.price))||(a=Number(t.price)),{...t,author:(e||"").trim(),price:a}})),this.statistikaJednotlivoPredanych(),this.nacitajPredaneZaMesiac()):this.data=[]})).catch((t=>{this.data=[]}))},async nacitajPredaneZaMesiac(){const t=a(7218);this.predajeLoading=!0,this.data=this.data.map((t=>({...t,soldThisMonth:0})));const e=this.data.map((async e=>{try{const a=await t.get(`${this.$store.state.api}/product/stats/listZapisPredaneMesiac.php`,{params:{id:e.id,year:this.year,month:this.month}});if("Request succesfull"===a.data.status)return{id:e.id,soldThisMonth:a.data.data}}catch(a){return{id:e.id,soldThisMonth:0}}})),s=await Promise.all(e);this.data=this.data.map((t=>{const e=s.find((e=>e.id===t.id));return{...t,soldThisMonth:e?e.soldThisMonth:0}})),this.predajeLoading=!1},upravenieZapisu(t){this.$router.push({path:"/admin/pridanie-zapisu",query:{id:t}})},vyberAutora(t){this.selectedNormAuthor=this.selectedNormAuthor===t?"":t},zmazanieZapisu(t){const e=this.data.find((e=>e.id===t));if(this.jeObycajnyAutor){const t=e?.author?.trim()?.toLowerCase()||"",a=this.menoPouzivatela?.trim()?.toLowerCase()||"";if(t!==a)return void alert("Nemáte oprávnenie vymazať tento číselný zápis.")}if(confirm("Naozaj chcete vymazať tento číselný zápis?")){const e=a(7218),s=a(6237);let r=new s,i={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/product/delete.php/?id="+t,data:r};e.request(i).then((t=>{"Request fullfiled"==t.data.status?(this.$store.state.SnackBarText="Zápis bol vymazaný.",this.nacitajZapisy()):this.$store.state.SnackBarText="Zápis sa nepodarilo vymazať."})).catch((t=>{this.$store.state.SnackBarText="Nastala chyba pri mazaní zápisu."}))}},statistikaJednotlivoPredanych(){const t=a(7218),e=a(6237);let s=new e,r={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/order/stats/soldByProductCiselneZapisy.php",data:s};t.request(r).then((t=>{"Request succesfull"===t.data.status&&(this.predane=t.data.data);const e=t=>t.map((t=>({...t,soldNumber:this.predane[t.name]||0})));this.data=e(this.data)})).catch((function(){}))},updateSort({key:t,direction:e}){this.sortKey=t,this.sortDirection=e}},watch:{month(){this.nacitajPredaneZaMesiac()},year(){this.nacitajPredaneZaMesiac()}}};const R=(0,L.Z)(B,[["render",$],["__scopeId","data-v-22df071e"]]);var O=R},3139:function(t,e,a){t.exports=a.p+"img/hladanie.697b6243.svg"}}]);