"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[4368],{4368:function(t,e,a){a.r(e),a.d(e,{default:function(){return I}});var s=a(3396),n=a(7139),i=a(9242);const d={class:"formular"},u={key:0,class:"dual"},l={class:"student-switch"},c={key:1,class:"meno"},o={class:"pridanie"},r={class:"boxik forma"},h={class:"dochadzka"},p={class:"dochadzka"},v={class:"dochadzka ucitel"},m={class:"boxik"},_=["placeholder"],k={class:"stars",role:"radiogroup","aria-label":"Hodnotenie hviezdičkami"},f=["aria-checked","onClick","title"],y=["src","alt"],S={key:2,class:"save-message"};function g(t,e,a,g,A,M){return(0,s.wg)(),(0,s.iD)("div",d,[(0,s._)("h5",null,"Zhrnutie dnešnej "+(0,n.zw)(M.dual?"duo":"sólo")+" lekcie",1),M.dual?((0,s.wg)(),(0,s.iD)("div",u,[(0,s._)("div",l,[(0,s._)("button",{type:"button",class:(0,n.C_)(["option",{active:1===A.activeStudent}]),onClick:e[0]||(e[0]=t=>M.setActive(1))},(0,n.zw)(M.name),3),(0,s._)("button",{type:"button",class:(0,n.C_)(["option",{active:2===A.activeStudent}]),onClick:e[1]||(e[1]=t=>M.setActive(2))},(0,n.zw)(M.name2),3)])])):((0,s.wg)(),(0,s.iD)("p",c,(0,n.zw)(M.activeStudentName),1)),e[12]||(e[12]=(0,s._)("p",{class:"text"}," Vyplň, ako prebehla dnešná lekcia. Zaznač dochádzku, hodnotenie a pridaj piesne alebo poznámku. ",-1)),(0,s._)("div",o,[(0,s._)("div",r,[e[10]||(e[10]=(0,s._)("p",{class:"nadpis"},"Dochádzka žiaka:",-1)),(0,s._)("div",h,[(0,s._)("div",{onClick:e[2]||(e[2]=t=>M.dochadzka=!1),class:(0,n.C_)([{active:!1===M.dochadzka},"button"])},e[8]||(e[8]=[(0,s._)("p",null,"Absolvoval",-1)]),2)]),(0,s._)("div",p,[(0,s._)("div",{onClick:e[3]||(e[3]=t=>M.dochadzka=!0),class:(0,n.C_)([{active:!0===M.dochadzka},"button"])},e[9]||(e[9]=[(0,s._)("p",null,"Neabsolvoval",-1)]),2)]),(0,s._)("div",v,[(0,s._)("div",{onClick:e[4]||(e[4]=t=>M.dochadzka=null),class:(0,n.C_)({active:null===M.dochadzka})},[(0,s._)("p",null,(0,n.zw)(null===M.dochadzka?"Hodina zrušená učiteľom":"Zrušiť žiakovi lekciu"),1)],2)])]),(0,s._)("div",m,[e[11]||(e[11]=(0,s._)("p",{class:"nadpis"},"Poznámka k hodine:",-1)),(0,s.wy)((0,s._)("textarea",{name:"poznámka",id:"poznamka",rows:"7","onUpdate:modelValue":e[5]||(e[5]=t=>M.noteText=t),placeholder:`Poznámka pre ${M.activeStudentName}`},null,8,_),[[i.nr,M.noteText]])])]),(0,s._)("div",k,[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)(5,(t=>(0,s._)("button",{key:t,type:"button",class:"star-btn","aria-checked":M.rating>=t,role:"radio",onClick:e=>M.setRating(t),onDblclick:e[6]||(e[6]=(0,i.iM)((t=>M.clearRating()),["stop","prevent"])),title:"Klik pre "+t+"★, dvojklik vymaže"},[(0,s._)("img",{src:M.rating>=t?A.filledStar:A.emptyStar,alt:`${t} hviezdička`},null,8,y)],40,f))),64))]),(0,s._)("div",{class:"button Adumu",onClick:e[7]||(e[7]=(...t)=>M.saveLesson&&M.saveLesson(...t))},"Zapísať"),A.saveMessage?((0,s.wg)(),(0,s.iD)("p",S,(0,n.zw)(A.saveMessage),1)):(0,s.kq)("",!0)])}a(8858),a(1318),a(3228);var A=a(1076),M=a(8494),b="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAgCAMAAABAUVr7AAAAAXNSR0IArs4c6QAAAGlQTFRFR3BMysrKvb294eHg0NDQ+e9m3d3d6Ojo5eXl19fXw8PD/vRa/vRatra2//Na//Nb//Nc5eCR1M+Q//NZ/vNa7uqt1dOz/vRa5eTH9e1/7ON0w8Gk/fNa/+9bxMOz//Ra/PJc/fRZ/vNa+otYjAAAACJ0Uk5TAO/w7u/+7u3t7vDfifFgu0D39yDv9fPP8fv79KAQ8jBQcIk76/cAAAFYSURBVHjahdLbboMwEEVRE+I2DcYGY+6XtOf/P7IzUwuBpdDNU6SVoxFCJdlQWHXZWgBhvSQW0wRzSQr4GeF6RJflBHs9UpYexT8jt5tGdTVC4lbDvRMVNIvn891M8+rhRWQ0UzXH/1qzuL4ApTcSWZbdwYXeLcbSnkFM68nTBIH7vR1HjZhRwOS9n2e54k98Sfeu6+p6ApSDnsuSgUyI+KCHUZZ1Gr1qCjJRCCAhsSFRNErMtk8IyDlCgwhq7cnIBAsGD3rIkOhXAtF0MiHiESPhREgLGSYi8l0s6pAB6iioT6oFi7MZmeQ5C26EUSmpIyHB1fhJiEN3Ji1cQgLo3iMZEM6igX5mPCNE0mhO5BsTEZoZxjaaETa9ll/vMALQLYtHC5NcO8vXhmAKRvzqknuBbas1sDRKWUF5jpB82J6AqxQXkcbrQF7ADnYEVOdze/l9RCGe+wvKqSPQ/dJLYgAAAABJRU5ErkJggg==",z={props:{summary:{type:Object,default:()=>({id:null,students:[]})},selectedDate:{type:String,default:""}},data(){return{activeStudent:1,filledStar:M,emptyStar:b,lessonId:null,lessonMeta:{},studentMap:{},saveMessage:""}},computed:{effectiveDate(){return this.selectedDate||this.summary.date||this.lessonMeta.date||""},dual(){return 2===this.summary.students.length},name(){return this.summary.students[0]?.name||"Žiak 1"},name2(){return this.summary.students[1]?.name||"Žiak 2"},activeStudentId(){return this.summary.students[this.activeStudent-1]?.id??null},activeStudentName(){return this.dual?1===this.activeStudent?this.name:this.name2:this.name},noteText:{get(){return this.studentMap[this.activeStudentId]?.info??""},set(t){this.activeStudentId&&(this.ensureStudent(this.activeStudentId),this.studentMap[this.activeStudentId].info=t)}},rating:{get(){return this.studentMap[this.activeStudentId]?.stars??0},set(t){this.activeStudentId&&(this.ensureStudent(this.activeStudentId),this.studentMap[this.activeStudentId].stars=t)}},dochadzka:{get(){return this.studentMap[this.activeStudentId]?.attendance_status??null},set(t){this.activeStudentId&&(this.ensureStudent(this.activeStudentId),this.studentMap[this.activeStudentId].attendance_status=t)}}},methods:{setActive(t){this.activeStudent=t},ensureStudent(t){this.studentMap[t]||this.$set(this.studentMap,t,{student_id:t,stars:0,note:"",info:"",attendance_status:null,played:0})},async fetchLesson(){try{const t=`${this.$store.state.api}/edupage/loadLesson.php?calendar_id=${this.summary.id}`,e=this.effectiveDate?`${t}&date=${encodeURIComponent(this.effectiveDate)}`:t,{data:a}=await A["default"].get(e),s=Array.isArray(a?.data)?a.data:[],n=s.reduce(((t,e)=>t?+e.id>+t.id?e:t:e),null);if(!n){this.lessonId=null,this.lessonMeta={calendar_id:this.summary.id,teacher_id:this.summary.teacher_id||"",date:this.effectiveDate||"",hour:this.summary.hour||"",status:this.summary.status||"planned"};const t={};for(const e of this.summary.students)t[e.id]={student_id:e.id,stars:0,note:"",info:"",attendance_status:null,played:0};return void(this.studentMap=t)}this.lessonId=+n.id,this.lessonMeta={calendar_id:n.calendar_id,teacher_id:n.teacher_id,date:n.date,hour:n.hour,status:n.status};let i=[];try{i=JSON.parse(n.student||"[]")}catch{i=[]}const d={};for(const u of i)u&&u.student_id&&(d[u.student_id]={student_id:+u.student_id,stars:+u.stars||0,note:u.note||"",info:u.info||"",attendance_status:u.attendance_status??null,played:+u.played||0});for(const u of this.summary.students)d[u.id]||(d[u.id]={student_id:u.id,stars:0,note:"",info:"",attendance_status:null,played:0});this.studentMap=d}catch(t){this.lessonId=null,this.lessonMeta={calendar_id:this.summary.id,teacher_id:this.summary.teacher_id||"",date:this.effectiveDate||"",hour:this.summary.hour||"",status:this.summary.status||"planned"};const e={};for(const a of this.summary.students)e[a.id]={student_id:a.id,stars:0,note:"",info:"",attendance_status:null,played:0};this.studentMap=e}},setRating(t){this.rating=t},clearRating(){this.rating=0},async saveLesson(){const t=Object.values(this.studentMap).map((t=>({student_id:t.student_id,stars:t.stars||0,note:t.note||"",info:t.info||"",attendance_status:t.attendance_status??null,played:t.played||0}))),e=this.studentMap[this.activeStudentId]||null;let a=this.lessonMeta.status||this.summary.status||"planned";e&&(!1===e.attendance_status?a="absolved":!0===e.attendance_status?a="cancelled_parent":null===e.attendance_status&&(a="cancelled_admin"));const s=new URLSearchParams;s.append("id",String(this.lessonId)),s.append("calendar_id",String(this.lessonMeta.calendar_id??"")),s.append("teacher_id",String(this.lessonMeta.teacher_id||this.summary.teacher_id||"")),s.append("student",JSON.stringify(t)),s.append("date",String(this.effectiveDate||"")),s.append("hour",String(this.lessonMeta.hour||this.summary.hour||"")),s.append("status",a);try{const t=`${this.$store.state.api.replace(/\/+$/,"")}/edupage/editLesson.php`,e=await A["default"].post(t,s,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});"Request succesfull"===e.data?.status?this.saveMessage="Lekcia bola úspešne hodnotená.":this.saveMessage="Nepodarilo sa uložiť lekciu."}catch(n){this.saveMessage="Chyba pri ukladaní lekcie."}}},watch:{summary:{immediate:!0,deep:!0,async handler(t){t?.students?.length&&(this.activeStudent=1,await this.fetchLesson())}}}},w=a(89);const C=(0,w.Z)(z,[["render",g],["__scopeId","data-v-20ee94d7"]]);var I=C}}]);