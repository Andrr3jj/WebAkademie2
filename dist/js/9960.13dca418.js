"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[9960],{9960:function(e,t,a){a.r(t),a.d(t,{default:function(){return Q}});var n=a(3396),s=a(7139);const i=["id"],o={class:"scroll"},r={class:"teachers_counts"},l=["onClick"];function d(e,t,a,d,c,u){const p=(0,n.up)("KalendarDatumHeader"),m=(0,n.up)("AdminPlatobnePrikazy");return(0,n.wg)(),(0,n.iD)("section",{class:"computer zapisy",id:e.$route.name},[(0,n._)("div",o,[t[0]||(t[0]=(0,n._)("h1",null,"Platobné príkazy",-1)),(0,n.Wm)(p,{showFilter:c.showFilter,showAllFilter:!0,showDays:!0,"hide-days":!0,allowedDaysFull:c.povoleneDni,allowedTimesByDay:c.povoleneCasyPodlaDna,onDayChanged:u.onDayChanged,onDateChanged:u.onDateChanged,onMonthChanged:u.onMonthChanged},null,8,["showFilter","allowedDaysFull","allowedTimesByDay","onDayChanged","onDateChanged","onMonthChanged"]),((0,n.wg)(),(0,n.j4)(m,{month:c.currentMonth,year:c.currentYear,teacherId:c.selectedTeacher,day:c.currentDay,key:c.currentDay+"-"+c.currentMonth+"-"+c.currentYear+"-"+c.selectedTeacher},null,8,["month","year","teacherId","day"])),(0,n._)("div",r,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(c.teachers,(e=>((0,n.wg)(),(0,n.iD)("p",{key:e.id,class:(0,s.C_)({selected:c.selectedTeacher===e.id}),onClick:t=>u.selectTeacher(e.id)},(0,s.zw)(e.name)+": "+(0,s.zw)(e.count),11,l)))),128))])])],8,i)}a(560);var c=a(9242),u=a(7893),p=a(223),m=a(4229);const h={class:"platby"},y={class:"table"},_={class:"thead grid-platby"},g={class:"th th-summary"},v={class:"th th-prikaz"},b=["disabled"],w={key:0,class:"empty-state"},f=["onClick","onMouseenter"],S={class:"cell col-index"},k={class:"cell col-student"},C={class:"avatar-wrap"},N=["src"],P={class:"meta"},D={class:"name"},$={class:"time"},q={class:"cell col-carry"},R={class:"currency"},A=["onUpdate:modelValue","onChange","data-payment-id"],T=["value"],F=["disabled","onClick"],M=["disabled","onClick"],z={class:"cell col-lekcie"},I={class:"num"},L={class:"num"},O={class:"num"},j={class:"cell col-paid"},x=["disabled","onClick"];function U(e,t,a,i,o,r){return(0,n.wg)(),(0,n.iD)("div",h,[(0,n._)("div",y,[(0,n._)("div",_,[t[5]||(t[5]=(0,n._)("div",{class:"th th-index"},null,-1)),(0,n._)("div",g,(0,s.zw)(r.summaryText),1),t[6]||(t[6]=(0,n._)("div",{class:"th th-carry"},"Preplatok z minulého mesiaca",-1)),(0,n._)("div",v,[t[4]||(t[4]=(0,n._)("span",null,"Platobný príkaz",-1)),(0,n._)("button",{class:"button",onClick:t[0]||(t[0]=(...e)=>r.sendAll&&r.sendAll(...e)),disabled:o.sendingAll||o.rows.every((e=>r.isRequestSent(e)))}," Odoslať ",8,b)]),t[7]||(t[7]=(0,n.uE)('<div class="th th-spacer" data-v-7b00204a></div><div class="th th-abs" data-v-7b00204a>Absolvované lekcie</div><div class="th th-inv" data-v-7b00204a>Neabsolvované lekcie</div><div class="th th-canc" data-v-7b00204a>Zrušené lekcie</div><div class="th th-paid" data-v-7b00204a>Uhradený mesiac</div>',5))]),0===o.rows.length?((0,n.wg)(),(0,n.iD)("div",w," Na tento deň nie sú žiadne lekcie. ")):(0,n.kq)("",!0),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(o.rows,((e,a)=>((0,n.wg)(),(0,n.iD)("div",{key:e.id,class:(0,s.C_)(["platba-row grid-platby",{"row-alt":a%2===1,active:o.activeRow===e.id}]),onClick:t=>r.toggleRow(e.id),onMouseenter:t=>o.hoveredRow=e.id,onMouseleave:t[3]||(t[3]=e=>o.hoveredRow=null)},[(0,n._)("div",S,(0,s.zw)(a+1)+".",1),(0,n._)("div",k,[(0,n._)("div",{class:(0,s.C_)(["student-card","duo"===e.mode?"duo":"solo"])},[(0,n._)("div",C,[(0,n._)("img",{class:"avatar",src:e.avatar,alt:""},null,8,N)]),(0,n._)("div",P,[(0,n._)("div",D,(0,s.zw)(e.name),1),(0,n._)("div",$,"Začiatok hodiny:  "+(0,s.zw)(e.time),1)])],2)]),(0,n._)("div",q,[(0,n._)("span",R,(0,s.zw)(r.money(e.carryOver)),1)]),(0,n._)("div",{class:"cell col-prikaz",onClick:t[1]||(t[1]=(0,c.iM)((()=>{}),["stop"]))},[(0,n.wy)((0,n._)("select",{class:(0,s.C_)(["native select-pill","duo"===e.mode?"duo":"solo"]),"onUpdate:modelValue":t=>e.fee=t,onChange:t=>r.onFeeChange(e),"data-payment-id":e.payment_id||""},[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(r.feeOptions(e),(e=>((0,n.wg)(),(0,n.iD)("option",{key:e.value,value:e.value},(0,s.zw)(e.label),9,T)))),128))],42,A),[[c.bM,e.fee,void 0,{number:!0}]]),(0,n._)("button",{class:(0,s.C_)(["icon-square icon-mail",{"disabled-mail":r.isRequestSent(e)}]),disabled:r.isRequestSent(e),onClick:t=>r.isRequestSent(e)?null:r.send(e),"aria-label":"Odoslať"},t[8]||(t[8]=[(0,n._)("img",{src:u,alt:""},null,-1)]),10,F)]),(0,n._)("div",{class:"cell col-spacer",onClick:t[2]||(t[2]=(0,c.iM)((()=>{}),["stop"]))},[o.activeRow!==e.id&&o.hoveredRow!==e.id||!r.isRequestSent(e)?(0,n.kq)("",!0):((0,n.wg)(),(0,n.iD)("button",{key:0,class:(0,s.C_)(["icon-square icon-bell",{"disabled-mail":r.isNoticeSent(e)}]),disabled:r.isNoticeSent(e),"aria-label":"Pripomenúť nezaplatené",onClick:t=>r.isNoticeSent(e)?null:r.remind(e)},t[9]||(t[9]=[(0,n._)("img",{src:p,alt:""},null,-1)]),10,M))]),(0,n._)("div",z,[(0,n._)("div",{class:(0,s.C_)(["bar bar-wide","duo"===e.mode?"duo":"solo"])},[(0,n._)("span",I,(0,s.zw)(e.countAbsolvedLessons),1),(0,n._)("span",L,(0,s.zw)(e.countParentCancelledLesson),1),(0,n._)("span",O,(0,s.zw)(e.countAdminCancelledLesson),1)],2)]),(0,n._)("div",j,[(0,n._)("button",{class:(0,s.C_)(["pill paid",{off:!e.paid,glow:0===Number(e.paidSum)}]),disabled:r.isPaidLocked(e),onClick:(0,c.iM)((t=>r.handlePaidClick(e)),["stop"])},t[10]||(t[10]=[(0,n._)("img",{src:m,alt:""},null,-1)]),10,x)])],42,f)))),128))])])}a(8858),a(1318),a(3228);var J={name:"AdminPlatobnePrikazy",mounted(){this.testApi()},watch:{day(e,t){this.testApi()},month(e,t){this.testApi()},year(e,t){this.testApi()},teacherId(e,t){this.testApi()}},props:{day:{type:[Number,String],required:!0},month:{type:Number,required:!0},year:{type:Number,required:!0},teacherId:{type:String,required:!0}},data(){return{lessonsPerMonth:4,remindBeforeDays:3,remindAfterDays:1,activeRow:null,hoveredRow:null,sendingAll:!1,rows:[],apiTestResult:"",apiLessonCount:0}},computed:{monthName(){const e=["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"];return`${e[this.month-1]} ${this.year}`},totalFee(){return this.rows.reduce(((e,t)=>e+Number(t.fee||0)),0)},summaryText(){const e=16*this.apiLessonCount,t=14*this.apiLessonCount;return`V mesiaci ${this.monthName} sú ${this.apiLessonCount} lekcie (solo: ${e}€ / duo: ${t}€)`}},methods:{money(e){return`${Number(e).toFixed(0)}€`},feeOptions(e){const t="duo"===e.mode?14:16,a=8,n=[];for(let i=1;i<=a;i++){const e=t*i;n.push({value:e,label:`${e}€`})}const s=Number(e.fee||0);return s&&!n.some((e=>e.value===s))&&n.push({value:s,label:`${s}€`}),n},async sendAll(){if(!this.sendingAll){this.sendingAll=!0;try{const e=this.rows.filter((e=>!this.isRequestSent(e)));if(0===e.length)return void(this.apiTestResult="Všetky platobné príkazy už boli odoslané.");let t=0;for(const a of e)await this.send(a),t++,await new Promise((e=>setTimeout(e,250)));this.apiTestResult=`Hromadné odoslanie hotové: ${t}/${e.length} adresátom.`}catch(e){this.apiTestResult=`Chyba pri hromadnom odosielaní: ${e}`}finally{this.sendingAll=!1}}},async send(e){try{e.__sendingRequest=!0;const t=await this.inquirePayment(e.id);if(!t.ok||!t.payment_id)return e.__sendingRequest=!1,void(this.apiTestResult=`Nepodarilo sa získať payment_id pre používateľa ${e.name}. `+(t&&t.message?`Dôvod: ${t.message}`:"Skontroluj backend inquirePayment.php, aby vracal 'payment_id'."));await this.savePayment(e);const a=new URLSearchParams;a.append("student_id",e.id),a.append("payment_id",String(t.payment_id));const n=await fetch("/api/edupage/sendMailEdupagePaymentRequest.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:a}),s=await n.json(),i=s&&"string"===typeof s.status&&s.status.toLowerCase().includes("succesfull");i?(this.apiTestResult=`Platobný príkaz (ID ${t.payment_id}) úspešne odoslaný používateľovi ${e.name}.`,e.email_payment_request="true",await this.savePayment(e,{email_payment_request:"true"}),this.activeRow=e.id):(e.__sendingRequest=!1,this.apiTestResult=`Chyba pri odosielaní platobného príkazu používateľovi ${e.name}: `+(s&&(s.message||s.data)?s.message||s.data:"Neznáma chyba"))}catch(t){e.__sendingRequest=!1,this.apiTestResult=`Chyba pri odosielaní platobného príkazu používateľovi ${e.name}: `+t}},async inquirePayment(e){try{const t=new URLSearchParams({id:String(e),month:String(this.month),year:String(this.year)}),a=await fetch(`/api/edupage/inquirePayment.php?${t.toString()}`),n=await a.json(),s=n&&(n.data||n),i=s&&(s.payment_id||s.paymentId||s.payment&&s.payment.id||s.id),o=s&&(s.lesson||s.payment&&s.payment.lesson)||"",r=s&&(s.date||s.payment&&s.payment.date)||"",l=s&&(s.qr||s.payment&&s.payment.qr)||"",d=n&&(n.message||n.status)||"";return this.apiTestResult=`InquirePayment odpoveď: ${JSON.stringify(n,null,2)}`,{ok:Boolean(i),payment_id:i?String(i):null,lesson:String(o),date:String(r),qr:String(l),raw:n,message:d}}catch(t){return{ok:!1,payment_id:null,raw:null,message:String(t)}}},isRequestSent(e){return e&&void 0!==e.email_payment_request&&null!==e.email_payment_request&&"Payment not found"!==e.email_payment_request},isNoticeSent(e){return e&&void 0!==e.email_payment_notice&&null!==e.email_payment_notice&&"Payment not found"!==e.email_payment_notice},async remind(e){try{const t=await this.inquirePayment(e.id);if(!t.ok||!t.payment_id)return void(this.apiTestResult=`Nepodarilo sa získať payment_id pre používateľa ${e.name}. `+(t&&t.message?`Dôvod: ${t.message}`:"Skontroluj backend inquirePayment.php, aby vracal 'payment_id'."));const a=new URLSearchParams;a.append("student_id",e.id),a.append("payment_id",String(t.payment_id));const n=await fetch("/api/edupage/sendMailEdupagePaymentNotice.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:a}),s=await n.json(),i=s&&"string"===typeof s.status&&s.status.toLowerCase().includes("succesfull");i?(this.apiTestResult=`Platobná PRIPOMIENKA (notice) pre payment ID ${t.payment_id} úspešne odoslaná používateľovi ${e.name}.`,e.email_payment_notice="true",await this.savePayment(e,{email_payment_notice:"true"})):this.apiTestResult=`Chyba pri odoslaní pripomienky používateľovi ${e.name}: `+(s&&(s.message||s.data)?s.message||s.data:"Neznáma chyba")}catch(t){this.apiTestResult=`Chyba pri odoslaní pripomienky používateľovi ${e.name}: `+t}},isPaidLocked(e){const t=Number(e.fee||0),a=Number(e.paidSum||0);return!(!Number.isFinite(t)||!Number.isFinite(a))&&a>=t},handlePaidClick(e){this.isPaidLocked(e)||(this.togglePaid(e),this.savePayment(e,{__markPaid:1}))},togglePaid(e){e.paid=!e.paid,e.paid&&(e.paidSum=Number(e.fee||0))},async onFeeChange(e){await this.savePayment(e)},async ensurePaymentId(e){if(e.payment_id)return e.payment_id;const t=await this.inquirePayment(e.id);return t&&t.ok&&t.payment_id?(e.payment_id=t.payment_id,t.payment_id):null},async savePayment(e,t={}){try{const a=await this.ensurePaymentId(e);if(!a)return void(this.apiTestResult=`Nepodarilo sa získať payment_id pre ${e.name}. Uloženie zrušené.`);if(!e.lesson||!e.date||!e.qr){const t=await this.inquirePayment(e.id);if(t&&t.ok){if(e.lesson&&""!==e.lesson||!Array.isArray(e.lesson_ids)||!e.lesson_ids.length||(e.lesson=JSON.stringify(e.lesson_ids.map(String))),!e.date||""===e.date){const t=new Date,a=String(t.getDate()).padStart(2,"0"),n=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getFullYear());e.date=`${a}.${n}.${s}`}!e.qr&&t.qr&&(e.qr=t.qr)}}const n=new URLSearchParams;if(n.append("id",String(a)),n.append("user_id",String(e.id)),void 0!==e.fee&&null!==e.fee){const t=Number(e.fee),a=Number.isFinite(t)?t.toFixed(2):"0.00";n.append("price",a)}const s=e.paid?"PAID":"PENDING";if(n.append("status",s),e.paid){const a=Number(e.fee),s=Number(e.paidSum),i=t.__markPaid?Number.isFinite(a)?a.toFixed(2):"0.00":Number.isFinite(s)?s.toFixed(2):Number.isFinite(a)?a.toFixed(2):"0.00";n.append("paid",i)}else n.append("paid","0.00");n.append("lesson",null!=e.lesson?String(e.lesson):""),n.append("date",null!=e.date?String(e.date):"");{const t=Number(e.fee),a=Number.isFinite(t)?t.toFixed(2):"0.00";let s=null!=e.qr?String(e.qr):"";if(s){const e=/([?&])price=([^&]*)/i.test(s);if(e)s=s.replace(/([?&])price=([^&]*)/i,`$1price=${a}`);else{const e=s.includes("?")?"&":"?";s=`${s}${e}price=${a}`}}n.append("qr",s)}n.append("email_payment_request",null!=e.email_payment_request?String(e.email_payment_request):"Payment not found"),n.append("email_payment_notice",null!=e.email_payment_notice?String(e.email_payment_notice):"Payment not found");for(const[e,l]of Object.entries(t))void 0!==l&&null!==l&&n.set(e,String(l));const i=await fetch("/api/edupage/editPayment.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:n}),o=await i.json().catch((()=>null)),r=o&&"string"===typeof o.status&&o.status.toLowerCase().includes("succesfull");r?(this.apiTestResult=`Platba pre ${e.name} bola uložená.`,t&&t.__markPaid&&(e.paidSum=Number(e.fee||0)),["true",!0,1,"1"].includes(t.email_payment_notice)&&(e.email_payment_notice="true"),["true",!0,1,"1"].includes(t.email_payment_request)&&(e.email_payment_request="true")):this.apiTestResult=`Uloženie platby pre ${e.name} zlyhalo.`+(o&&(o.message||o.data)?` Dôvod: ${o.message||o.data}`:"")}catch(a){this.apiTestResult=`Chyba pri ukladaní platby pre ${e.name}: ${a}`}},toggleRow(e){this.activeRow=this.activeRow===e?null:e},async testApi(){const e={"nedeľa":7,nedela:7,pondelok:1,utorok:2,streda:3,"štvrtok":4,stvrtok:4,piatok:5,sobota:6};let t=this.day;if("string"===typeof t){const a=t.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"");t=void 0!==e[a]?e[a]:""}"number"===typeof t&&isNaN(t)&&(t="");const a=`/api/edupage/listLessonsByTeacher.php?teacher_id=${this.teacherId}&year=${this.year}&month=${String(this.month).padStart(2,"0")}&day=${t}`;try{const e=await fetch(a),t=await e.json();if(this.apiTestResult=JSON.stringify(t,null,2),t&&t.data&&(this.apiLessonCount=Number(t.data.count)||0),t&&t.data&&Array.isArray(t.data.student_data)){const e=Object.create(null),a=Object.create(null);for(const t of this.rows||[])t&&null!=t.id&&("true"===t.email_payment_request&&(e[t.id]=!0),"true"===t.email_payment_notice&&(a[t.id]=!0));this.rows=t.data.student_data.map((t=>{const n=(t.name||"")+(t.surname?" "+t.surname:"");let s=t.profilePhotoUrl||"https://via.placeholder.com/56";"string"===typeof s&&(s=s.trim().replace("www.heligonkovaakademia.sk","heligonkovaakademia.sk"));let i="";if(Array.isArray(t.lesson_starts)&&t.lesson_starts.length>0){const e=t.lesson_starts[t.lesson_starts.length-1];if(e&&!isNaN(Number(e))){const a=Number(e),n=Math.floor(a/100),s=a%100;let o="duo"===t.formOfStudy?45:30;const r=s+o,l=n+Math.floor(r/60),d=r%60;i=`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")} – ${String(l).padStart(2,"0")}:${String(d).padStart(2,"0")}`}}let o=0;if(t.price&&!isNaN(Number(t.price)))o=Number(t.price);else{const e=(t.countAbsolvedLessons||0)+(t.countParentCancelledLesson||0);o="duo"===t.formOfStudy?14*e:16*e}const r=Number(t.paid??t.paid_sum??t.paidSum??t.paid_total??t.sumPaid??0),l=r>=Number(o||0),d=e=>!0===e||1===e||"1"===e||"string"===typeof e&&"true"===e.toLowerCase()?"true":null,c=d(t.email_payment_request)||(e[t.id]?"true":null),u=d(t.email_payment_notice)||(a[t.id]?"true":null),p=Array.isArray(t.lesson_ids)?t.lesson_ids.filter((e=>null!=e)).map(String):[];return{id:t.id,mode:"duo"===t.formOfStudy?"duo":"solo",name:n,avatar:s,time:i,carryOver:0,fee:o,countAbsolvedLessons:t.countAbsolvedLessons||0,countAdminCancelledLesson:t.countAdminCancelledLesson||0,countParentCancelledLesson:t.countParentCancelledLesson||0,paid:l,paidSum:r,dueISO:null,email_payment_request:c,email_payment_notice:u,lesson_ids:p,lesson:JSON.stringify(p),date:t.date??"",payment_id:t.payment_id||null,qr:t.qr||null}}))}else this.rows=[]}catch(n){this.apiTestResult="Chyba pri načítaní: "+n}}}},Y=a(89);const K=(0,Y.Z)(J,[["render",U],["__scopeId","data-v-7b00204a"]]);var B=K,H=a(1076);const E=(0,n.RC)((()=>a.e(1854).then(a.bind(a,1854)))),G="edp.selectedDateISO",V="edp.currentDay";var Z={components:{KalendarDatumHeader:E,AdminPlatobnePrikazy:B},data(){const e=new Date;return{showFilter:!1,povoleneDni:[],povoleneCasyPodlaDna:{},dostupnost:[],acLoads:{},slotCache:new Map,teacherCountsGlobal:null,currentMonth:e.getMonth()+1,currentYear:e.getFullYear(),currentDay:localStorage.getItem(V)||"",selectedDateISO:localStorage.getItem(G)||null,teachers:[{id:"59",name:"Juraj Kvočka",count:0},{id:"54",name:"Andrej Trnka",count:0},{id:"607",name:"Matej Kondela",count:0},{id:"53",name:"Ľuboš Kukla",count:0}],selectedTeacher:"54"}},computed:{apiBase(){return(this.$store?.state?.api||"").replace(/\/+$/,"")+"/edupage/"},teacherId(){const e=[59,54,607,945,53],t=Number(this.$store?.state?.user?.id||0);return e.includes(t)?t:null}},methods:{selectTeacher(e){this.selectedTeacher=e},async safeFetch(e,t={},a=null){return a&&(this.acLoads[a]?.abort?.(),this.acLoads[a]=new AbortController,t.signal=this.acLoads[a].signal),fetch(e,{credentials:"include",...t})},async parseMaybeJSON(e){const t=await e.text();try{return JSON.parse(t)}catch{return null}},slotyStvrtHod(e,t){if(!e||!t)return[];const a=e+">"+t,n=this.slotCache.get(a);if(n)return n;const[s,i]=String(e).split(":").map((e=>parseInt(e,10))),[o,r]=String(t).split(":").map((e=>parseInt(e,10)));if(![s,i,o,r].every(Number.isFinite))return[];const l=[];let d=60*s+i;const c=60*o+r;while(d<c){const e=String(Math.floor(d/60)).padStart(2,"0"),t=String(d%60).padStart(2,"0");l.push(`${e}:${t}`),d+=15}return this.slotCache.set(a,l),l},async nacitajDostupnost(){if(!this.teacherId)return this.dostupnost=[],this.povoleneDni=[],this.povoleneCasyPodlaDna={},void(this.showFilter=!1);const e=await this.safeFetch(this.apiBase+"loadCalendarCustom.php?teacher_id="+this.teacherId,{},"avail"),t=await this.parseMaybeJSON(e),a=Array.isArray(t?.data)?t.data:Array.isArray(t)?t:[],n=String(this.teacherId),s=[];for(const o of a){const e=String(o.teacher_id??o.teacherId??o.teacherID??"");if(e!==n)continue;let t=o?.data;if("string"===typeof t)try{t=t.trim()?JSON.parse(t):null}catch{t=null}t&&s.push({id:Number(o.id||0)||null,den:t.den||t.day||"",miesto:t.miesto||t.location||"",od:t.od||t.from||"",do:t.do||t.to||""})}this.dostupnost=s,this.povoleneDni=Array.from(new Set(s.map((e=>e.den)))).filter(Boolean);const i={};for(const o of this.povoleneDni)i[o]=[];for(const o of s)i[o.den]||(i[o.den]=[]),i[o.den].push(...this.slotyStvrtHod(o.od,o.do));Object.keys(i).forEach((e=>i[e]=Array.from(new Set(i[e])).sort())),this.povoleneCasyPodlaDna=i,this.showFilter=this.povoleneDni.length>0},onDayChanged(e){e&&("string"===typeof e?this.currentDay=e:e instanceof Date?this.currentDay=this.dayNameSkFromDate(e):e.dayName&&(this.currentDay=e.dayName),localStorage.setItem(V,this.currentDay||""))},onDateChanged(e){if("string"===typeof e&&/^\d{4}-\d{2}-\d{2}$/.test(e)){this.selectedDateISO=e;const t=new Date(e);this.currentMonth=t.getMonth()+1,this.currentYear=t.getFullYear(),localStorage.setItem(G,e)}},onMonthChanged({month:e,year:t}){this.currentMonth=e,this.currentYear=t},async loadTeacherCountsOnce(){if(this.teacherCountsGlobal)return;const e=(this.$store?.state?.api||"").replace(/\/+$/,""),t=this.teachers.map((e=>Number(e.id))),a={};await Promise.allSettled(t.map((async t=>{try{const n=await H["default"].get(`${e}/edupage/countTeacherStudents.php?id=${t}`);if("Request succesfull"===n?.data?.status){const e=n?.data?.data;let s=0;if(e&&"object"===typeof e){const t=Number(e.solo)||0,a=Number(e.duo)||0;s=t+a}else s=Number(e)||0;a[t]=s}else a[t]=0}catch{a[t]=0}}))),this.teacherCountsGlobal=a,this.teachers=this.teachers.map((e=>({...e,count:a[Number(e.id)]??0})))}},async mounted(){await this.nacitajDostupnost(),await this.loadTeacherCountsOnce()},watch:{"$store.state.user"(e,t){e?.id!==t?.id&&this.nacitajDostupnost()}}};const W=(0,Y.Z)(Z,[["render",d],["__scopeId","data-v-69fac0b7"]]);var Q=W},7893:function(e,t,a){e.exports=a.p+"img/odoslatMail.cd3c0ab0.svg"},4229:function(e,t,a){e.exports=a.p+"img/uhradenyMesiac.82acb2c3.svg"}}]);