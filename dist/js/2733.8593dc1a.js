"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[2733],{2733:function(e,a,t){t.r(a),t.d(a,{default:function(){return w}});var i=t(3396),l=t(9242),s=t(7139),o=t(4970);const n=["id"],r={class:"scroll"},m={class:"column"},c={class:"row-form"},d={class:"row-form"},p={class:"row-form"},u={class:"zvukova-stopa"},h={key:0,style:{"text-align":"center"}},v={class:"column"},_={class:"historia-mailov"};function k(e,a,t,k,f,b){return(0,i.wg)(),(0,i.iD)("section",{id:e.$route.name},[(0,i._)("div",r,[a[14]||(a[14]=(0,i._)("h1",null,"Administratívny systém",-1)),a[15]||(a[15]=(0,i._)("h5",null,"Hromadné posielanie reklamných mailov",-1)),(0,i._)("form",{onSubmit:a[6]||(a[6]=(0,l.iM)(((...e)=>b.spravaMailov&&b.spravaMailov(...e)),["prevent"]))},[(0,i._)("div",m,[(0,i._)("div",c,[a[7]||(a[7]=(0,i._)("label",{for:"predmet"},"Predmet:",-1)),(0,i.wy)((0,i._)("input",{ref:"predmet",type:"text",name:"predmet",placeholder:"Text","onUpdate:modelValue":a[0]||(a[0]=e=>f.predmet=e)},null,512),[[l.nr,f.predmet]])]),(0,i._)("div",d,[a[8]||(a[8]=(0,i._)("label",{for:"mail-správa"},"Správa",-1)),(0,i.wy)((0,i._)("textarea",{name:"mail-správa","onUpdate:modelValue":a[1]||(a[1]=e=>f.mailText=e),cols:"30",rows:"10",placeholder:"text správy ktorý sa zobrazí ak používateľ nemá k dispozícii html mail"},null,512),[[l.nr,f.mailText]])]),(0,i._)("div",p,[a[9]||(a[9]=(0,i._)("label",{for:"zvuk-piesne"},"Príloha:",-1)),(0,i._)("div",u,[(0,i._)("label",{for:"customFileT",class:"button Adumu",onClick:a[2]||(a[2]=e=>b.openFileInput())}," Pridať "),(0,i._)("input",{type:"file",id:"customFileT",class:"custom-file-input",ref:"mailHTML",onChange:a[3]||(a[3]=e=>b.handleFileSelect(e)),accept:".png"},null,544),""!=f.fileName?((0,i.wg)(),(0,i.iD)("div",{key:0,onClick:a[4]||(a[4]=e=>b.clearSelectedFile()),class:"selected-file-info"},(0,s.zw)(f.fileName),1)):(0,i.kq)("",!0)])]),f.odosielaniePrebieha?((0,i.wg)(),(0,i.iD)("p",h," Odosielajú sa emaily "+(0,s.zw)(f.odoslaneCount)+"/"+(0,s.zw)(f.celkovyPocet),1)):(0,i.kq)("",!0),(0,i._)("button",{class:(0,s.C_)([{"not-have-permission":!this.$store.state.userRoles?.roles?.includes("mail_master")},"button"]),type:"submit"},a[10]||(a[10]=[(0,i._)("p",null,"Odoslať",-1)]),2),(0,i._)("div",{onClick:a[5]||(a[5]=a=>e.$router.go(-1)),class:"zrusit click"},a[11]||(a[11]=[(0,i._)("img",{src:o,alt:"Zrušiť"},null,-1),(0,i._)("p",null,"Zrušiť",-1)]))]),a[13]||(a[13]=(0,i._)("div",{class:"line"},null,-1)),(0,i._)("div",v,[a[12]||(a[12]=(0,i._)("p",{class:"nadpis"},"Naposledy odoslané maily",-1)),(0,i._)("ul",_,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(f.historiaMailov,(e=>((0,i.wg)(),(0,i.iD)("li",{key:e.id,class:"mail"},[(0,i._)("p",null,(0,s.zw)(e.timestamp),1),(0,i._)("p",null,(0,s.zw)(e.subject),1)])))),128))])])],32)])],8,n)}t(560);var f={mounted(){window.scrollTo(0,0),this.nacitanieHistorieMailov()},data(){return{predmet:"",mailText:"",mailHTML:"",fileName:"",historiaMailov:[],odosielaniePrebieha:!1,odoslaneCount:0,celkovyPocet:0}},methods:{openFileInput(){this.$refs.mailHTML.value=""},handleFileSelect(e){const a=e.target.files[0];this.fileName=a.name;const t=new FileReader;t.onload=()=>{this.mailHTML=t.result},t.readAsDataURL(a)},clearSelectedFile(){this.mailHTML="",this.fileName=""},spravaMailov(){""!==this.mailHTML&&""!==this.mailText?""!==this.predmet?this.ulozenieMailu():this.$store.state.SnackBarText="Napíš predmet správy":this.$store.state.SnackBarText="Vlož obrázok aj text správy"},ulozenieMailu(){const e=t(7218),a=t(6237);let i=new a;const l='\n    <!DOCTYPE html>\n    <html><body>\n      <img src="%image%" alt="Obrázok" style="max-width: 100%; height: auto;"/>\n    </body></html>\n  ';i.append("email_txt",this.mailText),i.append("email_html",l),e.post(this.$store.state.api+"/mail/adsEditEmail.php/",i).then((e=>{"Request succesfull"===e.data.status?this.odoslanieMailov():this.$store.state.SnackBarText="Nastala chyba pri úprave emailu"})).catch((e=>{this.$store.state.SnackBarText="Chyba pri ukladaní šablóny"}))},odoslanieMailov(){const e=t(7218),a=t(6237);let i=new a;i.append("subject",this.predmet),i.append("image",this.mailHTML),this.odosielaniePrebieha=!0,e.post(this.$store.state.api+"/mail/adsSendEmail.php",i).catch((e=>{})),this.$store.state.SnackBarText="Odosielanie mailov prebieha na pozadí",this.$router.push("/admin")},nacitanieHistorieMailov(){const e=t(7218);e.get(this.$store.state.api+"/mail/load.php").then((e=>{"Request succesfull"===e.data.status?this.historiaMailov=e.data.data.map((e=>{let[a,t]=e.timestamp.split(" "),i=a.split("-").reverse().join("."),l=t.substring(0,5);return{...e,timestamp:`${i} ${l}`}})):this.historiaMailov=[{id:"0",timestamp:"20--0",subject:"Žiadne maily"}]})).catch((function(){}))}}},b=t(89);const y=(0,b.Z)(f,[["render",k],["__scopeId","data-v-75d994ae"]]);var w=y},4970:function(e,a,t){e.exports=t.p+"img/zrusit.31ce29f1.svg"}}]);