"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[6569],{1164:function(t,e,a){a.d(e,{Z:function(){return d}});var s=a(3396),r=a(7139);function i(t,e,a,i,o,n){return(0,s.wg)(),(0,s.iD)("span",{class:"sort-arrow",onClick:e[0]||(e[0]=(...t)=>n.toggleSort&&n.toggleSort(...t))},[((0,s.wg)(),(0,s.iD)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.7em",height:"0.7em",viewBox:"0 0 14 12",class:(0,r.C_)(["triangle-icon",n.rotationClass])},e[1]||(e[1]=[(0,s._)("path",{d:"M13.7814 2.28223C14.0658 1.81973 14.0752 1.23848 13.8095 0.766602C13.5439 0.294727 13.0439 0.000976574 12.5002 0.000976581L1.50015 0.000976612C0.956406 0.000976612 0.454801 0.294727 0.190776 0.766602C-0.0748491 1.23848 0.0623493 1.81973 0.218901 2.28223L5.7189 11.2822C5.99786 11.7917 6.47515 12.0015 7.00015 12.001C7.52515 12.001 8.0064 11.7291 8.2814 11.2822L13.7814 2.28223Z",fill:"black"},null,-1)]),2))])}var o={props:{column:String,sortKey:String,sortDirection:String},computed:{rotationClass(){return this.sortKey!==this.column?"neutral":"asc"===this.sortDirection?"rotate":""}},methods:{toggleSort(){let t="asc";this.sortKey===this.column&&"asc"===this.sortDirection?t="desc":this.sortKey===this.column&&"desc"===this.sortDirection&&(t=""),this.$emit("update:sort",{key:t?this.column:"",direction:t})}}},n=a(89);const l=(0,n.Z)(o,[["render",i],["__scopeId","data-v-93cbcb14"]]);var d=l},6569:function(t,e,a){a.r(e),a.d(e,{default:function(){return S}});var s=a(3396),r=a(7139),i=a(9242),o=a(3139);const n=["id"],l={class:"scroll"},d={style:{width:"35%"}},c={style:{width:"15%"}},u={style:{width:"15%"}},h={class:"sold",style:{width:"20%"}},p={key:0},y={class:"sold"},m=["onClick"],g={key:1},v={class:"sold"},w=["onClick"],k={class:"search"};function _(t,e,a,_,D,f){const K=(0,s.up)("SortArrow");return(0,s.wg)(),(0,s.iD)("section",{id:t.$route.name},[(0,s._)("div",l,[e[10]||(e[10]=(0,s._)("h1",null,"Administratívny systém",-1)),e[11]||(e[11]=(0,s._)("h5",null,"Zoznam HeliShop",-1)),e[12]||(e[12]=(0,s._)("div",{class:"line horizontal w-80"},null,-1)),(0,s._)("table",null,[(0,s._)("thead",null,[(0,s._)("tr",null,[(0,s._)("th",d,[e[2]||(e[2]=(0,s.Uk)(" Názov: ")),(0,s.Wm)(K,{column:"name",sortKey:D.sortKey,sortDirection:D.sortDirection,"onUpdate:sort":f.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,s._)("th",c,[e[3]||(e[3]=(0,s.Uk)(" Typ: ")),(0,s.Wm)(K,{column:"category",sortKey:D.sortKey,sortDirection:D.sortDirection,"onUpdate:sort":f.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,s._)("th",u,[e[4]||(e[4]=(0,s.Uk)(" Cena: ")),(0,s.Wm)(K,{column:"price",sortKey:D.sortKey,sortDirection:D.sortDirection,"onUpdate:sort":f.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,s._)("th",h,[e[5]||(e[5]=(0,s.Uk)(" Predané: ")),(0,s.Wm)(K,{column:"soldNumber",sortKey:D.sortKey,sortDirection:D.sortDirection,"onUpdate:sort":f.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),e[6]||(e[6]=(0,s._)("th",{style:{width:"20%"}},null,-1))])]),0===Object.keys(D.dataVyhladavanie).length?((0,s.wg)(),(0,s.iD)("tbody",p,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(f.sortedData,((t,a)=>((0,s.wg)(),(0,s.iD)("tr",{key:a},[(0,s._)("td",null,[(0,s._)("strong",null,(0,r.zw)(a+1)+". ",1),(0,s.Uk)(" "+(0,r.zw)(t.name),1)]),(0,s._)("td",null,(0,r.zw)(t&&t.category?t.category:"Nedefinovaný typ"),1),(0,s._)("td",null,(0,r.zw)(t&&t.price?t.price:"0")+" €",1),(0,s._)("td",y,(0,r.zw)(t&&t.soldNumber?t.soldNumber:"0")+" ks ",1),(0,s._)("td",null,[(0,s._)("div",{onClick:e=>f.upravenieZapisu(t.id),class:"button"},e[7]||(e[7]=[(0,s._)("a",null,"Upraviť",-1)]),8,m)])])))),128))])):((0,s.wg)(),(0,s.iD)("tbody",g,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(D.dataVyhladavanie,((t,a)=>((0,s.wg)(),(0,s.iD)("tr",{key:a},[(0,s._)("td",null,[(0,s._)("strong",null,(0,r.zw)(a+1)+". ",1),(0,s.Uk)(" "+(0,r.zw)(t.name),1)]),(0,s._)("td",null,(0,r.zw)(t&&t.category?t.category:"Nedefinovaný typ"),1),(0,s._)("td",null,(0,r.zw)(t&&t.price?t.price:"0")+" €",1),(0,s._)("td",v,(0,r.zw)(t&&t.soldNumber?t.soldNumber:"0")+" ks ",1),(0,s._)("td",null,[(0,s._)("div",{onClick:e=>f.upravenieZapisu(t.id),class:"button"},e[8]||(e[8]=[(0,s._)("a",null,"Upraviť",-1)]),8,w)])])))),128))]))]),(0,s._)("div",k,[e[9]||(e[9]=(0,s._)("img",{src:o,alt:"Vyhladanie"},null,-1)),(0,s.wy)((0,s._)("input",{onInput:e[0]||(e[0]=t=>f.oneskoreneVyhladavanie()),type:"text",placeholder:"Vyhľadať pieseň","onUpdate:modelValue":e[1]||(e[1]=t=>D.search=t)},null,544),[[i.nr,D.search]])])])],8,n)}a(560);var D=a(1164),f={components:{SortArrow:D.Z},mounted(){window.scrollTo(0,0),this.nacitajProdukty(),this.data=this.data.slice()},data(){return{data:[],search:"",predane:{},dataVyhladavanie:[],sortKey:"",sortDirection:""}},computed:{reversedData(){return this.data.slice()},sortedData(){const t=0===Object.keys(this.dataVyhladavanie).length?this.data.slice():this.dataVyhladavanie;return this.sortKey&&this.sortDirection?[...t].sort(((t,e)=>{const a=t[this.sortKey],s=e[this.sortKey],r=parseFloat(String(a).replace(",",".")),i=parseFloat(String(s).replace(",",".")),o=!isNaN(r)&&!isNaN(i);let n=0;if(o)n=r-i;else{const t=String(a).localeCompare(String(s),void 0,{numeric:!0,sensitivity:"base"});n=t}return"asc"===this.sortDirection?n:-n})):t}},methods:{nacitajProdukty(){const t=a(7218);let e={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/product/stats/listMerch.php"};t.request(e).then((async t=>{if("Request succesfull"==t.data.status){this.data=t.data.data;const e=await Promise.all(this.data.map((async t=>{try{const e=JSON.parse(t.details),{price:a,category:s}=await this.nacitajDataProduktu(t.id);return{...t,details:e,price:a,category:s}}catch(e){return t}})));this.data=e,this.statistikaJednotlivoPredanych()}})).catch((t=>{}))},updateSort({key:t,direction:e}){this.sortKey=t,this.sortDirection=e},nacitajDataProduktu(t){const e=a(7218);let s={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/product/loadLimited.php/?id="+t};return e.request(s).then((t=>{if("Request succesfull"==t.data.status)return{price:t.data.data.price.replace(".",","),category:t.data.data.category};throw new Error("Neúspešná odpoveď z API")})).catch((t=>({price:null,category:null})))},upravenieZapisu(t){this.$router.push({path:"/admin/pridanie-polozky-helishop",query:{id:t}})},vyhladavanieZapisu(){if(""===this.search.trim())return void(this.dataVyhladavanie=[]);const t=a(7218);let e={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/product/search.php?virtuality=false&search="+this.search};t.request(e).then((async t=>{if("Request succesfull"==t.data.status){let e=t.data.data;e=e.map((t=>{const e=this.data.find((e=>e.id===t.id));return e?{...t,...e}:{...t,price:null,category:null,details:null}})),this.dataVyhladavanie=await Promise.all(e.map((async t=>{if(null!==t.price&&null!==t.category&&null!==t.details)return t;try{const{price:e,category:a}=await this.nacitajDataProduktu(t.id),s=JSON.parse(t.details||"{}");return{...t,price:e,category:a,details:s}}catch(e){return t}}))),setTimeout((()=>{this.statistikaJednotlivoPredanych()}),200)}else setTimeout((()=>{this.statistikaJednotlivoPredanych()}),200)})).catch((t=>{this.dataVyhladavanie=[]}))},oneskoreneVyhladavanie(){clearTimeout(this.timer),this.timer=setTimeout((()=>{this.vyhladavanieZapisu()}),500)},statistikaJednotlivoPredanych(){const t=a(7218);let e={method:"get",maxBodyLength:1/0,url:this.$store.state.api+"/order/stats/soldByProduct.php"};t.request(e).then((t=>{"Request succesfull"==t.data.status&&(this.predane=t.data.data);const e=this.data.map((t=>{const e=t.id,a=this.predane[e]||0;return{...t,soldNumber:a}}));this.data=e;const a=this.dataVyhladavanie.map((t=>{const e=t.id,a=this.predane[e]||0;return{...t,soldNumber:a}}));this.dataVyhladavanie=a})).catch((t=>{}))}}},K=a(89);const b=(0,K.Z)(f,[["render",_],["__scopeId","data-v-87d854c2"]]);var S=b},3139:function(t,e,a){t.exports=a.p+"img/hladanie.697b6243.svg"}}]);