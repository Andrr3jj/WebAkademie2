"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[5083],{5083:function(t,e,i){i.r(e),i.d(e,{default:function(){return V}});var a=i(3396),s=i(7139),o=i(9242);const n={key:0,class:"formular"},r={class:"pridanie"},d={class:"boxik forma"},l={class:"vyucba solo"},c={class:"vyucba duo"},u={class:"boxik"},h={class:"ziak"},m=["value"],y=["value"],p={key:0,class:"ziak"},f=["value"],v=["value"],g=["aria-busy"],S={key:0,class:"text small",style:{color:"#c0392b"}},k={key:1,class:"text small",style:{color:"#2e7d32"}},w={key:1,class:"formular"},b={class:"pridanie"},z={class:"boxik",style:{width:"100%"}},C={class:"ziak"},_=["value"],D=["value"],I=["aria-busy"],M=["aria-busy"],T={key:0,class:"text small",style:{color:"#c0392b"}},E={key:1,class:"text small",style:{color:"#2e7d32"}},O={key:2,class:"modal-overlay"},P={class:"modal"},N=["innerHTML"],x={class:"modal-actions"};function H(t,e,i,H,j,U){return(0,a.wg)(),(0,a.iD)(a.HY,null,[i.edit?((0,a.wg)(),(0,a.iD)("div",w,[(0,a._)("h5",null,(0,s.zw)(U.editHeadlineText),1),e[29]||(e[29]=(0,a._)("p",{class:"text"},"Vyber deň a čas hodiny.",-1)),(0,a._)("div",b,[(0,a._)("div",z,[e[28]||(e[28]=(0,a._)("p",{class:"nadpis"},"Deň a čas:",-1)),(0,a._)("div",C,[(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":e[7]||(e[7]=t=>j.selectedEditDay=t)},[e[26]||(e[26]=(0,a._)("option",{value:"",disabled:""},"Vyber deň",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(U.dniPoPi,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t,value:t},(0,s.zw)(t),9,_)))),128))],512),[[o.bM,j.selectedEditDay]]),(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":e[8]||(e[8]=t=>j.selectedEditTime=t)},[e[27]||(e[27]=(0,a._)("option",{value:"",disabled:""},"Vyber čas",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(U.casoveMoznostiEdit,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t,value:t},(0,s.zw)(t),9,D)))),128))],512),[[o.bM,j.selectedEditTime]])])])]),(0,a._)("div",{class:"button Adumu",onClick:e[9]||(e[9]=(...t)=>U.ulozitEdit&&U.ulozitEdit(...t)),"aria-busy":j.loading},(0,s.zw)(j.loading?"Ukladám...":"Uložiť zmeny"),9,I),(0,a._)("div",{class:"button Adumu",style:{"margin-top":"1em",background:"#f86e5c"},onClick:e[10]||(e[10]=(...t)=>U.vymazatEdit&&U.vymazatEdit(...t)),"aria-busy":j.loading},(0,s.zw)(j.loading?"Mažem...":"Vymazať"),9,M),j.error?((0,a.wg)(),(0,a.iD)("p",T,(0,s.zw)(j.error),1)):(0,a.kq)("",!0),j.message?((0,a.wg)(),(0,a.iD)("p",E,(0,s.zw)(j.message),1)):(0,a.kq)("",!0)])):((0,a.wg)(),(0,a.iD)("div",n,[e[24]||(e[24]=(0,a._)("h5",null,"Pridať žiaka do rozvrhu",-1)),e[25]||(e[25]=(0,a._)("p",{class:"text"}," Vyber konkrétneho žiaka, ktorého chceš zaradiť do výučby, a nastav čas, kedy bude mať svoju lekciu. ",-1)),(0,a._)("div",r,[(0,a._)("div",d,[e[17]||(e[17]=(0,a._)("p",{class:"nadpis"},"Zvoľ formu výučby:",-1)),(0,a._)("div",l,[(0,a._)("div",{onClick:e[0]||(e[0]=t=>j.dual=!1),class:(0,s.C_)([{active:!j.dual},"button"])},e[13]||(e[13]=[(0,a._)("p",null,"Solo",-1)]),2),e[14]||(e[14]=(0,a._)("p",{class:"popis"},"Lekcia s jedným žiakom",-1))]),(0,a._)("div",c,[(0,a._)("div",{onClick:e[1]||(e[1]=t=>j.dual=!0),class:(0,s.C_)([{active:j.dual},"button"])},e[15]||(e[15]=[(0,a._)("p",null,"Dual",-1)]),2),e[16]||(e[16]=(0,a._)("p",{class:"popis"},"Lekcia s dvoma žiakmi",-1))])]),e[23]||(e[23]=(0,a._)("div",{class:"line"},null,-1)),(0,a._)("div",u,[e[22]||(e[22]=(0,a._)("p",{class:"nadpis"},"Vyber žiaka a zvol čas výučby:",-1)),(0,a._)("div",h,[(0,a.wy)((0,a._)("select",{name:"Žiak",id:"vyberZiaka","onUpdate:modelValue":e[2]||(e[2]=t=>j.ziak1Id=t)},[e[18]||(e[18]=(0,a._)("option",{value:"",disabled:""},"Vyber žiaka",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(j.students,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t.id,value:t.id},(0,s.zw)(t.name),9,m)))),128))],512),[[o.bM,j.ziak1Id]]),(0,a.wy)((0,a._)("select",{name:"cas",id:"odCas","onUpdate:modelValue":e[3]||(e[3]=t=>j.zvolenyCas=t)},[e[19]||(e[19]=(0,a._)("option",{value:"",disabled:""},"Vyber čas",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(U.casoveMoznosti,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t,value:t},(0,s.zw)(t),9,y)))),128))],512),[[o.bM,j.zvolenyCas]])]),j.dual?((0,a.wg)(),(0,a.iD)("div",p,[(0,a.wy)((0,a._)("select",{name:"Žiak",id:"vyberZiaka2","onUpdate:modelValue":e[4]||(e[4]=t=>j.ziak2Id=t)},[e[20]||(e[20]=(0,a._)("option",{value:"",disabled:""},"Vyber druhého žiaka",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(U.studentsDruhePole,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t.id,value:t.id},(0,s.zw)(t.name),9,f)))),128))],512),[[o.bM,j.ziak2Id]]),(0,a.wy)((0,a._)("select",{name:"cas",id:"odCas2","onUpdate:modelValue":e[5]||(e[5]=t=>j.zvolenyCas=t)},[e[21]||(e[21]=(0,a._)("option",{value:"",disabled:""},"Vyber čas",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(U.casoveMoznosti,(t=>((0,a.wg)(),(0,a.iD)("option",{key:t,value:t},(0,s.zw)(t),9,v)))),128))],512),[[o.bM,j.zvolenyCas]])])):(0,a.kq)("",!0)])]),(0,a._)("div",{class:"button Adumu",onClick:e[6]||(e[6]=(...t)=>U.odoslat&&U.odoslat(...t)),"aria-busy":j.loading},(0,s.zw)(j.loading?"Pridávam...":"Pridať"),9,g),j.error?((0,a.wg)(),(0,a.iD)("p",S,(0,s.zw)(j.error),1)):(0,a.kq)("",!0),j.message?((0,a.wg)(),(0,a.iD)("p",k,(0,s.zw)(j.message),1)):(0,a.kq)("",!0)])),j.showPlaceWarning?((0,a.wg)(),(0,a.iD)("div",O,[(0,a._)("div",P,[e[30]||(e[30]=(0,a._)("h5",null,"Pozor na mesto výučby",-1)),(0,a._)("p",{innerHTML:j.placeWarningText.replace(/\n/g,"<br>")},null,8,N),(0,a._)("div",x,[(0,a._)("button",{onClick:e[11]||(e[11]=t=>j.showPlaceWarning=!1)},"Zrušiť"),(0,a._)("button",{onClick:e[12]||(e[12]=(...t)=>U.potvrdPlaceWarning&&U.potvrdPlaceWarning(...t))},"Pokračovať")])])])):(0,a.kq)("",!0)],64)}i(560),i(8858),i(1318),i(3228);var j={name:"PridanieZiakaDoRozvrhu",props:{predvolenyDen:{type:String,default:""},predvolenyCas:{type:String,default:""},poslatDvakratPriDuo:{type:Boolean,default:!1},edit:{type:Boolean,default:!1},editId:{type:[String,Number],default:null},calendarId:{type:[String,Number],default:null},dayName:{type:String,default:""},calendarDayName:{type:String,default:""},hour:{type:String,default:""},calendarHour:{type:String,default:""},formOfStudy:{type:String,default:""}},data(){return{dual:!1,loading:!1,message:"",error:"",dostupnost:[],obsadene:{},students:[],ziak1Id:"",ziak2Id:"",zvolenyCas:"",slotKrokMin:15,selectedEditDay:"",selectedEditTime:"",existujuciStudenti:[],existujucaForma:"solo",editNames:[],showPlaceWarning:!1,placeWarningText:"",continueCtx:null}},computed:{resolvedEditId(){return null!=this.editId?this.editId:this.calendarId},incomingDay(){return this.dayName||this.calendarDayName||""},incomingHour(){return this.hour||this.calendarHour||""},incomingForm(){return(this.formOfStudy||"").toLowerCase()},apiBase(){return(this.$store?.state?.api||"").replace(/\/+$/,"")+"/edupage/"},apiUser(){return(this.$store?.state?.api||"").replace(/\/+$/,"")+"/user/"},apiInfo(){return(this.$store?.state?.api||"").replace(/\/+$/,"")+"/user/info/"},teacherId(){const t=[59,54,607,945,53],e=Number(this.$store?.state?.user?.id||0);return t.includes(e)?e:null},denNaOdoslanie(){if(this.edit)return this.selectedEditDay;if(this.predvolenyDen)return this.predvolenyDen;const t=["Nedeľa","Pondelok","Utorok","Streda","Štvrtok","Piatok","Sobota"];return t[(new Date).getDay()]},casoveMoznosti(){const t=this.denNaOdoslanie;if(!t)return[];const e=this.dostupnost.filter((e=>e.den===t));if(!e.length)return[];const i=this.dual?45:30,a=new Set;for(const r of e)for(const t of this.genSlotsFit(r.od,r.do,this.slotKrokMin,i))a.add(t);const s=Array.from(a).sort(),o=this.obsadene[t]||[],n=[];for(const r of o){const t=this.toMin(r.time),e="duo"===r.formOfStudy?45:30;n.push([t,t+e])}return s.filter((t=>{const e=this.toMin(t),a=e+i;return!n.some((([t,i])=>e<i&&t<a))}))},casoveMoznostiEdit(){const t=this.selectedEditDay;if(!t)return[];const e=this.dostupnost.filter((e=>e.den===t));if(!e.length)return[];const i="duo"===this.existujucaForma?45:30,a=new Set;for(const r of e)for(const t of this.genSlotsFit(r.od,r.do,this.slotKrokMin,i))a.add(t);const s=Array.from(a).sort(),o=this.obsadene[t]||[],n=[];for(const r of o){if(String(r.id)===String(this.resolvedEditId))continue;const t=this.toMin(r.time),e="duo"===r.formOfStudy?45:30;n.push([t,t+e])}return s.filter((t=>{const e=this.toMin(t),a=e+i;return!n.some((([t,i])=>e<i&&t<a))}))},studentsDruhePole(){return this.students.filter((t=>String(t.id)!==String(this.ziak1Id)))},dniPoPi(){const t=["Pondelok","Utorok","Streda","Štvrtok","Piatok"],e=Array.from(new Set(this.dostupnost.map((t=>t.den)))),i=t.filter((t=>e.includes(t)));return i.length?i:t},editHeadlineText(){const t=this.editNames.filter(Boolean);return t.length?t.length>1?"Zmeňte hodinu týmto žiakom "+t.join(" a "):"Zmeňte hodinu tomuto žiakovi "+t[0]:"Zmeňte hodinu"}},methods:{dayToInt(t){const e={Pondelok:0,Utorok:1,Streda:2,"Štvrtok":3,Piatok:4,Sobota:5,"Nedeľa":6};return"number"===typeof t?t:e[t]??t},intToDay(t){const e=["Pondelok","Utorok","Streda","Štvrtok","Piatok","Sobota","Nedeľa"],i=Number(t);return Number.isFinite(i)?e[i]??String(t):String(t)},normalizeHour(t){const e=String(t??"");if(/^\d{1,4}$/.test(e)){const t=parseInt(e,10),i=Math.floor(t/100),a=t%100;return String(i).padStart(2,"0")+":"+String(a).padStart(2,"0")}return/^\d{2}:\d{2}$/.test(e),e},hourToIntHHMM(t){const[e,i]=String(t||"00:00").split(":").map((t=>parseInt(t,10)||0));return String(e).padStart(2,"0")+String(i).padStart(2,"0")},toMin(t){const[e,i]=String(t||"00:00").split(":").map((t=>parseInt(t,10)));return 60*(e||0)+(i||0)},toHHMM(t){const e=Math.floor(t/60),i=t%60;return String(e).padStart(2,"0")+":"+String(i).padStart(2,"0")},ceilToStep(t,e){return Math.ceil(t/e)*e},genSlotsFit(t,e,i,a){let s=this.toMin(t);const o=this.toMin(e);s=this.ceilToStep(s,i);const n=[];for(let r=s;r+a<=o;r+=i)n.push(this.toHHMM(r));return n},chooseNearest(t,e){if(!e.length)return"";const i=this.toMin(t);let a=e[0],s=Math.abs(this.toMin(a)-i);for(const o of e){const t=Math.abs(this.toMin(o)-i);t<s&&(a=o,s=t)}return a},async nacitajDostupnost(){if(!this.teacherId)return;const t=this.apiBase+"loadCalendarCustom.php?teacher_id="+this.teacherId;try{const e=await fetch(t,{credentials:"include"}),i=await e.text();let a;try{a=JSON.parse(i)}catch{a=null}const s=a?.data&&Array.isArray(a.data)?a.data:[];this.dostupnost=s.map((t=>{let e=t.data||"{}";if("string"===typeof e){try{e=JSON.parse(e)}catch{e={}}if("string"===typeof e)try{e=JSON.parse(e)}catch{e={}}}return{den:e.den||"",od:e.od||"",do:e.do||"",mesto:e.miesto||e.placeOfStudy||e.city||e.location||""}})).filter((t=>t.den&&t.od&&t.do))}catch{this.dostupnost=[]}},async nacitajObsadene(){if(this.teacherId)try{const t=await fetch(this.apiBase+"loadCalendar.php?teacher_id="+this.teacherId,{credentials:"include"}),e=await t.text();let i;try{i=JSON.parse(e)}catch{i=null}const a=i?.data&&Array.isArray(i.data)?i.data:[],s={};for(const o of a){const t=o.availability_day??o.day??o.den??"",e=this.intToDay(t),i=o.availability_hour||o.hour||o.cas||"",a=this.normalizeHour(i),n=Number(o.id||o.ID||0)||null,r="duo"===(o.formOfStudy||"").toLowerCase()?"duo":"solo";e&&a&&n&&(s[e]||(s[e]=[]),s[e].push({id:n,time:a,formOfStudy:r}))}this.obsadene=s}catch{this.obsadene={}}},safeJsonParse(t){try{return JSON.parse(t)}catch{}const e=t.indexOf("{"),i=t.lastIndexOf("}");if(-1!==e&&-1!==i&&i>e)try{return JSON.parse(t.slice(e,i+1))}catch{return null}return null},async nacitajZiakov(){try{const t=await fetch(this.apiBase+"loadStudentsUnassigned.php",{credentials:"include"}),e=await t.text(),i=this.safeJsonParse(e);let a=Array.isArray(i?.data)?i.data:[];const s=String(this.teacherId||this.$store?.state?.user?.id||"");s&&(a=a.filter((t=>String(t.teacher_id)===s)));const o=(t,e)=>{const i=""!==String(t.approximateTimeOfStudy||"").trim(),a=""!==String(e.approximateTimeOfStudy||"").trim();if(i!==a)return i?t:e;const s=Number(t.timestamp_included||0),o=Number(e.timestamp_included||0);if(s!==o)return s>o?t:e;const n=Number(t.timestamp_created||0),r=Number(e.timestamp_created||0);if(n!==r)return n>r?t:e;const d=Number(t.id||0),l=Number(e.id||0);return d>=l?t:e},n=new Map;for(const l of a){const t=String(l.student_id||l.id);n.has(t)?n.set(t,o(n.get(t),l)):n.set(t,l)}const r=t=>{const e=this.normalizeHour(t||"");if(!/^\d{2}:\d{2}$/.test(e))return Number.POSITIVE_INFINITY;const[i,a]=e.split(":").map((t=>parseInt(t,10)||0));return 60*i+a},d=Array.from(n.values()).sort(((t,e)=>{const i=(t.placeOfStudy||"").trim(),a=(e.placeOfStudy||"").trim(),s=i.localeCompare(a,"sk",{sensitivity:"base"});return 0!==s?s:r(t.approximateTimeOfStudy)-r(e.approximateTimeOfStudy)}));this.students=d.map((t=>{const e=[t.name,t.surname].filter(Boolean).join(" ").trim(),i=(e||t.fullname||String(t.student_id||t.id))+" - "+(t.formOfStudy||"")+" - "+(t.placeOfStudy||"")+(t.approximateTimeOfStudy?` (${this.normalizeHour(t.approximateTimeOfStudy)})`:"");return{id:String(t.student_id||t.id),name:i,preferredTime:this.normalizeHour(t.approximateTimeOfStudy||""),placeOfStudy:t.placeOfStudy||""}}))}catch{this.students=[]}},getTeacherPlaceFor(t,e){const i=this.dostupnost.filter((e=>e.den===t));if(!i.length)return"";const a=this.toMin(this.normalizeHour(e));for(const r of i){const t=this.toMin(r.od),e=this.toMin(r.do);if(a>=t&&a<e)return(r.mesto||"").trim()}let s=null,o=1/0;for(const r of i){const t=this.toMin(r.od),e=this.toMin(r.do),i=a<t?t-a:a>e?a-e:0;i<o&&(o=i,s=r)}if(s&&s.mesto)return String(s.mesto).trim();const n=new Map;for(const r of i){const t=String(r.mesto||"").trim();t&&n.set(t,(n.get(t)||0)+1)}return n.size?Array.from(n.entries()).sort(((t,e)=>e[1]-t[1]))[0][0]:""},async potvrdPlaceWarning(){this.showPlaceWarning=!1,await this.odoslatPokracovanie()},makePlaceWarning({teacherPlace:t,students:e}){const i=[];for(const a of e){if(!a)continue;const e=a.name.replace(/\s+-\s+.*/,""),s=(a.placeOfStudy||"").trim()||"—";t&&s&&s.toLowerCase()!==t.toLowerCase()&&i.push(`• ${e}: prihláška = "${s}", dávate = "${t}"`)}return i.length?["Pozor! Mesto sa nezhoduje:",...i,"","Chceš pokračovať a poslať do emailu mesto podľa rozvrhu učiteľa?"].join("\n"):""},validuj(){return this.teacherId?this.ziak1Id?this.dual&&!this.ziak2Id?(this.error="Vyber druhého žiaka pre Duo.",!1):this.dual&&this.ziak1Id&&this.ziak2Id&&String(this.ziak1Id)===String(this.ziak2Id)?(this.error="Nemôžeš vybrať toho istého žiaka dvakrát.",!1):this.zvolenyCas?!!this.casoveMoznosti.includes(this.zvolenyCas)||(this.error="Čas nie je v tvojich dostupných hodinách.",!1):(this.error="Vyber čas.",!1):(this.error="Vyber žiaka.",!1):(this.error="Nemáš oprávnenie.",!1)},nastavDefaultCas(){if(this.edit){this.selectedEditDay||(this.selectedEditDay=this.dniPoPi[0]||"Pondelok");const t=this.casoveMoznostiEdit;if(!t.length)return void(this.selectedEditTime="");if(this.selectedEditTime&&t.includes(this.selectedEditTime))return;return this.selectedEditTime?void(this.selectedEditTime=this.chooseNearest(this.selectedEditTime,t)):void(this.selectedEditTime=t[0])}if(!this.casoveMoznosti.length)return void(this.zvolenyCas="");const t=[];if(this.ziak1Id){const e=this.students.find((t=>String(t.id)===String(this.ziak1Id)));e&&t.push(e)}if(this.dual&&this.ziak2Id){const e=this.students.find((t=>String(t.id)===String(this.ziak2Id)));e&&t.push(e)}if(!this.dual&&t[0]?.preferredTime){const e=this.normalizeHour(t[0].preferredTime);return this.casoveMoznosti.includes(e)?void(this.zvolenyCas=e):void(this.zvolenyCas=this.chooseNearest(e,this.casoveMoznosti))}if(this.dual&&2===t.length){const e=t[0].preferredTime?this.normalizeHour(t[0].preferredTime):null,i=t[1].preferredTime?this.normalizeHour(t[1].preferredTime):null;if(e&&i){if(e===i&&this.casoveMoznosti.includes(e))return void(this.zvolenyCas=e);const t=e?this.chooseNearest(e,this.casoveMoznosti):null,a=i?this.chooseNearest(i,this.casoveMoznosti):null;return void(this.zvolenyCas=t&&t===a?t:this.casoveMoznosti[0])}}this.predvolenyCas&&this.casoveMoznosti.includes(this.predvolenyCas)?this.zvolenyCas=this.predvolenyCas:this.predvolenyCas?this.zvolenyCas=this.chooseNearest(this.predvolenyCas,this.casoveMoznosti):this.zvolenyCas=this.casoveMoznosti[0]},async overKolizie(t,e,i=null,a=null){await this.nacitajObsadene();const s=this.obsadene[t]||[],o=this.toMin(this.normalizeHour(e)),n=null!=a?a:this.dual,r=n?45:30,d=o+r;for(const l of s){if(i&&String(l.id)===String(i))continue;const t=this.toMin(l.time),e="duo"===l.formOfStudy?45:30,a=t+e;if(o<a&&t<d)return`Kolízia: ${l.time} (${l.formOfStudy})`}return null},async callCreateCalendar(t,e,i,...a){const s=new URLSearchParams;s.append("formOfStudy",t),s.append("availability_day",String(this.dayToInt(e))),s.append("availability_hour",this.hourToIntHHMM(i));const o=a.filter((t=>t&&"null"!==String(t)));o.length&&s.append("student",JSON.stringify(o));const n=await fetch(this.apiBase+"createCalendar.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:s,credentials:"include"}),r=await n.text();let d;try{d=JSON.parse(r)}catch{d={ok:n.ok,raw:r}}if(!n.ok||"Request failed"===d?.status||d?.error)throw new Error(d?.message||d?.data||d?.error||`HTTP ${n.status}`);return d},async callEditCalendarUpdate(t){const e=new URLSearchParams;e.append("id",String(t.id)),t.formOfStudy&&e.append("formOfStudy",t.formOfStudy),null!=t.availability_day&&e.append("availability_day",String(t.availability_day)),t.availability_hour&&e.append("availability_hour",t.availability_hour),t.student&&Array.isArray(t.student)&&e.append("student",JSON.stringify(t.student));const i=await fetch(this.apiBase+"editCalendar.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:e,credentials:"include"}),a=await i.text();let s;try{s=JSON.parse(a)}catch{s=null}const o=i.ok&&(!0===s||!0===s?.ok||!0===s?.success||/^(ok|true|1)$/i.test(String(s?.status||""))||/^(ok|true|1)$/i.test(a.trim()));if(!o)throw new Error(s?.message||s?.error||"Uloženie zlyhalo.");return!0},async callEditCalendarDelete(t){const e=new URLSearchParams;e.append("id",String(t)),e.append("delete","true");const i=await fetch(this.apiBase+"editCalendar.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:e,credentials:"include"}),a=await i.text();let s;try{s=JSON.parse(a)}catch{s=null}const o=i.ok&&(!0===s||!0===s?.ok||!0===s?.success||/^(ok|true|1)$/i.test(String(s?.status||""))||/^(ok|true|1)$/i.test(a.trim()));if(!o)throw new Error(s?.message||s?.error||"Mazanie zlyhalo.");return!0},async sendStudentEmail(t,e){if(!t)return{ok:!1};const i=new URLSearchParams;i.append("student_id",t),e&&String(e).trim()&&i.append("placeOfStudy",String(e).trim());const a=await fetch(this.apiBase+"calendarSendEmailStudent.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:i,credentials:"include"}),s=await a.text();let o;try{o=JSON.parse(s)}catch{o=null}const n=a.ok&&(!o||"Request succesfull"===o?.status||"Request fullfiled"===o?.status);return{ok:n,raw:o||s}},async odoslat(){if(this.error="",this.message="",!this.validuj())return;const t=this.denNaOdoslanie,e=this.zvolenyCas,i=await this.overKolizie(t,e,null,this.dual);if(i)return void(this.error=i);const a=this.getTeacherPlaceFor(t,e),s=this.students.find((t=>String(t.id)===String(this.ziak1Id))),o=this.dual&&this.ziak2Id?this.students.find((t=>String(t.id)===String(this.ziak2Id))):null;if(a){const i=this.makePlaceWarning({teacherPlace:a,students:[s,o].filter(Boolean)});if(i)return this.placeWarningText=i,this.continueCtx={den:t,cas:e,teacherPlace:a,ids:[this.ziak1Id,this.dual?this.ziak2Id:null].filter(Boolean),form:this.dual?"duo":"solo"},void(this.showPlaceWarning=!0)}await this.vykonajVytvorenie(t,e,this.dual?"duo":"solo",a,[this.ziak1Id,this.dual?this.ziak2Id:null])},async odoslatPokracovanie(){if(!this.continueCtx)return;const t=this.continueCtx;this.continueCtx=null,await this.vykonajVytvorenie(t.den,t.cas,t.form,t.teacherPlace,t.ids)},async vykonajVytvorenie(t,e,i,a,s){this.loading=!0,this.error="",this.message="";try{const o=(Array.isArray(s)?s:[]).filter((t=>t&&"null"!==String(t)));"duo"===i&&this.poslatDvakratPriDuo?await Promise.all([this.callCreateCalendar("duo",t,e,...o),this.callCreateCalendar("duo",t,e,...o)]):await this.callCreateCalendar(i,t,e,...o);const n=[];for(const t of o){const e=await this.sendStudentEmail(t,a);n.push(e.ok)}await this.nacitajObsadene(),this.nastavDefaultCas();const r=0===n.length||n.every(Boolean);this.message=r?"Hodina bola pridaná a email odoslaný.":"Hodina bola pridaná. Email sa nepodarilo odoslať všetkým.",this.$emit("created")}catch(o){this.error=o?.message||"Nepodarilo sa pridať hodinu."}finally{this.loading=!1}},async nacitajDetailHodiny(t){if(t)try{const e=this.apiBase+"loadCalendar.php?id="+encodeURIComponent(t),i=await fetch(e,{credentials:"include"}),a=await i.text();let s;try{s=JSON.parse(a)}catch{s=null}const o=Array.isArray(s?.data)?s.data:Array.isArray(s)?s:[],n=o[0]||null;if(!n)return;const r=n.availability_day??n.day??n.den??"",d=n.availability_hour??n.hour??n.cas??"",l="duo"===(n.formOfStudy||"").toLowerCase()?"duo":"solo";let c=[],u=n.student??n.students??"";if("string"===typeof u&&u.trim())try{u=JSON.parse(u)}catch{u=[]}Array.isArray(u)&&(c=u.map((t=>String(t?.student_id??t)))),this.existujuciStudenti=c,this.existujucaForma=l,this.selectedEditDay=this.intToDay(r),this.selectedEditTime=this.normalizeHour(d),await this.nacitajMena(c)}catch{}},async nacitajMena(t){const e=[];for(const i of t){const t=await this.fetchStudentName(i);e.push(t||"ID "+i)}this.editNames=e},async fetchStudentName(t){try{const e=await fetch(this.apiInfo+"getAllInformationAboutUser.php?id="+encodeURIComponent(t),{credentials:"include"}),i=await e.text();let a;try{a=JSON.parse(i)}catch{a=null}const s=a?.data||a||{},o=String(s.firstname??s.name??"").trim(),n=String(s.lastname??s.surname??"").trim(),r=[o,n].filter(Boolean).join(" ").trim();return r||"ID "+t}catch{return"ID "+t}},async ulozitEdit(){if(this.error="",this.message="",!this.resolvedEditId)return void(this.error="Chýba ID hodiny.");if(!this.selectedEditDay)return void(this.error="Vyber deň.");if(!this.selectedEditTime)return void(this.error="Vyber čas.");const t=await this.overKolizie(this.selectedEditDay,this.selectedEditTime,this.resolvedEditId,"duo"===this.existujucaForma);if(t)this.error=t;else{this.loading=!0;try{await this.callEditCalendarUpdate({id:this.resolvedEditId,formOfStudy:this.existujucaForma,availability_day:this.dayToInt(this.selectedEditDay),availability_hour:this.hourToIntHHMM(this.selectedEditTime),student:this.existujuciStudenti}),await this.nacitajObsadene(),this.message="Hodina bola upravená.",this.$emit("updated",{id:this.resolvedEditId,day:this.selectedEditDay,time:this.selectedEditTime})}catch(e){this.error=e?.message||"Uloženie zlyhalo."}finally{this.loading=!1}}},async vymazatEdit(){if(this.error="",this.message="",this.resolvedEditId){this.loading=!0;try{await this.callEditCalendarDelete(this.resolvedEditId),this.message="Hodina bola vymazaná.",this.$emit("deleted",{id:this.resolvedEditId})}catch(t){this.error=t?.message||"Mazanie zlyhalo."}finally{this.loading=!1}}else this.error="Chýba ID hodiny."}},async mounted(){this.edit?(await Promise.all([this.nacitajDostupnost(),this.nacitajObsadene()]),this.resolvedEditId?await this.nacitajDetailHodiny(this.resolvedEditId):(this.incomingForm&&(this.existujucaForma="duo"===this.incomingForm?"duo":"solo"),this.incomingDay&&(this.selectedEditDay=this.incomingDay),this.incomingHour&&(this.selectedEditTime=this.normalizeHour(this.incomingHour))),this.nastavDefaultCas()):(this.incomingForm&&(this.dual="duo"===this.incomingForm),await Promise.all([this.nacitajZiakov(),this.nacitajDostupnost(),this.nacitajObsadene()]),this.nastavDefaultCas())},watch:{dual(){this.nastavDefaultCas()}}},U=i(89);const A=(0,U.Z)(j,[["render",H],["__scopeId","data-v-2b7aeea0"]]);var V=A}}]);