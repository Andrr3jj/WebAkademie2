"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[6709],{9303:function(e,t,i){i.d(t,{Z:function(){return c}});var s=i(3396);
/**
 * @license lucide-vue-next v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,((e,t,i)=>i?i.toUpperCase():t.toLowerCase())),l=e=>{const t=o(e);return t.charAt(0).toUpperCase()+t.slice(1)},n=(...e)=>e.filter(((e,t,i)=>Boolean(e)&&""!==e.trim()&&i.indexOf(e)===t)).join(" ").trim();
/**
 * @license lucide-vue-next v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};
/**
 * @license lucide-vue-next v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */
const d=({size:e,strokeWidth:t=2,absoluteStrokeWidth:i,color:o,iconNode:d,name:c,class:p,...u},{slots:h})=>(0,s.h)("svg",{...r,width:e||r.width,height:e||r.height,stroke:o||r.stroke,"stroke-width":i?24*Number(t)/Number(e):t,class:n("lucide",...c?[`lucide-${a(l(c))}-icon`,`lucide-${a(c)}`]:["lucide-icon"]),...u},[...d.map((e=>(0,s.h)(...e))),...h.default?[h.default()]:[]]),c=(e,t)=>(i,{slots:a})=>(0,s.h)(d,{...i,iconNode:t,name:e},a)},179:function(e,t,i){i.d(t,{Z:function(){return a}});var s=i(9303);
/**
 * @license lucide-vue-next v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a=(0,s.Z)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]])},1164:function(e,t,i){i.d(t,{Z:function(){return d}});var s=i(3396),a=i(7139);function o(e,t,i,o,l,n){return(0,s.wg)(),(0,s.iD)("span",{class:"sort-arrow",onClick:t[0]||(t[0]=(...e)=>n.toggleSort&&n.toggleSort(...e))},[((0,s.wg)(),(0,s.iD)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.7em",height:"0.7em",viewBox:"0 0 14 12",class:(0,a.C_)(["triangle-icon",n.rotationClass])},t[1]||(t[1]=[(0,s._)("path",{d:"M13.7814 2.28223C14.0658 1.81973 14.0752 1.23848 13.8095 0.766602C13.5439 0.294727 13.0439 0.000976574 12.5002 0.000976581L1.50015 0.000976612C0.956406 0.000976612 0.454801 0.294727 0.190776 0.766602C-0.0748491 1.23848 0.0623493 1.81973 0.218901 2.28223L5.7189 11.2822C5.99786 11.7917 6.47515 12.0015 7.00015 12.001C7.52515 12.001 8.0064 11.7291 8.2814 11.2822L13.7814 2.28223Z",fill:"black"},null,-1)]),2))])}var l={props:{column:String,sortKey:String,sortDirection:String},computed:{rotationClass(){return this.sortKey!==this.column?"neutral":"asc"===this.sortDirection?"rotate":""}},methods:{toggleSort(){let e="asc";this.sortKey===this.column&&"asc"===this.sortDirection?e="desc":this.sortKey===this.column&&"desc"===this.sortDirection&&(e=""),this.$emit("update:sort",{key:e?this.column:"",direction:e})}}},n=i(89);const r=(0,n.Z)(l,[["render",o],["__scopeId","data-v-93cbcb14"]]);var d=r},6709:function(e,t,i){i.r(t),i.d(t,{default:function(){return It}});var s={};i.r(s);var a=i(3396),o=i(7139),l=i(9242);const n={key:0,class:"invalid-dialog"},r={class:"dialog"},d=["id"],c={class:"scroll"},p={class:"generovanie"},u={class:"row-form vyber-switch"},h={style:{"margin-bottom":"0.3em"}},y={class:"dropdown-pagination"},m={class:"page-info"},g={class:"row-form"},b=["value"],v={class:"row-form"},k={key:0,disabled:"",value:""},w=["value"],f={class:"row-form"},_={key:0},D={style:{"font-size":"0.8em",color:"#666"}},z={class:"row-form"},S={class:"row-form"},V={class:"row-form"},C={key:0},P={key:1},K={key:0,class:"generated-codes"},O={style:{"list-style":"none",padding:"0"}},$={class:"all-statistic"},x={class:"darcekova-statistic"},F={class:"box-statistic"},L={class:"stat-item"},U={class:"hodnota"},B={class:"stat-item"},M={class:"hodnota"},A={class:"stat-item"},I={class:"hodnota"},E={class:"darcekova-statistic"},T={class:"box-statistic"},N={class:"stat-item"},j={class:"hodnota"},Z={class:"stat-item"},R={class:"hodnota"},H={class:"stat-item"},q={class:"hodnota"},W={ref:"tablesWrapper"},G={key:0,class:"darceky-table"},Y={class:"table-top"},J={class:"Bahnschrift"},X={class:"Bahnschrift"},Q={class:"Bahnschrift"},ee={class:"Bahnschrift"},te={class:"Bahnschrift"},ie={class:"Bahnschrift"},se={class:"table"},ae=["onKeyup"],oe=["onKeyup"],le={class:"edit-actions"},ne=["value"],re={class:"dropdown-wrapper"},de={key:0},ce={class:"picker-list"},pe=["value"],ue={class:"dropdown-wrapper"},he={key:0},ye={class:"picker-list"},me=["value"],ge=["onClick"],be=["onClick"],ve=["onDblclick"],ke={class:"item"},we={class:"item"},fe={class:"item"},_e={class:"item"},De={class:"item"},ze={class:"item"},Se={key:1,class:"darceky-table",style:{"margin-top":"1em"}},Ve={class:"table-top"},Ce={class:"Bahnschrift"},Pe={class:"Bahnschrift"},Ke={class:"Bahnschrift"},Oe={class:"Bahnschrift"},$e={class:"Bahnschrift"},xe={class:"Bahnschrift"},Fe={class:"table"},Le=["onKeyup"],Ue=["onKeyup"],Be=["onKeyup"],Me={class:"edit-actions"},Ae=["value"],Ie={class:"dropdown-wrapper"},Ee={key:0},Te={class:"picker-list"},Ne=["value"],je={class:"dropdown-wrapper"},Ze={key:0},Re={class:"picker-list"},He=["value"],qe=["onClick"],We=["onClick"],Ge=["onDblclick"],Ye={class:"item"},Je={class:"item"},Xe={class:"item"},Qe={class:"item"},et={class:"item"},tt={class:"item"},it={key:1,class:"table-actions"};function st(e,t,i,s,st,at){const ot=(0,a.up)("RefreshCcw"),lt=(0,a.up)("multiselect"),nt=(0,a.up)("SortArrow"),rt=(0,a.Q2)("click-outside");return(0,a.wg)(),(0,a.iD)(a.HY,null,[st.showInvalidDialog?((0,a.wg)(),(0,a.iD)("div",n,[t[58]||(t[58]=(0,a._)("div",{class:"dialog-backdrop"},null,-1)),(0,a._)("div",r,[(0,a._)("p",null,[t[54]||(t[54]=(0,a.Uk)(" Nasledujúce pesničky sú momentálne ")),t[55]||(t[55]=(0,a._)("strong",null,"neaktívne",-1)),t[56]||(t[56]=(0,a.Uk)(":")),t[57]||(t[57]=(0,a._)("br",null,null,-1)),(0,a._)("em",null,(0,o.zw)(st.invalidSongs.join(", ")),1)]),(0,a._)("button",{class:"button green",onClick:t[0]||(t[0]=(...e)=>at.onConfirmSkipInvalid&&at.onConfirmSkipInvalid(...e))}," Pokračovať bez nich "),(0,a._)("button",{class:"button red",onClick:t[1]||(t[1]=(...e)=>at.onCancelGenerate&&at.onCancelGenerate(...e))}," Zrušiť generovanie ")])])):(0,a.kq)("",!0),(0,a._)("section",{id:e.$route.name},[(0,a._)("div",c,[t[99]||(t[99]=(0,a._)("h1",null,"Administratívny systém",-1)),t[100]||(t[100]=(0,a._)("h5",null,"Darčekové poukážky / Kódy do knihy",-1)),t[101]||(t[101]=(0,a._)("div",{class:"line horizontal w-80"},null,-1)),t[102]||(t[102]=(0,a._)("p",{class:"nadpis"},"Generovanie darčekových poukážok",-1)),(0,a._)("div",p,[(0,a._)("div",u,[(0,a._)("div",null,[(0,a._)("label",h,(0,o.zw)("knihy"===st.vyberMode?"Vyber knižky":"Vyber zápisy"),1),(0,a._)("div",{class:(0,o.C_)(["arrow",{open:"zapisy"===st.vyberMode}]),onClick:t[2]||(t[2]=(...e)=>at.toggleVyberMode&&at.toggleVyberMode(...e)),style:{display:"inline-flex","align-items":"center",cursor:"pointer","margin-left":"1em"},title:"Prepnúť výber"},[(0,a.Wm)(ot,{style:{width:"1.25em"}})],2)]),"knihy"===st.vyberMode?((0,a.wg)(),(0,a.j4)(lt,{key:0,class:"my-multiselect",modelValue:st.generovanie.products,"onUpdate:modelValue":t[3]||(t[3]=e=>st.generovanie.products=e),options:st.availableProducts,multiple:!0,label:"label","track-by":"name",placeholder:st.isOpen?"":"Žiadne knihy",onOpen:t[4]||(t[4]=e=>st.isOpen=!0),onClose:t[5]||(t[5]=e=>st.isOpen=!1),"close-on-select":!1},{noResult:(0,a.w5)((()=>t[59]||(t[59]=[(0,a._)("span",null,"Nenašiel sa žiadny zápis.",-1)]))),_:1},8,["modelValue","options","placeholder"])):(0,a.kq)("",!0),"zapisy"===st.vyberMode?((0,a.wg)(),(0,a.j4)(lt,{key:1,class:"my-multiselect",modelValue:st.generovanie.zapisy,"onUpdate:modelValue":t[8]||(t[8]=e=>st.generovanie.zapisy=e),options:at.pagedZapisy,multiple:!0,label:"label","track-by":"name",placeholder:st.isOpen?"":"Žiadny zápis",onOpen:t[9]||(t[9]=e=>st.isOpen=!0),onClose:t[10]||(t[10]=e=>st.isOpen=!1),"close-on-select":!1,"max-height":350},{afterList:(0,a.w5)((()=>[(0,a._)("div",y,[(0,a._)("span",{class:(0,o.C_)(["arrow-btn",{disabled:0===st.zapisyPage}]),onClick:t[6]||(t[6]=(0,l.iM)((e=>st.zapisyPage>0&&st.zapisyPage--),["stop"])),title:"Predchádzajúce"},"<",2),(0,a._)("span",m,(0,o.zw)(st.zapisyPage+1)+" / "+(0,o.zw)(at.zapisyPageCount),1),(0,a._)("span",{class:(0,o.C_)(["arrow-btn",{disabled:st.zapisyPage>=at.zapisyPageCount-1}]),onClick:t[7]||(t[7]=(0,l.iM)((e=>st.zapisyPage<at.zapisyPageCount-1&&st.zapisyPage++),["stop"])),title:"Ďalšie"},">",2)])])),noResult:(0,a.w5)((()=>t[60]||(t[60]=[(0,a._)("span",null,"Nenašiel sa žiadny zápis.",-1)]))),_:1},8,["modelValue","options","placeholder"])):(0,a.kq)("",!0)]),(0,a._)("div",g,[t[62]||(t[62]=(0,a._)("label",{for:"accesses"},"Vyber prístupy:",-1)),(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":t[11]||(t[11]=e=>st.generovanie.accesses=e)},[t[61]||(t[61]=(0,a._)("option",{disabled:"",value:""},"Žiadny prístup",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableAccesses,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.id,value:e.id},(0,o.zw)(e.label),9,b)))),128))],512),[[l.bM,st.generovanie.accesses]])]),(0,a._)("div",v,[t[63]||(t[63]=(0,a._)("label",null,"Vyber predplatné:",-1)),(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":t[12]||(t[12]=e=>st.generovanie.subscription=e)},[st.generovanie.subscription?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("option",k," Žiadne predplatné ")),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableSubscriptions,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.id,value:e.id},(0,o.zw)(e.label),9,w)))),128))],512),[[l.bM,st.generovanie.subscription]])]),(0,a._)("div",f,[t[64]||(t[64]=(0,a._)("label",{for:"spec-kod"},"Špeciálny kód:",-1)),(0,a.wy)((0,a._)("input",{ref:"spec-kod",type:"text",name:"spec-kod",placeholder:"HELI-2024-XXXX","onUpdate:modelValue":t[13]||(t[13]=e=>st.generovanie.specKod=e),maxlength:"14",onInput:t[14]||(t[14]=(...e)=>at.onSpecKodInput&&at.onSpecKodInput(...e))},null,544),[[l.nr,st.generovanie.specKod]]),st.specKodProb?((0,a.wg)(),(0,a.iD)("div",_,[(0,a._)("span",D,(0,o.zw)(st.specKodProb),1)])):(0,a.kq)("",!0)]),(0,a._)("div",z,[t[65]||(t[65]=(0,a._)("label",{for:"value"},"Hodnota v €:",-1)),(0,a.wy)((0,a._)("input",{ref:"value",type:"number",min:"0",step:"1",name:"value",placeholder:"0","onUpdate:modelValue":t[15]||(t[15]=e=>st.generovanie.value=e),class:"hodnota"},null,512),[[l.nr,st.generovanie.value]])]),(0,a._)("div",S,[t[66]||(t[66]=(0,a._)("label",{for:"kusov"},"Počet ks:",-1)),(0,a.wy)((0,a._)("input",{ref:"kusov",type:"number",name:"kusov",placeholder:"0","onUpdate:modelValue":t[16]||(t[16]=t=>e.pocetKS=t),class:"hodnota"},null,512),[[l.nr,e.pocetKS]])]),(0,a._)("div",V,[t[67]||(t[67]=(0,a._)("label",null,"Generovať kódy:",-1)),(0,a._)("div",{class:(0,o.C_)(["button",{disabled:st.generating}]),onClick:t[17]||(t[17]=e=>at.generujPoukažky())},[st.generating?((0,a.wg)(),(0,a.iD)("p",P,"Generujem...")):((0,a.wg)(),(0,a.iD)("p",C,"Vytvoriť"))],2)])]),st.generatedCodes.length?((0,a.wg)(),(0,a.iD)("div",K,[t[68]||(t[68]=(0,a._)("h3",{style:{"font-size":"1.2em",margin:"1em 0 0.2em 0"}}," Vygenerované kódy: ",-1)),(0,a._)("ul",O,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.generatedCodes,((e,t)=>((0,a.wg)(),(0,a.iD)("li",{key:t},(0,o.zw)(e),1)))),128))]),(0,a._)("button",{class:"button",onClick:t[18]||(t[18]=(...e)=>at.downloadCSV&&at.downloadCSV(...e)),style:{"margin-top":"0.5em"}}," Stiahnuť ako CSV ")])):(0,a.kq)("",!0),(0,a._)("div",$,[(0,a._)("div",x,[t[72]||(t[72]=(0,a._)("p",{class:"nadpis"},"Darčekové poukážky",-1)),(0,a._)("div",F,[(0,a._)("div",L,[t[69]||(t[69]=(0,a._)("p",{class:"podnadpis"},"Zakúpené:",-1)),(0,a._)("p",U,(0,o.zw)(at.statsDarcekove.zakupene),1)]),(0,a._)("div",B,[t[70]||(t[70]=(0,a._)("p",{class:"podnadpis"},"Využité:",-1)),(0,a._)("p",M,(0,o.zw)(at.statsDarcekove.vyuzite),1)]),(0,a._)("div",A,[t[71]||(t[71]=(0,a._)("p",{class:"podnadpis"},"Nevyužité:",-1)),(0,a._)("p",I,(0,o.zw)(at.statsDarcekove.nevyuzite),1)])]),(0,a._)("div",{class:"button",onClick:t[19]||(t[19]=e=>at.showTable("user"))},[(0,a._)("p",null,(0,o.zw)(st.showDarcekoveTable?"Skryť":"Zobraziť"),1)])]),(0,a._)("div",E,[t[76]||(t[76]=(0,a._)("p",{class:"nadpis"},"Kódy do knižky",-1)),(0,a._)("div",T,[(0,a._)("div",N,[t[73]||(t[73]=(0,a._)("p",{class:"podnadpis"},"Vygenerované:",-1)),(0,a._)("p",j,(0,o.zw)(at.statsKody.vygenerovane),1)]),(0,a._)("div",Z,[t[74]||(t[74]=(0,a._)("p",{class:"podnadpis"},"Využité:",-1)),(0,a._)("p",R,(0,o.zw)(at.statsKody.vyuzite),1)]),(0,a._)("div",H,[t[75]||(t[75]=(0,a._)("p",{class:"podnadpis"},"Nevyužité:",-1)),(0,a._)("p",q,(0,o.zw)(at.statsKody.nevyuzite),1)])]),(0,a._)("div",{class:"button",onClick:t[20]||(t[20]=e=>at.showTable("admin"))},[(0,a._)("p",null,(0,o.zw)(st.showKodyTable?"Skryť":"Zobraziť"),1)])])]),(0,a._)("div",W,[st.showDarcekoveTable?((0,a.wg)(),(0,a.iD)("div",G,[(0,a._)("div",Y,[(0,a._)("p",J,[t[77]||(t[77]=(0,a.Uk)(" Email: ")),(0,a.Wm)(nt,{column:"origin",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",X,[t[78]||(t[78]=(0,a.Uk)(" Kód poukážky: ")),(0,a.Wm)(nt,{column:"code",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",Q,[t[79]||(t[79]=(0,a.Uk)(" Zakúpené: ")),(0,a.Wm)(nt,{column:"timestamp",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",ee,[t[80]||(t[80]=(0,a.Uk)(" Využil email: ")),(0,a.Wm)(nt,{column:"used_by",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",te,[t[81]||(t[81]=(0,a.Uk)(" Platnosť: ")),(0,a.Wm)(nt,{column:"valid_until",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",ie,[t[82]||(t[82]=(0,a.Uk)(" Hodnota ")),(0,a.Wm)(nt,{column:"value",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])])]),(0,a._)("div",se,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(at.zoradeneDarcekovePoukazky,((e,i)=>((0,a.wg)(),(0,a.iD)("div",{key:e.code},[at.isEdit("user",i)?(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{key:0,class:"table-row edit-mode",ref_for:!0,ref:at.setEditRowRef},[(0,a.wy)((0,a._)("input",{class:"item","onUpdate:modelValue":t[21]||(t[21]=e=>st.editForm.email=e),placeholder:"Email",onKeyup:(0,l.D2)((t=>at.ulozEditaciu(e)),["enter"])},null,40,ae),[[l.nr,st.editForm.email]]),(0,a.wy)((0,a._)("input",{class:"item","onUpdate:modelValue":t[22]||(t[22]=e=>st.editForm.code=e),placeholder:"Kód",disabled:""},null,512),[[l.nr,st.editForm.code]]),(0,a.wy)((0,a._)("input",{class:"item",type:"date","onUpdate:modelValue":t[23]||(t[23]=e=>st.editForm.timestamp=e),onKeyup:(0,l.D2)((t=>at.ulozEditaciu(e)),["enter"])},null,40,oe),[[l.nr,st.editForm.timestamp]]),(0,a.wy)((0,a._)("input",{class:"item","onUpdate:modelValue":t[24]||(t[24]=e=>st.editForm.used_by=e),placeholder:"Využil email",disabled:""},null,512),[[l.nr,st.editForm.used_by]]),(0,a.wy)((0,a._)("input",{class:"item",type:"date","onUpdate:modelValue":t[25]||(t[25]=e=>st.editForm.valid_until=e)},null,512),[[l.nr,st.editForm.valid_until]]),(0,a.wy)((0,a._)("input",{class:"item",type:"number","onUpdate:modelValue":t[26]||(t[26]=e=>st.editForm.value=e),placeholder:"Hodnota"},null,512),[[l.nr,st.editForm.value]]),(0,a._)("div",le,[(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":t[27]||(t[27]=e=>st.editForm.accesses=e)},[t[83]||(t[83]=(0,a._)("option",{disabled:"",value:""},"Žiadny prístup",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableAccesses,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.id,value:e.id},(0,o.zw)(e.label),9,ne)))),128))],512),[[l.bM,st.editForm.accesses]]),(0,a._)("div",re,[(0,a._)("button",{class:"button dropdown-btn",onClick:t[28]||(t[28]=(0,l.iM)(((...e)=>at.onOpenBooks&&at.onOpenBooks(...e)),["stop"]))},[t[84]||(t[84]=(0,a.Uk)(" Vybrať knihy ")),st.editForm.products.length?((0,a.wg)(),(0,a.iD)("span",de,"("+(0,o.zw)(st.editForm.products.length)+")",1)):(0,a.kq)("",!0)]),st.showBooksPicker?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"picker-popover",onClick:t[31]||(t[31]=(0,l.iM)((()=>{}),["stop"]))},[t[85]||(t[85]=(0,a._)("h5",null,"Vyber knihy",-1)),(0,a._)("div",ce,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableProducts,(e=>((0,a.wg)(),(0,a.iD)("label",{key:e.name},[(0,a.wy)((0,a._)("input",{type:"checkbox",value:e,"onUpdate:modelValue":t[29]||(t[29]=e=>st.editForm.products=e)},null,8,pe),[[l.e8,st.editForm.products]]),(0,a.Uk)(" "+(0,o.zw)(e.label),1)])))),128))]),(0,a._)("button",{class:"button green",onClick:t[30]||(t[30]=e=>st.showBooksPicker=!1)}," Hotovo ")])):(0,a.kq)("",!0)]),(0,a._)("div",ue,[(0,a._)("button",{class:"button dropdown-btn",onClick:t[32]||(t[32]=(0,l.iM)(((...e)=>at.onOpenZapisy&&at.onOpenZapisy(...e)),["stop"]))},[t[86]||(t[86]=(0,a.Uk)(" Vybrať zápisy ")),st.editForm.zapisy.length?((0,a.wg)(),(0,a.iD)("span",he,"("+(0,o.zw)(st.editForm.zapisy.length)+")",1)):(0,a.kq)("",!0)]),st.showZapisyPicker?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"picker-popover",onClick:t[35]||(t[35]=(0,l.iM)((()=>{}),["stop"]))},[t[87]||(t[87]=(0,a._)("h5",null,"Vyber zápisy",-1)),(0,a._)("div",ye,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableZapisy,(e=>((0,a.wg)(),(0,a.iD)("label",{key:e.id},[(0,a.wy)((0,a._)("input",{type:"checkbox",value:e,"onUpdate:modelValue":t[33]||(t[33]=e=>st.editForm.zapisy=e)},null,8,me),[[l.e8,st.editForm.zapisy]]),(0,a.Uk)(" "+(0,o.zw)(e.label),1)])))),128))]),(0,a._)("button",{class:"button green",onClick:t[34]||(t[34]=e=>st.showZapisyPicker=!1)}," Hotovo ")])):(0,a.kq)("",!0)]),(0,a._)("button",{onClick:(0,l.iM)((t=>at.ulozEditaciu(e)),["stop"]),class:"button green"}," Aplikovať ",8,ge),(0,a._)("button",{onClick:(0,l.iM)((t=>at.confirmDelete(e.id)),["stop"]),class:(0,o.C_)(["button",(st.confirmDeleteId,e.id,"red")])},(0,o.zw)(st.confirmDeleteId===e.id?"Naozaj?":"Vymazať"),11,be),(0,a._)("button",{onClick:t[36]||(t[36]=(0,l.iM)((e=>at.zrusEditaciu()),["stop"])),class:"button gray"}," Zrušiť ")])])),[[rt,{handler:at.zrusEditaciu,events:["mousedown"]}]]):((0,a.wg)(),(0,a.iD)("div",{key:1,class:"table-row",onDblclick:t=>at.zacniEditaciu("user",i,e)},[(0,a._)("span",ke,(0,o.zw)(e.origin||"--"),1),(0,a._)("span",we,(0,o.zw)(e.code||"--"),1),(0,a._)("span",fe,(0,o.zw)(e.timestamp||"--"),1),(0,a._)("span",_e,(0,o.zw)(Array.isArray(e.used_by_emails)?e.used_by_emails.join(", "):e.used_by||"--"),1),(0,a._)("span",De,(0,o.zw)(at.formatDateInput(e.valid_until)||"--"),1),(0,a._)("span",ze,[e.value_original||e.value?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,o.zw)(Number(e.value)||0)+" / "+(0,o.zw)(Number(e.value_original)||0)+" € ",1)],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Uk)(" -- ")],64))])],40,ve))])))),128))])])):(0,a.kq)("",!0),st.showKodyTable?((0,a.wg)(),(0,a.iD)("div",Se,[(0,a._)("div",Ve,[(0,a._)("p",Ce,[t[88]||(t[88]=(0,a.Uk)(" Email: ")),(0,a.Wm)(nt,{column:"origin",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",Pe,[t[89]||(t[89]=(0,a.Uk)(" Kód poukážky: ")),(0,a.Wm)(nt,{column:"code",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",Ke,[t[90]||(t[90]=(0,a.Uk)(" Zakúpené: ")),(0,a.Wm)(nt,{column:"timestamp",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",Oe,[t[91]||(t[91]=(0,a.Uk)(" Využil email: ")),(0,a.Wm)(nt,{column:"used_by",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",$e,[t[92]||(t[92]=(0,a.Uk)(" Platnosť: ")),(0,a.Wm)(nt,{column:"valid_until",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("p",xe,[t[93]||(t[93]=(0,a.Uk)(" Hodnota ")),(0,a.Wm)(nt,{column:"value",sortKey:st.sortKey,sortDirection:st.sortDirection,"onUpdate:sort":at.onSortChange},null,8,["sortKey","sortDirection","onUpdate:sort"])])]),(0,a._)("div",Fe,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(at.zoradeneKodyDoKnihy,((e,i)=>((0,a.wg)(),(0,a.iD)("div",{key:e.code},[at.isEdit("admin",i)?(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",{key:0,class:"table-row edit-mode",ref_for:!0,ref:at.setEditRowRef},[(0,a.wy)((0,a._)("input",{class:"item","onUpdate:modelValue":t[37]||(t[37]=e=>st.editForm.email=e),placeholder:"Email",onKeyup:(0,l.D2)((t=>at.ulozEditaciu(e)),["enter"])},null,40,Le),[[l.nr,st.editForm.email]]),(0,a.wy)((0,a._)("input",{class:"item","onUpdate:modelValue":t[38]||(t[38]=e=>st.editForm.code=e),placeholder:"Kód",onKeyup:(0,l.D2)((t=>at.ulozEditaciu(e)),["enter"])},null,40,Ue),[[l.nr,st.editForm.code]]),(0,a.wy)((0,a._)("input",{class:"item",type:"date","onUpdate:modelValue":t[39]||(t[39]=e=>st.editForm.timestamp=e),onKeyup:(0,l.D2)((t=>at.ulozEditaciu(e)),["enter"]),disabled:""},null,40,Be),[[l.nr,st.editForm.timestamp]]),(0,a.wy)((0,a._)("input",{class:"item","onUpdate:modelValue":t[40]||(t[40]=e=>st.editForm.used_by=e),placeholder:"Využil email",disabled:""},null,512),[[l.nr,st.editForm.used_by]]),(0,a.wy)((0,a._)("input",{class:"item",type:"date","onUpdate:modelValue":t[41]||(t[41]=e=>st.editForm.valid_until=e)},null,512),[[l.nr,st.editForm.valid_until]]),(0,a.wy)((0,a._)("input",{class:"item",type:"number","onUpdate:modelValue":t[42]||(t[42]=e=>st.editForm.value=e),placeholder:"Hodnota"},null,512),[[l.nr,st.editForm.value]]),(0,a._)("div",Me,[(0,a.wy)((0,a._)("select",{"onUpdate:modelValue":t[43]||(t[43]=e=>st.editForm.accesses=e)},[t[94]||(t[94]=(0,a._)("option",{disabled:"",value:""},"Žiadny prístup",-1)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableAccesses,(e=>((0,a.wg)(),(0,a.iD)("option",{key:e.id,value:e.id},(0,o.zw)(e.label),9,Ae)))),128))],512),[[l.bM,st.editForm.accesses]]),(0,a._)("div",Ie,[(0,a._)("button",{class:"button dropdown-btn",onClick:t[44]||(t[44]=(0,l.iM)(((...e)=>at.onOpenBooks&&at.onOpenBooks(...e)),["stop"]))},[t[95]||(t[95]=(0,a.Uk)(" Vybrať knihy ")),st.editForm.products.length?((0,a.wg)(),(0,a.iD)("span",Ee,"("+(0,o.zw)(st.editForm.products.length)+")",1)):(0,a.kq)("",!0)]),st.showBooksPicker?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"picker-popover",onClick:t[47]||(t[47]=(0,l.iM)((()=>{}),["stop"]))},[t[96]||(t[96]=(0,a._)("h5",null,"Vyber knihy",-1)),(0,a._)("div",Te,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableProducts,(e=>((0,a.wg)(),(0,a.iD)("label",{key:e.name},[(0,a.wy)((0,a._)("input",{type:"checkbox",value:e,"onUpdate:modelValue":t[45]||(t[45]=e=>st.editForm.products=e)},null,8,Ne),[[l.e8,st.editForm.products]]),(0,a.Uk)(" "+(0,o.zw)(e.label),1)])))),128))]),(0,a._)("button",{class:"button green",onClick:t[46]||(t[46]=e=>st.showBooksPicker=!1)}," Hotovo ")])):(0,a.kq)("",!0)]),(0,a._)("div",je,[(0,a._)("button",{class:"button dropdown-btn",onClick:t[48]||(t[48]=(0,l.iM)(((...e)=>at.onOpenZapisy&&at.onOpenZapisy(...e)),["stop"]))},[t[97]||(t[97]=(0,a.Uk)(" Vybrať zápisy ")),st.editForm.zapisy.length?((0,a.wg)(),(0,a.iD)("span",Ze,"("+(0,o.zw)(st.editForm.zapisy.length)+")",1)):(0,a.kq)("",!0)]),st.showZapisyPicker?((0,a.wg)(),(0,a.iD)("div",{key:0,class:"picker-popover",onClick:t[51]||(t[51]=(0,l.iM)((()=>{}),["stop"]))},[t[98]||(t[98]=(0,a._)("h5",null,"Vyber zápisy",-1)),(0,a._)("div",Re,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(st.availableZapisy,(e=>((0,a.wg)(),(0,a.iD)("label",{key:e.id},[(0,a.wy)((0,a._)("input",{type:"checkbox",value:e,"onUpdate:modelValue":t[49]||(t[49]=e=>st.editForm.zapisy=e)},null,8,He),[[l.e8,st.editForm.zapisy]]),(0,a.Uk)(" "+(0,o.zw)(e.label),1)])))),128))]),(0,a._)("button",{class:"button green",onClick:t[50]||(t[50]=e=>st.showZapisyPicker=!1)}," Hotovo ")])):(0,a.kq)("",!0)]),(0,a._)("button",{onClick:(0,l.iM)((t=>at.ulozEditaciu(e)),["stop"]),class:"button green"}," Aplikovať ",8,qe),(0,a._)("button",{onClick:(0,l.iM)((t=>at.confirmDelete(e.id)),["stop"]),class:(0,o.C_)(["button",(st.confirmDeleteId,e.id,"red")])},(0,o.zw)(st.confirmDeleteId===e.id?"Naozaj?":"Vymazať"),11,We),(0,a._)("button",{onClick:t[52]||(t[52]=(0,l.iM)((e=>at.zrusEditaciu()),["stop"])),class:"button yellow"}," Zrušiť ")])])),[[rt,{handler:at.zrusEditaciu,events:["mousedown"]}]]):((0,a.wg)(),(0,a.iD)("div",{key:1,class:"table-row",onDblclick:t=>at.zacniEditaciu("admin",i,e)},[(0,a._)("span",Ye,(0,o.zw)(e.origin||"--"),1),(0,a._)("span",Je,(0,o.zw)(e.code||"--"),1),(0,a._)("span",Xe,(0,o.zw)(e.timestamp||"--"),1),(0,a._)("span",Qe,(0,o.zw)(Array.isArray(e.used_by_emails)?e.used_by_emails.join(", "):e.used_by||"--"),1),(0,a._)("span",et,(0,o.zw)(at.formatDateInput(e.valid_until)||"--"),1),(0,a._)("span",tt,[e.value_original||e.value?((0,a.wg)(),(0,a.iD)(a.HY,{key:1},[(0,a.Uk)((0,o.zw)(Number(e.value)||0)+" / "+(0,o.zw)(Number(e.value_original)||0)+" € ",1)],64)):((0,a.wg)(),(0,a.iD)(a.HY,{key:0},[(0,a.Uk)(" -- ")],64))])],40,Ge))])))),128))])])):(0,a.kq)("",!0)],512),at.showLoadMore&&at.shouldShowLoadMore?((0,a.wg)(),(0,a.iD)("div",it,[(0,a._)("button",{class:"button yellow",onClick:t[53]||(t[53]=e=>st.limit+=20)}," Načítať ďalšie ")])):(0,a.kq)("",!0)])],8,d)],64)}i(560),i(8858),i(1318),i(3228);function at(e){return 0!==e&&(!(!Array.isArray(e)||0!==e.length)||!e)}function ot(e){return(...t)=>!e(...t)}function lt(e,t){void 0===e&&(e="undefined"),null===e&&(e="null"),!1===e&&(e="false");const i=e.toString().toLowerCase();return-1!==i.indexOf(t.trim())}function nt(e){return e.filter((e=>!e.$isLabel))}function rt(e,t){return i=>i.reduce(((i,s)=>s[e]&&s[e].length?(i.push({$groupLabel:s[t],$isLabel:!0}),i.concat(s[e])):i),[])}const dt=(...e)=>t=>e.reduce(((e,t)=>t(e)),t);var ct={data(){return{search:"",isOpen:!1,preferredOpenDirection:"below",optimizedHeight:this.maxHeight}},props:{internalSearch:{type:Boolean,default:!0},options:{type:Array,required:!0},multiple:{type:Boolean,default:!1},trackBy:{type:String},label:{type:String},searchable:{type:Boolean,default:!0},clearOnSelect:{type:Boolean,default:!0},hideSelected:{type:Boolean,default:!1},placeholder:{type:String,default:"Select option"},allowEmpty:{type:Boolean,default:!0},resetAfter:{type:Boolean,default:!1},closeOnSelect:{type:Boolean,default:!0},customLabel:{type:Function,default(e,t){return at(e)?"":t?e[t]:e}},taggable:{type:Boolean,default:!1},tagPlaceholder:{type:String,default:"Press enter to create a tag"},tagPosition:{type:String,default:"top"},max:{type:[Number,Boolean],default:!1},id:{default:null},optionsLimit:{type:Number,default:1e3},groupValues:{type:String},groupLabel:{type:String},groupSelect:{type:Boolean,default:!1},blockKeys:{type:Array,default(){return[]}},preserveSearch:{type:Boolean,default:!1},preselectFirst:{type:Boolean,default:!1},preventAutofocus:{type:Boolean,default:!1},filteringSortFunc:{type:Function,default:null}},mounted(){!this.multiple&&this.max,this.preselectFirst&&!this.internalValue.length&&this.options.length&&this.select(this.filteredOptions[0])},computed:{internalValue(){return this.modelValue||0===this.modelValue?Array.isArray(this.modelValue)?this.modelValue:[this.modelValue]:[]},filteredOptions(){const e=this.search||"",t=e.toLowerCase().trim();let i=this.options.concat();return i=this.internalSearch?this.groupValues?this.filterAndFlat(i,t,this.label):this.filterOptions(i,t,this.label,this.customLabel):this.groupValues?rt(this.groupValues,this.groupLabel)(i):i,i=this.hideSelected?i.filter(ot(this.isSelected)):i,this.taggable&&t.length&&!this.isExistingOption(t)&&("bottom"===this.tagPosition?i.push({isTag:!0,label:e}):i.unshift({isTag:!0,label:e})),i.slice(0,this.optionsLimit)},valueKeys(){return this.trackBy?this.internalValue.map((e=>e[this.trackBy])):this.internalValue},optionKeys(){const e=this.groupValues?this.flatAndStrip(this.options):this.options;return e.map((e=>this.customLabel(e,this.label).toString().toLowerCase()))},currentOptionLabel(){return this.multiple?this.searchable?"":this.placeholder:this.internalValue.length?this.getOptionLabel(this.internalValue[0]):this.searchable?"":this.placeholder}},watch:{internalValue:{handler(){this.resetAfter&&this.internalValue.length&&(this.search="",this.$emit("update:modelValue",this.multiple?[]:null))},deep:!0},search(){this.$emit("search-change",this.search)}},emits:["open","search-change","close","select","update:modelValue","remove","tag"],methods:{getValue(){return this.multiple?this.internalValue:0===this.internalValue.length?null:this.internalValue[0]},filterAndFlat(e,t,i){return dt(this.filterGroups(t,i,this.groupValues,this.groupLabel,this.customLabel),rt(this.groupValues,this.groupLabel))(e)},flatAndStrip(e){return dt(rt(this.groupValues,this.groupLabel),nt)(e)},updateSearch(e){this.search=e},isExistingOption(e){return!!this.options&&this.optionKeys.indexOf(e)>-1},isSelected(e){const t=this.trackBy?e[this.trackBy]:e;return this.valueKeys.indexOf(t)>-1},isOptionDisabled(e){return!!e.$isDisabled},getOptionLabel(e){if(at(e))return"";if(e.isTag)return e.label;if(e.$isLabel)return e.$groupLabel;const t=this.customLabel(e,this.label);return at(t)?"":t},select(e,t){if(e.$isLabel&&this.groupSelect)this.selectGroup(e);else if(!(-1!==this.blockKeys.indexOf(t)||this.disabled||e.$isDisabled||e.$isLabel)&&(!this.max||!this.multiple||this.internalValue.length!==this.max)&&("Tab"!==t||this.pointerDirty)){if(e.isTag)this.$emit("tag",e.label,this.id),this.search="",this.closeOnSelect&&!this.multiple&&this.deactivate();else{const i=this.isSelected(e);if(i)return void("Tab"!==t&&this.removeElement(e));this.multiple?this.$emit("update:modelValue",this.internalValue.concat([e])):this.$emit("update:modelValue",e),this.$emit("select",e,this.id),this.clearOnSelect&&(this.search="")}this.closeOnSelect&&this.deactivate()}},selectGroup(e){const t=this.options.find((t=>t[this.groupLabel]===e.$groupLabel));if(t){if(this.wholeGroupSelected(t)){this.$emit("remove",t[this.groupValues],this.id);const e=this.trackBy?t[this.groupValues].map((e=>e[this.trackBy])):t[this.groupValues],i=this.internalValue.filter((t=>-1===e.indexOf(this.trackBy?t[this.trackBy]:t)));this.$emit("update:modelValue",i)}else{const e=t[this.groupValues].filter((e=>!(this.isOptionDisabled(e)||this.isSelected(e))));this.max&&e.splice(this.max-this.internalValue.length),this.$emit("select",e,this.id),this.$emit("update:modelValue",this.internalValue.concat(e))}this.closeOnSelect&&this.deactivate()}},wholeGroupSelected(e){return e[this.groupValues].every((e=>this.isSelected(e)||this.isOptionDisabled(e)))},wholeGroupDisabled(e){return e[this.groupValues].every(this.isOptionDisabled)},removeElement(e,t=!0){if(this.disabled)return;if(e.$isDisabled)return;if(!this.allowEmpty&&this.internalValue.length<=1)return void this.deactivate();const i="object"===typeof e?this.valueKeys.indexOf(e[this.trackBy]):this.valueKeys.indexOf(e);if(this.multiple){const e=this.internalValue.slice(0,i).concat(this.internalValue.slice(i+1));this.$emit("update:modelValue",e)}else this.$emit("update:modelValue",null);this.$emit("remove",e,this.id),this.closeOnSelect&&t&&this.deactivate()},removeLastElement(){-1===this.blockKeys.indexOf("Delete")&&0===this.search.length&&Array.isArray(this.internalValue)&&this.internalValue.length&&this.removeElement(this.internalValue[this.internalValue.length-1],!1)},activate(){this.isOpen||this.disabled||(this.adjustPosition(),this.groupValues&&0===this.pointer&&this.filteredOptions.length&&(this.pointer=1),this.isOpen=!0,this.searchable?(this.preserveSearch||(this.search=""),this.preventAutofocus||this.$nextTick((()=>this.$refs.search&&this.$refs.search.focus()))):this.preventAutofocus||"undefined"!==typeof this.$el&&this.$el.focus(),this.$emit("open",this.id))},deactivate(){this.isOpen&&(this.isOpen=!1,this.searchable?null!==this.$refs.search&&"undefined"!==typeof this.$refs.search&&this.$refs.search.blur():"undefined"!==typeof this.$el&&this.$el.blur(),this.preserveSearch||(this.search=""),this.$emit("close",this.getValue(),this.id))},toggle(){this.isOpen?this.deactivate():this.activate()},adjustPosition(){if("undefined"===typeof window)return;const e=this.$el.getBoundingClientRect().top,t=window.innerHeight-this.$el.getBoundingClientRect().bottom,i=t>this.maxHeight;i||t>e||"below"===this.openDirection||"bottom"===this.openDirection?(this.preferredOpenDirection="below",this.optimizedHeight=Math.min(t-40,this.maxHeight)):(this.preferredOpenDirection="above",this.optimizedHeight=Math.min(e-40,this.maxHeight))},filterOptions(e,t,i,s){return t?e.filter((e=>lt(s(e,i),t))).sort(((e,t)=>"function"===typeof this.filteringSortFunc?this.filteringSortFunc(e,t):s(e,i).length-s(t,i).length)):e},filterGroups(e,t,i,s,a){return o=>o.map((o=>{if(!o[i])return[];const l=this.filterOptions(o[i],e,t,a);return l.length?{[s]:o[s],[i]:l}:[]}))}}},pt={data(){return{pointer:0,pointerDirty:!1}},props:{showPointer:{type:Boolean,default:!0},optionHeight:{type:Number,default:40}},computed:{pointerPosition(){return this.pointer*this.optionHeight},visibleElements(){return this.optimizedHeight/this.optionHeight}},watch:{filteredOptions(){this.pointerAdjust()},isOpen(){this.pointerDirty=!1},pointer(){this.$refs.search&&this.$refs.search.setAttribute("aria-activedescendant",this.id+"-"+this.pointer.toString())}},methods:{optionHighlight(e,t){return{"multiselect__option--highlight":e===this.pointer&&this.showPointer,"multiselect__option--selected":this.isSelected(t)}},groupHighlight(e,t){if(!this.groupSelect)return["multiselect__option--disabled",{"multiselect__option--group":t.$isLabel}];const i=this.options.find((e=>e[this.groupLabel]===t.$groupLabel));return i&&!this.wholeGroupDisabled(i)?["multiselect__option--group",{"multiselect__option--highlight":e===this.pointer&&this.showPointer},{"multiselect__option--group-selected":this.wholeGroupSelected(i)}]:"multiselect__option--disabled"},addPointerElement({key:e}="Enter"){this.filteredOptions.length>0&&this.select(this.filteredOptions[this.pointer],e),this.pointerReset()},pointerForward(){this.pointer<this.filteredOptions.length-1&&(this.pointer++,this.$refs.list.scrollTop<=this.pointerPosition-(this.visibleElements-1)*this.optionHeight&&(this.$refs.list.scrollTop=this.pointerPosition-(this.visibleElements-1)*this.optionHeight),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()),this.pointerDirty=!0},pointerBackward(){this.pointer>0?(this.pointer--,this.$refs.list.scrollTop>=this.pointerPosition&&(this.$refs.list.scrollTop=this.pointerPosition),this.filteredOptions[this.pointer]&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerBackward()):this.filteredOptions[this.pointer]&&this.filteredOptions[0].$isLabel&&!this.groupSelect&&this.pointerForward(),this.pointerDirty=!0},pointerReset(){this.closeOnSelect&&(this.pointer=0,this.$refs.list&&(this.$refs.list.scrollTop=0))},pointerAdjust(){this.pointer>=this.filteredOptions.length-1&&(this.pointer=this.filteredOptions.length?this.filteredOptions.length-1:0),this.filteredOptions.length>0&&this.filteredOptions[this.pointer].$isLabel&&!this.groupSelect&&this.pointerForward()},pointerSet(e){this.pointer=e,this.pointerDirty=!0}}},ut={name:"vue-multiselect",mixins:[ct,pt],compatConfig:{MODE:3,ATTR_ENUMERATED_COERCION:!1},props:{name:{type:String,default:""},modelValue:{type:null,default(){return[]}},selectLabel:{type:String,default:"Press enter to select"},selectGroupLabel:{type:String,default:"Press enter to select group"},selectedLabel:{type:String,default:"Selected"},deselectLabel:{type:String,default:"Press enter to remove"},deselectGroupLabel:{type:String,default:"Press enter to deselect group"},showLabels:{type:Boolean,default:!0},limit:{type:Number,default:99999},maxHeight:{type:Number,default:300},limitText:{type:Function,default:e=>`and ${e} more`},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},spellcheck:{type:Boolean,default:!1},openDirection:{type:String,default:""},showNoOptions:{type:Boolean,default:!0},showNoResults:{type:Boolean,default:!0},tabindex:{type:Number,default:0},required:{type:Boolean,default:!1}},computed:{hasOptionGroup(){return this.groupValues&&this.groupLabel&&this.groupSelect},isSingleLabelVisible(){return(this.singleValue||0===this.singleValue)&&(!this.isOpen||!this.searchable)&&!this.visibleValues.length},isPlaceholderVisible(){return!this.internalValue.length&&(!this.searchable||!this.isOpen)},visibleValues(){return this.multiple?this.internalValue.slice(0,this.limit):[]},singleValue(){return this.internalValue[0]},deselectLabelText(){return this.showLabels?this.deselectLabel:""},deselectGroupLabelText(){return this.showLabels?this.deselectGroupLabel:""},selectLabelText(){return this.showLabels?this.selectLabel:""},selectGroupLabelText(){return this.showLabels?this.selectGroupLabel:""},selectedLabelText(){return this.showLabels?this.selectedLabel:""},inputStyle(){return this.searchable||this.multiple&&this.modelValue&&this.modelValue.length?this.isOpen?{width:"100%"}:{width:"0",position:"absolute",padding:"0"}:""},contentStyle(){return this.options.length?{display:"inline-block"}:{display:"block"}},isAbove(){return"above"===this.openDirection||"top"===this.openDirection||"below"!==this.openDirection&&"bottom"!==this.openDirection&&"above"===this.preferredOpenDirection},showSearchInput(){return this.searchable&&(!this.hasSingleSelectedSlot||!this.visibleSingleValue&&0!==this.visibleSingleValue||this.isOpen)},isRequired(){return!1!==this.required&&this.internalValue.length<=0}}};const ht=["tabindex","aria-expanded","aria-owns","aria-activedescendant"],yt={ref:"tags",class:"multiselect__tags"},mt={class:"multiselect__tags-wrap"},gt=["textContent"],bt=["onKeypress","onMousedown"],vt=["textContent"],kt={class:"multiselect__spinner"},wt=["name","id","spellcheck","placeholder","required","value","disabled","tabindex","aria-label","aria-controls"],ft=["id","aria-multiselectable"],_t={key:0},Dt={class:"multiselect__option"},zt=["aria-selected","id","role"],St=["onClick","onMouseenter","data-select","data-selected","data-deselect"],Vt=["data-select","data-deselect","onMouseenter","onMousedown"],Ct={class:"multiselect__option"},Pt={class:"multiselect__option"};function Kt(e,t,i,s,n,r){return(0,a.wg)(),(0,a.iD)("div",{tabindex:e.searchable?-1:i.tabindex,class:(0,o.C_)([{"multiselect--active":e.isOpen,"multiselect--disabled":i.disabled,"multiselect--above":r.isAbove,"multiselect--has-options-group":r.hasOptionGroup},"multiselect"]),onFocus:t[14]||(t[14]=t=>e.activate()),onBlur:t[15]||(t[15]=t=>!e.searchable&&e.deactivate()),onKeydown:[t[16]||(t[16]=(0,l.D2)((0,l.iM)((t=>e.pointerForward()),["self","prevent"]),["down"])),t[17]||(t[17]=(0,l.D2)((0,l.iM)((t=>e.pointerBackward()),["self","prevent"]),["up"]))],onKeypress:t[18]||(t[18]=(0,l.D2)((0,l.iM)((t=>e.addPointerElement(t)),["stop","self"]),["enter","tab"])),onKeyup:t[19]||(t[19]=(0,l.D2)((t=>e.deactivate()),["esc"])),role:"combobox","aria-expanded":e.isOpen,"aria-owns":"listbox-"+e.id,"aria-activedescendant":e.isOpen&&null!==e.pointer?e.id+"-"+e.pointer:null},[(0,a.WI)(e.$slots,"caret",{toggle:e.toggle},(()=>[(0,a._)("div",{onMousedown:t[0]||(t[0]=(0,l.iM)((t=>e.toggle()),["prevent","stop"])),class:"multiselect__select"},null,32)])),(0,a.WI)(e.$slots,"clear",{search:e.search}),(0,a._)("div",yt,[(0,a.WI)(e.$slots,"selection",{search:e.search,remove:e.removeElement,values:r.visibleValues,isOpen:e.isOpen},(()=>[(0,a.wy)((0,a._)("div",mt,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(r.visibleValues,((i,s)=>(0,a.WI)(e.$slots,"tag",{option:i,search:e.search,remove:e.removeElement},(()=>[((0,a.wg)(),(0,a.iD)("span",{class:"multiselect__tag",key:s,onMousedown:t[1]||(t[1]=(0,l.iM)((()=>{}),["prevent"]))},[(0,a._)("span",{textContent:(0,o.zw)(e.getOptionLabel(i))},null,8,gt),(0,a._)("i",{tabindex:"1",onKeypress:(0,l.D2)((0,l.iM)((t=>e.removeElement(i)),["prevent"]),["enter"]),onMousedown:(0,l.iM)((t=>e.removeElement(i)),["prevent"]),class:"multiselect__tag-icon"},null,40,bt)],32))])))),256))],512),[[l.F8,r.visibleValues.length>0]]),e.internalValue&&e.internalValue.length>i.limit?(0,a.WI)(e.$slots,"limit",{key:0},(()=>[(0,a._)("strong",{class:"multiselect__strong",textContent:(0,o.zw)(i.limitText(e.internalValue.length-i.limit))},null,8,vt)])):(0,a.kq)("v-if",!0)])),(0,a.Wm)(l.uT,{name:"multiselect__loading"},{default:(0,a.w5)((()=>[(0,a.WI)(e.$slots,"loading",{},(()=>[(0,a.wy)((0,a._)("div",kt,null,512),[[l.F8,i.loading]])]))])),_:3}),e.searchable?((0,a.wg)(),(0,a.iD)("input",{key:0,ref:"search",name:i.name,id:e.id,type:"text",autocomplete:"off",spellcheck:i.spellcheck,placeholder:e.placeholder,required:r.isRequired,style:(0,o.j5)(r.inputStyle),value:e.search,disabled:i.disabled,tabindex:i.tabindex,"aria-label":i.name+"-searchbox",onInput:t[2]||(t[2]=t=>e.updateSearch(t.target.value)),onFocus:t[3]||(t[3]=(0,l.iM)((t=>e.activate()),["prevent"])),onBlur:t[4]||(t[4]=(0,l.iM)((t=>e.deactivate()),["prevent"])),onKeyup:t[5]||(t[5]=(0,l.D2)((t=>e.deactivate()),["esc"])),onKeydown:[t[6]||(t[6]=(0,l.D2)((0,l.iM)((t=>e.pointerForward()),["prevent"]),["down"])),t[7]||(t[7]=(0,l.D2)((0,l.iM)((t=>e.pointerBackward()),["prevent"]),["up"])),t[9]||(t[9]=(0,l.D2)((0,l.iM)((t=>e.removeLastElement()),["stop"]),["delete"]))],onKeypress:t[8]||(t[8]=(0,l.D2)((0,l.iM)((t=>e.addPointerElement(t)),["prevent","stop","self"]),["enter"])),class:"multiselect__input","aria-controls":"listbox-"+e.id},null,44,wt)):(0,a.kq)("v-if",!0),r.isSingleLabelVisible?((0,a.wg)(),(0,a.iD)("span",{key:1,class:"multiselect__single",onMousedown:t[10]||(t[10]=(0,l.iM)(((...t)=>e.toggle&&e.toggle(...t)),["prevent"]))},[(0,a.WI)(e.$slots,"singleLabel",{option:r.singleValue},(()=>[(0,a.Uk)((0,o.zw)(e.currentOptionLabel),1)]))],32)):(0,a.kq)("v-if",!0),r.isPlaceholderVisible?((0,a.wg)(),(0,a.iD)("span",{key:2,class:"multiselect__placeholder",onMousedown:t[11]||(t[11]=(0,l.iM)(((...t)=>e.toggle&&e.toggle(...t)),["prevent"]))},[(0,a.WI)(e.$slots,"placeholder",{},(()=>[(0,a.Uk)((0,o.zw)(e.placeholder),1)]))],32)):(0,a.kq)("v-if",!0)],512),(0,a.Wm)(l.uT,{name:"multiselect",persisted:""},{default:(0,a.w5)((()=>[(0,a.wy)((0,a._)("div",{class:"multiselect__content-wrapper",onFocus:t[12]||(t[12]=(...t)=>e.activate&&e.activate(...t)),tabindex:"-1",onMousedown:t[13]||(t[13]=(0,l.iM)((()=>{}),["prevent"])),style:(0,o.j5)({maxHeight:e.optimizedHeight+"px"}),ref:"list"},[(0,a._)("ul",{class:"multiselect__content",style:(0,o.j5)(r.contentStyle),role:"listbox",id:"listbox-"+e.id,"aria-multiselectable":e.multiple},[(0,a.WI)(e.$slots,"beforeList"),e.multiple&&e.max===e.internalValue.length?((0,a.wg)(),(0,a.iD)("li",_t,[(0,a._)("span",Dt,[(0,a.WI)(e.$slots,"maxElements",{},(()=>[(0,a.Uk)("Maximum of "+(0,o.zw)(e.max)+" options selected. First remove a selected option to select another.",1)]))])])):(0,a.kq)("v-if",!0),!e.max||e.internalValue.length<e.max?((0,a.wg)(!0),(0,a.iD)(a.HY,{key:1},(0,a.Ko)(e.filteredOptions,((t,i)=>((0,a.wg)(),(0,a.iD)("li",{class:"multiselect__element",key:i,"aria-selected":e.isSelected(t),id:e.id+"-"+i,role:t&&(t.$isLabel||t.$isDisabled)?null:"option"},[t&&(t.$isLabel||t.$isDisabled)?(0,a.kq)("v-if",!0):((0,a.wg)(),(0,a.iD)("span",{key:0,class:(0,o.C_)([e.optionHighlight(i,t),"multiselect__option"]),onClick:(0,l.iM)((i=>e.select(t)),["stop"]),onMouseenter:(0,l.iM)((t=>e.pointerSet(i)),["self"]),"data-select":t&&t.isTag?e.tagPlaceholder:r.selectLabelText,"data-selected":r.selectedLabelText,"data-deselect":r.deselectLabelText},[(0,a.WI)(e.$slots,"option",{option:t,search:e.search,index:i},(()=>[(0,a._)("span",null,(0,o.zw)(e.getOptionLabel(t)),1)]))],42,St)),t&&(t.$isLabel||t.$isDisabled)?((0,a.wg)(),(0,a.iD)("span",{key:1,"data-select":e.groupSelect&&r.selectGroupLabelText,"data-deselect":e.groupSelect&&r.deselectGroupLabelText,class:(0,o.C_)([e.groupHighlight(i,t),"multiselect__option"]),onMouseenter:(0,l.iM)((t=>e.groupSelect&&e.pointerSet(i)),["self"]),onMousedown:(0,l.iM)((i=>e.selectGroup(t)),["prevent"])},[(0,a.WI)(e.$slots,"option",{option:t,search:e.search,index:i},(()=>[(0,a._)("span",null,(0,o.zw)(e.getOptionLabel(t)),1)]))],42,Vt)):(0,a.kq)("v-if",!0)],8,zt)))),128)):(0,a.kq)("v-if",!0),(0,a.wy)((0,a._)("li",null,[(0,a._)("span",Ct,[(0,a.WI)(e.$slots,"noResult",{search:e.search},(()=>[t[20]||(t[20]=(0,a.Uk)("No elements found. Consider changing the search query."))]))])],512),[[l.F8,i.showNoResults&&0===e.filteredOptions.length&&e.search&&!i.loading]]),(0,a.wy)((0,a._)("li",null,[(0,a._)("span",Pt,[(0,a.WI)(e.$slots,"noOptions",{},(()=>[t[21]||(t[21]=(0,a.Uk)("List is empty."))]))])],512),[[l.F8,i.showNoOptions&&(0===e.options.length||!0===r.hasOptionGroup&&0===e.filteredOptions.length)&&!e.search&&!i.loading]]),(0,a.WI)(e.$slots,"afterList")],12,ft)],36),[[l.F8,e.isOpen]])])),_:3})],42,ht)}ut.render=Kt;var Ot=i(179);i(3429),i(4224),i(1121),i(7133);const $t="undefined"!==typeof window&&"undefined"!==typeof document;"undefined"!==typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope),Object.prototype.toString;function xt(e){const t=Object.create(null);return i=>{const s=t[i];return s||(t[i]=e(i))}}const Ft=/\B([A-Z])/g,Lt=(xt((e=>e.replace(Ft,"-$1").toLowerCase())),/-(\w)/g);xt((e=>e.replace(Lt,((e,t)=>t?t.toUpperCase():""))));$t&&window,$t&&window.document,$t&&window.navigator,$t&&window.location;Symbol("vueuse-ssr-width");"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self&&self;Number.POSITIVE_INFINITY;var Ut=i(1164),Bt={components:{Multiselect:ut,RefreshCcw:Ot.Z,SortArrow:Ut.Z},data(){return{API:"https://heligonkovaakademia.sk/api/product/gift_card/",poukazky:[],loading:!1,page:1,limit:20,loadingMore:!1,generating:!1,isOpen:!1,allCodes:[],generatedCodes:[],"allPoukažkyDetails":[],availableZapisy:[],vyberMode:"knihy",zapisyPerPage:10,zapisyPage:0,stats:{zakupene:0,vyuzite:0,nevyuzite:0,kniha:0,knihaVyuzite:0,knihaNevyuzite:0},availableProducts:[],availableAccesses:[{id:"data_knizky_prvy_diel",label:"Prvý diel"},{id:"data_knizky_druhy_diel",label:"Druhý diel"},{id:"data_knizky_treti_diel",label:"Tretí diel"},{id:"data_knizky_stvrty_diel",label:"Štvrtý diel"},{id:"data_knizky_piaty_diel",label:"Piaty diel"},{id:"data_knizky_siesty_diel",label:"Šiesty diel"},{id:"data_knizky_siedmy_diel",label:"Siedmy diel"},{id:"data_knizky_osmy_diel",label:"Ôsmy diel"},{id:"data_knizky_deviaty_diel",label:"Deviaty diel"},{id:"data_knizky_desiaty_diel",label:"Desiaty diel"}],availableSubscriptions:[{id:"3",label:"Ročné predplatné"},{id:"2",label:"Polročné predplatné"},{id:"1",label:"Mesačné predplatné"}],generovanie:{knizka:"1",products:[],specKod:"",pocetKS:0,value:0,value_original:0,accesses:"",valid_until:"",subscription:"",zapisy:[]},editovanyRiadok:null,editForm:{email:"",code:"",used_by:"",value:0,value_original:0,timestamp:"",valid_until:"",giftable_products:[],giftable_accesses:[]},showKodyTable:!1,showDarcekoveTable:!0,specKodProb:"",editRowRef:null,stopRowClickOutside:null,stopClickOutside:null,stopEscListener:null,confirmDeleteId:null,escListener:null,showBooksPicker:!1,showZapisyPicker:!1,showInvalidDialog:!1,invalidSongs:[],pendingProductIds:[],sortKey:"",sortDirection:""}},computed:{vsetkyDarcekove(){return this.zoradenePoukazky.filter((e=>Number(e.value_original||0)>0))},vsetkyKody(){return this.zoradenePoukazky.filter((e=>0===Number(e.value_original||0)))},shouldShowLoadMore(){return this.showDarcekoveTable?this.zoradeneDarcekovePoukazky.length<this.vsetkyDarcekove.length:!!this.showKodyTable&&this.zoradeneKodyDoKnihy.length<this.vsetkyKody.length},vybraneZapisy(){return this.availableZapisy.filter((e=>this.editForm.giftable_products.includes(e.id)))},pagedZapisy(){const e=this.zapisyPage*this.zapisyPerPage;return this.availableZapisy.slice(e,e+this.zapisyPerPage)},zapisyPageCount(){return Math.ceil(this.availableZapisy.length/this.zapisyPerPage)},darcekovePoukazky(){return this.poukazky.filter((e=>Number(e.value_original||0)>0))},kodyDoKnihy(){return this.poukazky.filter((e=>0===Number(e.value_original||0)))},statsDarcekove(){const e=this.allPoukažkyDetails.filter((e=>Number(e.value_original||0)>0));return{zakupene:e.length,vyuzite:e.filter((e=>!!e.used_by)).length,nevyuzite:e.filter((e=>!e.used_by)).length}},statsKody(){const e=this.allPoukažkyDetails.filter((e=>0===Number(e.value_original||0)));return{vygenerovane:e.length,vyuzite:e.filter((e=>!!e.used_by)).length,nevyuzite:e.filter((e=>!e.used_by)).length}},showLoadMore(){return this.showDarcekoveTable?this.darcekovePoukazky.length>0&&this.poukazky.length<this.allCodes.length:!!this.showKodyTable&&(this.kodyDoKnihy.length>0&&this.poukazky.length<this.allCodes.length)},zoradenePoukazky(){let e=[...this.allPoukažkyDetails];const{sortKey:t,sortDirection:i}=this;return t&&i?e.sort(((e,s)=>{let a=e[t],o=s[t];return"value"===t||"value_original"===t?(a=Number(a)||0,o=Number(o)||0,"asc"===i?a-o:o-a):"timestamp"===t||"valid_until"===t?(a=Number(a)||Date.parse(a)||0,o=Number(o)||Date.parse(o)||0,"asc"===i?a-o:o-a):(a=(a||"").toString(),o=(o||"").toString(),"asc"===i?a.localeCompare(o):o.localeCompare(a))})):e},zoradeneDarcekovePoukazky(){const e=this.zoradenePoukazky.filter((e=>Number(e.value_original||0)>0));return e.slice(0,this.limit)},zoradeneKodyDoKnihy(){const e=this.zoradenePoukazky.filter((e=>0===Number(e.value_original||0)));return e.slice(0,this.limit)}},methods:{onSortChange({key:e,direction:t}){this.sortKey=e,this.sortDirection=t},async loadNoteIdsForFolder(e){try{const t=await fetch(`https://heligonkovaakademia.sk/api/folder/list.php?name=${encodeURIComponent(e)}`),i=await t.json();return Array.isArray(i.data)?i.data:[]}catch{return[]}},async loadAllNotes(){try{const e=await fetch("https://heligonkovaakademia.sk/api/noty/list.php"),t=await e.json();return Array.isArray(t)?t:Array.isArray(t.data)?t.data:[]}catch{return[]}},async loadAllNotesWithProductId(){const e=await fetch("https://heligonkovaakademia.sk/api/noty/list.php"),t=await e.json(),i=Array.isArray(t.data)?t.data:[];return i.map((e=>({id:String(e.id),name:e.nazov,product_id:String(e.product_id||"0"),active:Boolean(e.stav_aktivne)})))},async getProductIdsFromFolders(e){const t=new Set;await Promise.all(e.map((async e=>{const i=await this.loadNoteIdsForFolder(e.name);i.forEach((e=>t.add(String(e))))})));const i=await this.loadAllNotes();return Array.from(t).map((e=>{const t=i.find((t=>String(t.id)===e));return t?.product_id})).filter((e=>e&&/^\d+$/.test(e)))},async nacitajPriecinky(){try{const e=await fetch("https://heligonkovaakademia.sk/api/folder/list.php"),t=await e.json();this.availableProducts=t.data.map((e=>({name:e,label:e})))}catch(e){this.availableProducts=[]}},toggleVyberMode(){"knihy"===this.vyberMode?(this.generovanie.zapisy=[...this.generovanie.products],this.vyberMode="zapisy"):(this.generovanie.products=[...this.generovanie.zapisy],this.vyberMode="knihy")},extractUsedByIds(e){if(!e)return[];if(e.includes("|"))return e.split("|").filter((e=>e.trim())).map((e=>{const t=e.match(/->\s*(\d+)/);if(t)return t[1];const i=e.match(/uid:(\d+)/);if(i)return i[1];const s=e.match(/(\d+)$/);return s?s[1]:null})).filter(Boolean);if(/^\d+$/.test(e))return[e];const t=e.match(/uid:(\d+)/);if(t)return[t[1]];const i=e.match(/->\s*(\d+)/);if(i)return[i[1]];const s=e.match(/(\d+)$/);return s?[s[1]]:[]},async fetchAndAttachEmail(e){const t=[...new Set(this.extractUsedByIds(e.used_by))];e.used_by_emails=[],await Promise.all(t.map((async t=>{try{const i=await fetch(`https://heligonkovaakademia.sk/api/user/info/getAllInformationAboutUser.php/?id=${t}`),s=await i.json();s?.data?.email&&e.used_by_emails.push(s.data.email)}catch(i){}})))},async afterBatch(){await Promise.all(this.poukazky.map((e=>this.fetchAndAttachEmail(e))))},showTable(e){"user"===e?(this.showDarcekoveTable=!0,this.showKodyTable=!1):(this.showDarcekoveTable=!1,this.showKodyTable=!0)},setEditRowRef(e){this.editRowRef=e},async nacitajAllStats(){try{const e=await fetch(this.API+"list.php"),t=await e.json();if(!t?.data||!Array.isArray(t.data))throw new Error("Invalid");this.allPoukažkyDetails=t.data,this.vypocitajStats()}catch(e){this.allPoukažkyDetails=[]}},vypocitajStats(){let e=this.allPoukažkyDetails;this.stats.zakupene=e.filter((e=>Number(e.value)>0)).length,this.stats.vyuzite=e.filter((e=>e.used_by)).length,this.stats.nevyuzite=e.filter((e=>!e.used_by)).length,this.stats.kniha=e.length,this.stats.knihaVyuzite=e.filter((e=>e.used_by)).length,this.stats.knihaNevyuzite=e.filter((e=>!e.used_by)).length},async nacitajBatch(e=1){if(this.loading=1===e,this.loadingMore=e>1,1===e||0===this.allCodes.length){let e=await fetch(this.API+"list.php"),t=await e.json();this.allCodes=t.data.sort(((e,t)=>new Date(t.timestamp)-new Date(e.timestamp))).map((e=>e.code))}let t=this.allCodes.slice((e-1)*this.limit,e*this.limit);if(!t.length)return void(this.loading=this.loadingMore=!1);let i=await Promise.all(t.map((e=>fetch(this.API+"view.php?code="+encodeURIComponent(e)).then((e=>e.json())).then((e=>e.data[0])))));i=i.filter((e=>!e.deleted||"false"===e.deleted||0===e.deleted)),await Promise.all(i.map((e=>this.fetchAndAttachEmail(e)))),this.poukazky=1===e?i:[...this.poukazky,...i],this.page=e,this.loading=this.loadingMore=!1,this.vypocitajStats()},async nacitajZapisy(){try{const e=await fetch("https://heligonkovaakademia.sk/api/product/stats/listZapis.php"),t=await e.json();if("Request succesfull"!==t.status||!Array.isArray(t.data))return void(this.availableZapisy=[]);this.availableZapisy=t.data.map((e=>({id:e.id,label:e.name,details:e.details,difficulty:e.difficulty})))}catch(e){this.availableZapisy=[]}},isEdit(e,t){return this.editovanyRiadok?.typ===e&&this.editovanyRiadok.idx===t},zacniEditaciu(e,t,i){this.stopRowClickOutside&&(this.stopRowClickOutside(),this.stopRowClickOutside=null),this.editovanyRiadok={typ:e,idx:t};let a=[];try{a=JSON.parse(i.giftable_products)||[]}catch(u){}const o=this.availableSubscriptions.map((e=>e.id));let l="";const n=a.filter((e=>!o.includes(String(e))||(l=String(e),!1))),r=n.filter((e=>this.availableProducts.some((t=>String(t.name)===String(e))))).map((e=>this.availableProducts.find((t=>String(t.name)===String(e))))),d=n.filter((e=>this.availableZapisy.some((t=>String(t.id)===String(e))))).map((e=>this.availableZapisy.find((t=>String(t.id)===String(e)))));let c=[];try{c=JSON.parse(i.giftable_accesses)||[]}catch(u){}const p=c[0]||"";this.editForm={email:i.origin,code:i.code,value_original:Number(i.value_original||i.value||0),value:Number(i.value||0),timestamp:i.timestamp,valid_until:this.formatDateInput(i.valid_until),products:r,zapisy:d,accesses:p,used_by:i.used_by_emails?.join(", ")||i.used_by,subscription:l},this.$nextTick((()=>{this.stopRowClickOutside=(0,s.useClickOutside)((()=>this.editRowRef),(()=>this.zrusEditaciu()),{eventName:"mousedown"})}))},async ulozEditaciu(e){const t=new FormData;t.append("id",e.id),t.append("code",this.editForm.code),t.append("value_original",String(e.value_original??e.value??0)),t.append("value",String(this.editForm.value??0));const i="neobmedzená"===this.editForm.valid_until?e.valid_until:this.toTimestamp(this.editForm.valid_until);t.append("valid_until",i);const s=await this.getProductIdsFromFolders(this.editForm.products||[]);if(s.forEach((e=>t.append("giftable_products[]",e))),(this.editForm.zapisy||[]).forEach((e=>t.append("giftable_products[]",e.id))),this.editForm.accesses){const e=this.editForm.accesses.id||this.editForm.accesses;t.append("giftable_accesses[]",e)}this.editForm.subscription&&t.append("giftable_products[]",this.editForm.subscription);try{const i=await fetch(this.API+"edit.php",{method:"POST",body:t}),s=await i.text(),a=JSON.parse(s);if("Request fullfiled"===a.status){this.$store.state.SnackBarText="Údaje boli upravené";const t=await fetch(this.API+"view.php?code="+encodeURIComponent(e.code)),i=await t.json(),s=i.data[0],a=this.poukazky.findIndex((t=>t.id===e.id));-1!==a&&this.poukazky.splice(a,1,s),await this.nacitajBatch(this.page)}else this.$store.state.SnackBarText="Úprava sa nepodarila: "+(a.data||a.status)}catch(a){this.$store.state.SnackBarText="Chyba pri uložení: "+a.message}this.zrusEditaciu()},handleEscKey(e){"Escape"===e.key&&this.editovanyRiadok&&this.zrusEditaciu()},onOpenBooks(){this.showBooksPicker=!this.showBooksPicker,this.showBooksPicker&&(this.showZapisyPicker=!1)},onOpenZapisy(){this.showZapisyPicker=!this.showZapisyPicker,this.showZapisyPicker&&(this.showBooksPicker=!1)},zrusEditaciu(){this.stopRowClickOutside&&(this.stopRowClickOutside(),this.stopRowClickOutside=null),this.showBooksPicker=!1,this.showZapisyPicker=!1,this.editovanyRiadok=null,this.editForm={},this.editRowRef=null},onSpecKodInput(e){let t=e.target.value.replace(/[^A-Za-z0-9]/g,"").toUpperCase();t=t.slice(0,12);const i=t.match(/.{1,4}/g)||[],s=i.join("-");this.generovanie.specKod=s,this.specKodProb=this.pravdUhadnutia(s)},formatDateInput(e){if(!e)return"";if("string"===typeof e&&e.includes("-")){const t=parseInt(e.split("-")[0],10);return t>2200?"neobmedzená":e}const t=new Date(1e3*Number(e)),i=t.getUTCFullYear();return i>2200?"neobmedzená":t.toISOString().split("T")[0]},toTimestamp(e){return e?Math.floor(new Date(e).getTime()/1e3):""},formatCode(e){const t=e.replace(/-/g,""),i=t.match(/.{1,4}/g)||[];return i.join("-")},async"generujPoukažky"(){if(this.generatedCodes=[],this.generating=!0,!this.pocetKS||this.pocetKS<1)return alert("Zadaj počet kusov!"),void(this.generating=!1);const e=new Set;for(const o of this.generovanie.products){const t=await this.loadNoteIdsForFolder(o.name);t.forEach((t=>e.add(String(t))))}const t=await this.loadAllNotesWithProductId(),i=Array.from(e).map((e=>t.find((t=>t.id===e))||{id:e,name:`#${e}`,product_id:"0"})),s=i.filter((e=>"0"===e.product_id));if(s.length)return this.invalidSongs=s.map((e=>e.name)),this.pendingProductIds=i.filter((e=>"0"!==e.product_id)).map((e=>e.product_id)),this.showInvalidDialog=!0,void(this.generating=!1);const a=i.map((e=>e.product_id));this._doGenerate(a)},async _doGenerate(e){for(let t=0;t<Number(this.pocetKS);t++){const t=new FormData;t.append("code",this.generovanie.specKod),t.append("value",this.generovanie.value),t.append("value_original",this.generovanie.value),e.forEach((e=>t.append("giftable_products[]",e))),this.generovanie.subscription&&t.append("giftable_products[]",this.generovanie.subscription),this.generovanie.accesses&&t.append("giftable_accesses[]",this.generovanie.accesses),t.append("valid_until",this.generovanie.valid_until?this.toTimestamp(this.generovanie.valid_until):Math.floor(Date.now()/1e3)+63072e5);try{const e=await fetch(this.API+"create.php",{method:"POST",body:t}),i=await e.json();this.generatedCodes.push(this.formatCode(i.data||"CHYBA"))}catch{this.generatedCodes.push("CHYBA")}}await this.nacitajAllStats(),await this.nacitajBatch(1),this.generating=!1},onConfirmSkipInvalid(){this.showInvalidDialog=!1,this._doGenerate(this.pendingProductIds),this.pendingProductIds=[]},onCancelGenerate(){this.showInvalidDialog=!1,this.generating=!1,this.pendingProductIds=[]},downloadCSV(){const e=new Blob([this.generatedCodes.join("\n")],{type:"text/csv"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download="poukazky.csv",t.click()},daysLeft(e){return Math.max(0,Math.floor((Number(e)-Date.now()/1e3)/86400))},formatDate(e){if(!e)return"";const t=new Date(e.replace(" ","T"));return`${t.getDate()}.${t.getMonth()+1}.${t.getFullYear()}`},pravdUhadnutia(e){if(!e)return"";const t=e.replace(/-/g,""),i=12-t.length;return i<=0?"":`Pravd. uhádnutia: 1 z ${Math.pow(23,i)}`},async confirmDelete(e){this.confirmDeleteId===e?(await this.vymazat(e),this.confirmDeleteId=null):(this.confirmDeleteId=e,setTimeout((()=>{this.confirmDeleteId===e&&(this.confirmDeleteId=null)}),5e3))},async vymazat(e){if(/^\d+$/.test(String(e)))try{const i=await fetch(`https://heligonkovaakademia.sk/api/product/gift_card/delete.php?id=${e}`),s=await i.text();let a;try{a=JSON.parse(s)}catch(t){return void(this.$store.state.SnackBarText=`Server neposlal platný JSON: ${t.message}\nOdpoveď: ${s||"(prázdne)"}`)}"Request fullfiled"===a?.status?(this.$store.state.SnackBarText="Položka bola úspešne vymazaná.",await this.nacitajBatch(this.page)):this.$store.state.SnackBarText="Vymazanie sa nepodarilo: "+(a?.data||"Neznáma chyba")}catch(t){this.$store.state.SnackBarText=`Chyba siete pri mazaní: ${t.message}`}else this.$store.state.SnackBarText="Neplatné ID"}},mounted(){this.$nextTick((()=>{const e=this.$el.querySelector(".multiselect__tags-wrap");e&&e.addEventListener("click",(()=>this.isOpen=!0))})),fetch("https://heligonkovaakademia.sk/api/noty/list.php").then((e=>e.json())).then((e=>{Array.isArray(e)?this.availableZapisy=e:this.availableZapisy=[]})).catch((e=>{this.availableZapisy=[]})),this.nacitajPriecinky(),this.nacitajBatch(1),this.nacitajAllStats().then((async()=>{for(const e of this.allPoukažkyDetails)await this.fetchAndAttachEmail(e)})),this.nacitajZapisy(),this.specKodProb=this.pravdUhadnutia(this.generovanie.specKod),this.afterBatch(),this.escListener=e=>this.handleEscKey(e),window.addEventListener("keydown",this.escListener)},beforeUnmount(){window.removeEventListener("keydown",this.escListener)},watch:{"editForm.products":{handler:async function(e){const t=new Set;for(const o of e)try{const e=await fetch(`https://heligonkovaakademia.sk/api/folder/list.php?name=${encodeURIComponent(o.id)}`),i=await e.json(),s=Array.isArray(i.data)?i.data:[];s.forEach((e=>t.add(String(e))))}catch(a){}const i=Array.from(t).map((e=>this.availableZapisy.find((t=>String(t.id)===String(e))))).filter(Boolean),s=[...new Map([...this.editForm.zapisy||[],...i].map((e=>[String(e.id),e]))).values()];this.editForm.zapisy=s},deep:!0}}},Mt=i(89);const At=(0,Mt.Z)(Bt,[["render",st],["__scopeId","data-v-2ee38d21"]]);var It=At}}]);