"use strict";(self["webpackChunkheligonkova_akademia"]=self["webpackChunkheligonkova_akademia"]||[]).push([[5561],{1164:function(t,e,o){o.d(e,{Z:function(){return u}});var a=o(3396),n=o(7139);function s(t,e,o,s,i,r){return(0,a.wg)(),(0,a.iD)("span",{class:"sort-arrow",onClick:e[0]||(e[0]=(...t)=>r.toggleSort&&r.toggleSort(...t))},[((0,a.wg)(),(0,a.iD)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"0.7em",height:"0.7em",viewBox:"0 0 14 12",class:(0,n.C_)(["triangle-icon",r.rotationClass])},e[1]||(e[1]=[(0,a._)("path",{d:"M13.7814 2.28223C14.0658 1.81973 14.0752 1.23848 13.8095 0.766602C13.5439 0.294727 13.0439 0.000976574 12.5002 0.000976581L1.50015 0.000976612C0.956406 0.000976612 0.454801 0.294727 0.190776 0.766602C-0.0748491 1.23848 0.0623493 1.81973 0.218901 2.28223L5.7189 11.2822C5.99786 11.7917 6.47515 12.0015 7.00015 12.001C7.52515 12.001 8.0064 11.7291 8.2814 11.2822L13.7814 2.28223Z",fill:"black"},null,-1)]),2))])}var i={props:{column:String,sortKey:String,sortDirection:String},computed:{rotationClass(){return this.sortKey!==this.column?"neutral":"asc"===this.sortDirection?"rotate":""}},methods:{toggleSort(){let t="asc";this.sortKey===this.column&&"asc"===this.sortDirection?t="desc":this.sortKey===this.column&&"desc"===this.sortDirection&&(t=""),this.$emit("update:sort",{key:t?this.column:"",direction:t})}}},r=o(89);const l=(0,r.Z)(i,[["render",s],["__scopeId","data-v-93cbcb14"]]);var u=l},5561:function(t,e,o){o.r(e),o.d(e,{default:function(){return f}});var a=o(3396),n=o(9242),s=o(7139);const i=["id"],r={class:"scroll"},l={class:"not-hover"},u={class:"row"},d={class:"row row-form"},p={class:"row"},c={class:"row"},h={class:"table"},y={style:{width:"35%"}},v={style:{width:"20%"}},_={style:{width:"15%"}},m={style:{width:"10%"}},k={key:0},w=["onClick"];function D(t,e,o,D,g,z){const K=(0,a.up)("SortArrow");return(0,a.wg)(),(0,a.iD)("section",{id:t.$route.name},[(0,a._)("div",r,[e[14]||(e[14]=(0,a._)("h1",null,"Administratívny systém",-1)),e[15]||(e[15]=(0,a._)("h5",null,"Zľavové kódy",-1)),e[16]||(e[16]=(0,a._)("div",{class:"line horizontal w-80"},null,-1)),(0,a._)("form",{class:"table add",onSubmit:e[4]||(e[4]=(0,n.iM)(((...t)=>z.pridanieKuponu&&z.pridanieKuponu(...t)),["prevent"]))},[(0,a._)("table",null,[e[7]||(e[7]=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{style:{width:"30%"}},"Názov:"),(0,a._)("th",{style:{width:"20%"}},"Typ:"),(0,a._)("th",{style:{width:"15%"}},"Doba trvania:"),(0,a._)("th",{style:{width:"15%"}},"Zľava v %:"),(0,a._)("th",{style:{width:"20%"}})])],-1)),(0,a._)("tbody",null,[(0,a._)("tr",l,[(0,a._)("td",null,[(0,a._)("div",u,[(0,a.wy)((0,a._)("input",{type:"text",name:"nazov",id:"nazov",placeholder:"Heligonka20","onUpdate:modelValue":e[0]||(e[0]=t=>g.nazov=t)},null,512),[[n.nr,g.nazov]])])]),(0,a._)("td",null,[(0,a._)("div",d,[(0,a.wy)((0,a._)("select",{name:"typ",id:"typ","onUpdate:modelValue":e[1]||(e[1]=t=>g.typ=t)},e[5]||(e[5]=[(0,a._)("option",{value:"kosik",selected:""},"Košík",-1),(0,a._)("option",{value:"predplatne"},"Predplatné",-1)]),512),[[n.bM,g.typ]])])]),(0,a._)("td",null,[(0,a._)("div",p,[(0,a.wy)((0,a._)("input",{type:"number",name:"doba",id:"doba",placeholder:"7","onUpdate:modelValue":e[2]||(e[2]=t=>g.doba=t)},null,512),[[n.nr,g.doba]])])]),(0,a._)("td",null,[(0,a._)("div",c,[(0,a.wy)((0,a._)("input",{type:"text",name:"zlava",id:"zlava",placeholder:"10","onUpdate:modelValue":e[3]||(e[3]=t=>g.zlava=t)},null,512),[[n.nr,g.zlava]])])]),(0,a._)("td",null,[(0,a._)("button",{class:(0,s.C_)([{"not-have-permission":!this.$store.state.userRoles?.roles?.includes("coupon_master")},"button"]),type:"submit"},e[6]||(e[6]=[(0,a._)("a",null,"Pridať",-1)]),2)])])])])],32),e[17]||(e[17]=(0,a._)("div",{class:"line horizontal w-80"},null,-1)),(0,a._)("table",h,[(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",y,[e[8]||(e[8]=(0,a.Uk)(" Názov: ")),(0,a.Wm)(K,{column:"code",sortKey:g.sortKey,sortDirection:g.sortDirection,"onUpdate:sort":z.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("th",v,[e[9]||(e[9]=(0,a.Uk)(" Typ: ")),(0,a.Wm)(K,{column:"urlType",sortKey:g.sortKey,sortDirection:g.sortDirection,"onUpdate:sort":z.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("th",_,[e[10]||(e[10]=(0,a.Uk)(" Do zrušenia: ")),(0,a.Wm)(K,{column:"valid_until_day",sortKey:g.sortKey,sortDirection:g.sortDirection,"onUpdate:sort":z.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),(0,a._)("th",m,[e[11]||(e[11]=(0,a.Uk)(" Zľava: ")),(0,a.Wm)(K,{column:"value",sortKey:g.sortKey,sortDirection:g.sortDirection,"onUpdate:sort":z.updateSort},null,8,["sortKey","sortDirection","onUpdate:sort"])]),e[12]||(e[12]=(0,a._)("th",{style:{width:"20%"}},null,-1))])]),z.getAllCoupons().length>0?((0,a.wg)(),(0,a.iD)("tbody",k,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(z.sortedCoupons,((t,o)=>((0,a.wg)(),(0,a.iD)("tr",{key:o},[(0,a._)("td",null,[(0,a._)("strong",null,(0,s.zw)(o+1)+". ",1),(0,a.Uk)(" "+(0,s.zw)(t.code),1)]),(0,a._)("td",null,(0,s.zw)(z.formatUrlType(t.urlType)),1),(0,a._)("td",null,(0,s.zw)(t.valid_until_string),1),(0,a._)("td",null,(0,s.zw)(t.value)+" %",1),(0,a._)("td",null,[(0,a._)("div",{class:(0,s.C_)([{"not-have-permission":!this.$store.state.userRoles?.roles?.includes("coupon_master")},"button"]),onClick:e=>z.vymazKupon(t.id,t.urlType)},e[13]||(e[13]=[(0,a._)("a",null,"Zrušiť",-1)]),10,w)])])))),128))])):(0,a.kq)("",!0)])])],8,i)}o(560);var g=o(1164),z={components:{SortArrow:g.Z},mounted(){window.scrollTo(0,0),this.nacitajKupony("kosik"),this.nacitajKupony("predplatne")},data(){return{zlava:"",nazov:"",typ:"",doba:0,kuponyData:{},sortKey:"",sortDirection:""}},computed:{sortedCoupons(){const t=this.getAllCoupons();return this.sortKey&&this.sortDirection?[...t].sort(((t,e)=>{const o=t[this.sortKey],a=e[this.sortKey];return"number"===typeof o&&"number"===typeof a?"asc"===this.sortDirection?o-a:a-o:"asc"===this.sortDirection?String(o).localeCompare(String(a)):String(a).localeCompare(String(o))})):t}},methods:{updateSort({key:t,direction:e}){this.sortKey=t,this.sortDirection=e},formatUrlType(t){return t.includes("product")?"Košík":t.includes("subscription")?"Predplatné":t},getAllCoupons(){const t=[];if(!this.kuponyData||"object"!==typeof this.kuponyData)return t;for(const e in this.kuponyData)Array.isArray(this.kuponyData[e])&&this.kuponyData[e].forEach((o=>{t.push({...o,urlType:e})}));return t},pridanieKuponu(){if(this.zlava.includes(",")&&(this.zapisyData.cena=this.zapisyData.cena.replace(",",".")),!this.podmienkyPreOdoslanie())return;let t=new Date;t.setDate(t.getDate()+this.doba),t.setHours(0,0,0,0);let e=t.getTime()/1e3;const a=o(7218),n=o(6237);let s=new n;s.append("type","PERCENT"),s.append("value",this.zlava),s.append("valid_until",e),""==this.nazov&&void 0==this.nazov||s.append("code",this.nazov);var i="";i="predplatne"==this.typ?"/subscription/coupon/create.php":"/product/coupon/create.php/";let r={method:"post",maxBodyLength:1/0,url:this.$store.state.api+i,data:s};a.request(r).then((t=>{"Request fullfiled"==t.data.status?(this.$store.state.SnackBarText="Kupón z názvom "+this.nazov+" bol úspešne pridaný",this.nacitajKupony("kosik"),this.nacitajKupony("predplatne"),this.zlava=0,this.nazov="",this.doba=0):this.$store.state.SnackBarText="Kupón sa nepodarilo pridať"})).catch((t=>{this.$store.state.SnackBarText="Kupón sa nepodarilo pridať"}))},nacitajKupony(t){const e=o(7218),a=o(6237);let n=new a;this.kuponyData[s]||(this.kuponyData[s]=[]);var s="";s="predplatne"==t?"/subscription/coupon/list.php":"/product/coupon/list.php";let i={method:"get",maxBodyLength:1/0,url:this.$store.state.api+s,data:n};e.request(i).then((t=>{"Request succesfull"==t.data.status?(this.kuponyData[s]=t.data.data||[],this.kuponyData[s].forEach((t=>{t.valid_until_day=this.getRemainingDays(1e3*t.valid_until)})),this.kuponyData[s]=this.kuponyData[s].filter((t=>t.valid_until_day>0)),this.kuponyData[s].forEach((t=>{1===t.valid_until_day?t.valid_until_string=t.valid_until_day+" deň":t.valid_until_day>1&&t.valid_until_day<5?t.valid_until_string=t.valid_until_day+" dni":t.valid_until_string=t.valid_until_day+" dní"}))):this.$store.state.SnackBarText="Nepodarilo sa načítať kupóny"})).catch((t=>{}))},vymazKupon(t,e){if(window.confirm("Naozaj chcete zrušiť platnosť kupónu pred uplynutím doby? Kupón sa nebude dať spätne aktivovať.")){const n=o(7218),s=o(6237);let i=new s;var a="";a="/product/coupon/list.php"==e?"/product/coupon/delete.php?id=":"/subscription/coupon/delete.php?id=";let r={method:"get",maxBodyLength:1/0,url:this.$store.state.api+a+t,data:i};n.request(r).then((e=>{"Request fullfiled"==e.data.status?(this.$store.state.SnackBarText="Váš kupón s id: "+t+" bol vymazaný",this.nacitajKupony("kosik"),this.nacitajKupony("predplatne")):this.$store.state.SnackBarText="Nepodarilo sa vymazať kupón"})).catch((t=>{this.$store.state.SnackBarText="Nepodarilo sa vymazať kupón"+t}))}},getRemainingDays(t){let e=Date.now(),o=t,a=o-e,n=Math.ceil(a/864e5);return n},podmienkyPreOdoslanie(){const t=/^[0-9.,]+$/;return!!(""!==this.nazov.trim()&&""!==this.zlava.trim()&&t.test(this.zlava)&&!isNaN(this.doba)&&this.doba>0)||(this.$store.state.SnackBarText="Nepodarilo sa vytvoriť zápis, pre odoslanie vyplňte správne všetky polia",!1)}}},K=o(89);const b=(0,K.Z)(z,[["render",D],["__scopeId","data-v-13da8277"]]);var f=b}}]);